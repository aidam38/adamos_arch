!function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=55)}([function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(){return l.localConfig.get("uuid")}Object.defineProperty(e,"__esModule",{value:!0});var a=r(15),s=i(a),o=r(13),u=i(o),l=r(10),h=r(31),c=i(h),f={_timers:{}},p=new s.default(u.default.logsLimit),d=["log","info","warn","debug","error"],m=!0,y=!1,g=void 0;try{for(var v,b=d[Symbol.iterator]();!(m=(v=b.next()).done);m=!0)!function(){var t=v.value;f[t]=function(){for(var e,r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];(e=console)[t].apply(e,i),p.push({date:(new Date).toUTCString(),method:t,params:i})}}()}catch(t){y=!0,g=t}finally{try{!m&&b.return&&b.return()}finally{if(y)throw g}}f.throw=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var i=e.pop();return i&&i.stack?f.error.apply(f,e.concat([i.message,i.stack.split(/\r\n?|\n/g)])):f.error.apply(f,e.concat([i.message]))},f.dump=function(){var t=chrome.runtime.getManifest().version_name.match(/^(.*) \((.*)\)$/),e=void 0,r=void 0;return t&&(e=t[1],r=t[2]),n().then(function(t){return{extensionId:chrome.runtime.id,version:e,build:r,browser:c.default.description,uuid:t,logs:Array.apply(null,p)}})},f.time=function(t){this._timers[t]=Date.now()},f.timeEnd=function(t){if(t in this._timers){var e=this._timers[t],r=Date.now(),i=r-e;f.debug(t+": "+i+" ms")}else console.error("Timer "+t+" not found")},e.default=f},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=r(13),a=i(n),s=r(0),o=i(s),u=r(11),l=i(u),h=(chrome.i18n,a.default);try{var c=l.default.get("oddshot_config");c&&h.dev&&("serverURL"in c&&(h.serverURL=c.serverURL),"useWatchers"in c&&(h.useWatchers=c.useWatchers))}catch(t){o.default.throw("Error in parsing dev config",t)}e.default={isDev:function(){return!0===h.dev},get:function(t){return t?h[t]:h},patch:function(t){for(var e in t)h[e]=t[e];l.default.set("oddshot_config",{serverURL:h.serverURL,useWatchers:h.useWatchers}),o.default.log("Config updated",t)}}},function(t,e,r){"use strict";function i(){return g.localConfig.get("uuid")}function n(){return b.default.get("shotTime")||40}function a(){var t=n();return Math.max(t,Math.min(b.default.get("chunkLifetime"),300))}function s(t){return new Promise(function(e,r){chrome.webNavigation.getAllFrames(t,function(t){Array.isArray(t)?e(t):r(chrome.runtime.lastError)})})}function o(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",i=""+t;return i.length>=e?i.substr(0,e):new Array(e-i.length+1).join(r)+i}function u(t,e){var r={},i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var u=s.value;r[u]=t[u]}}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}function l(t){var e={},r=!0,i=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){e[a.value]=!0}}catch(t){i=!0,n=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw n}}return Object.keys(e)}function h(t,e){var r=y({},e);for(var i in t)null!=r[i]&&""!=r[i]||!t[i]||(r[i]=t[i]);return r}function c(t){var e={},r=!0,i=!1,n=void 0;try{for(var a,s=t.entries()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=m(a.value,2),u=o[0],l=o[1];e[u]=l}}catch(t){i=!0,n=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw n}}return e}function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t(r).catch(function(i){if(e>0&&!(i instanceof Error))return f(t,e-1,r+1);throw i})}function p(t){var e={t:1e12,b:1e9,m:1e6,k:1e3},r=t.replace(/(^\s+|\s+$)/g,""),i=parseFloat(r),n=r.toLowerCase().match(/t|b|m|k/);return n&&n[0]in e?parseInt(i*e[n[0]]):parseInt(i)}function d(t,e){for(var r=t.length-1;r>=0;r--)if(e(t[r],r,t))return r;return-1}Object.defineProperty(e,"__esModule",{value:!0}),e.VIDEO_STREAM=e.AUDIO_STREAM=void 0;var m=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};e.getUUID=i,e.getShotTime=n,e.getChunkLifetime=a,e.getAllFrames=s,e.pad=o,e.pick=u,e.uniq=l,e.defaults=h,e.mapToObject=c,e.dontGiveUp=f,e.parseNumber=p,e.findLastIndex=d;var g=r(10),v=r(1),b=function(t){return t&&t.__esModule?t:{default:t}}(v);e.AUDIO_STREAM="a",e.VIDEO_STREAM="v"},function(t,e,r){"use strict";function i(t,e){return{title:t,message:e}}Object.defineProperty(e,"__esModule",{value:!0});var n=chrome.i18n,a={};a[1]=i(n.getMessage("notReadyStatusTitle"),n.getMessage("notReadyStatus")),a[2]=i(n.getMessage("readyStatusTitle"),n.getMessage("readyStatus")),a[3]=i(n.getMessage("cooldownStatusTitle"),n.getMessage("cooldownStatus")),a[4]=i(n.getMessage("pausedStatusTitle"),n.getMessage("pausedStatus")),a[5]=i(n.getMessage("blockedStatusTitle"),n.getMessage("blockedStatus")),a[6]=i(n.getMessage("unsupportedStatusTitle"),n.getMessage("unsupportedStatus")),a[7]=i(n.getMessage("offlineStatusTitle"),n.getMessage("offlineStatus")),a[8]=i(n.getMessage("loadingStatusTitle"),n.getMessage("loadingStatus")),a[9]=i(n.getMessage("notLiveStatusTitle"),n.getMessage("notLiveStatus")),a[10]=i(n.getMessage("protectedStatusTitle"),n.getMessage("protectedStatus")),a[11]=i(n.getMessage("bannedStatusTitle"),n.getMessage("bannedStatus"));var s={NOT_READY:1,READY:2,COOLDOWN:3,PAUSED:4,BLOCKED:5,UNSUPPORTED:6,OFFLINE:7,LOADING:8,NOT_LIVE:9,PROTECTED:10,BANNED:11,getStatusMessage:function(t){return t?t in a?a[t]:void 0:i(n.getMessage("pageNotSupportedStatusTitle"),n.getMessage("pageNotSupportedStatus"))},getLoadingMessage:function(){return i(n.getMessage("pageIsLoadingStatusTitle"),n.getMessage("pageIsLoadingStatus"))},getManyStreamsMessage:function(){return i(n.getMessage("manyStreamsStatus"),n.getMessage("manyStreamsStatus"))},getStatusName:function(t){for(var e in s)if(s[e]===t)return e;return"PAGE_NOT_SUPPORTED"}};e.default=s},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),a=i(n),s=r(123),o=i(s),u={},l=["get","delete","head","post","put","patch"],h=o.default.create({header:{"Content-Type":"application/json"},responseType:"json",withCredentials:!0}),c=!0,f=!1,p=void 0;try{for(var d,m=l[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){var y=d.value;u[y]=function(t){return function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];var n=r[r.length-1],s=n&&!0!==n.silent&&"head"!==t,o=r[1]||r[2]&&r[2].params||"";return s&&a.default.log(t.toUpperCase(),r[0],o),h[t].apply(h,r).then(function(t){return s&&a.default.log("Response from "+r[0],{data:t.data,status:t.status,statusText:t.statusText}),t.data}).catch(function(t){throw t instanceof Error?a.default.throw("Error in setting up the request",t):a.default.error("Request to "+r[0]+" failed",t),t})}}(y)}}catch(t){f=!0,p=t}finally{try{!c&&m.return&&m.return()}finally{if(f)throw p}}e.default=u},function(t,e,r){(function(e){function r(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}}function i(t,e){return Array.prototype.slice.call(t,e||0)}function n(t,e){s(t,function(t,r){return e(t,r),!1})}function a(t,e){var r=o(t)?[]:{};return s(t,function(t,i){return r[i]=e(t,i),!1}),r}function s(t,e){if(o(t)){for(var r=0;r<t.length;r++)if(e(t[r],r))return t[r]}else for(var i in t)if(t.hasOwnProperty(i)&&e(t[i],i))return t[i]}function o(t){return null!=t&&"function"!=typeof t&&"number"==typeof t.length}function u(t){return t&&"[object Function]"==={}.toString.call(t)}function l(t){return t&&"[object Object]"==={}.toString.call(t)}var h=function(){return Object.assign?Object.assign:function(t,e,r,i){for(var a=1;a<arguments.length;a++)n(Object(arguments[a]),function(e,r){t[r]=e});return t}}(),c=function(){function t(){}return Object.create?function(t,e,r,n){var a=i(arguments,1);return h.apply(this,[Object.create(t)].concat(a))}:function(e,r,n,a){var s=i(arguments,1);return t.prototype=e,h.apply(this,[new t].concat(s))}}(),f=function(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}(),p="undefined"!=typeof window?window:e;t.exports={assign:h,create:c,trim:f,bind:r,slice:i,each:n,map:a,pluck:s,isList:o,isFunction:u,isObject:l,Global:p}}).call(e,r(12))},function(t,e,r){"use strict";function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function n(t,e,r){if(t&&l.isObject(t)&&t instanceof i)return t;var n=new i;return n.parse(t,e,r),n}function a(t){return l.isString(t)&&(t=n(t)),t instanceof i?t.format():i.prototype.format.call(t)}function s(t,e){return n(t,!1,!0).resolve(e)}function o(t,e){return t?n(t,!1,!0).resolveObject(e):e}var u=r(98),l=r(122);e.parse=n,e.resolve=s,e.resolveObject=o,e.format=a,e.Url=i;var h=/^([a-z0-9.+-]+:)/i,c=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,p=["<",">",'"',"`"," ","\r","\n","\t"],d=["{","}","|","\\","^","`"].concat(p),m=["'"].concat(d),y=["%","/","?",";","#"].concat(m),g=["/","?","#"],v=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=r(32);i.prototype.parse=function(t,e,r){if(!l.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),n=-1!==i&&i<t.indexOf("#")?"?":"#",a=t.split(n),s=/\\/g;a[0]=a[0].replace(s,"/"),t=a.join(n);var o=t;if(o=o.trim(),!r&&1===t.split("#").length){var c=f.exec(o);if(c)return this.path=o,this.href=o,this.pathname=c[1],c[2]?(this.search=c[2],this.query=e?x.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var p=h.exec(o);if(p){p=p[0];var d=p.toLowerCase();this.protocol=d,o=o.substr(p.length)}if(r||p||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===o.substr(0,2);!k||p&&w[p]||(o=o.substr(2),this.slashes=!0)}if(!w[p]&&(k||p&&!S[p])){for(var U=-1,I=0;I<g.length;I++){var O=o.indexOf(g[I]);-1!==O&&(-1===U||O<U)&&(U=O)}var A,C;C=-1===U?o.lastIndexOf("@"):o.lastIndexOf("@",U),-1!==C&&(A=o.slice(0,C),o=o.slice(C+1),this.auth=decodeURIComponent(A)),U=-1;for(var I=0;I<y.length;I++){var O=o.indexOf(y[I]);-1!==O&&(-1===U||O<U)&&(U=O)}-1===U&&(U=o.length),this.host=o.slice(0,U),o=o.slice(U),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var T=this.hostname.split(/\./),I=0,E=T.length;I<E;I++){var B=T[I];if(B&&!B.match(v)){for(var F="",L=0,D=B.length;L<D;L++)B.charCodeAt(L)>127?F+="x":F+=B[L];if(!F.match(v)){var R=T.slice(0,I),M=T.slice(I+1),z=B.match(b);z&&(R.push(z[1]),M.unshift(z[2])),M.length&&(o="/"+M.join(".")+o),this.hostname=R.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=u.toASCII(this.hostname));var j=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+j,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!_[d])for(var I=0,E=m.length;I<E;I++){var G=m[I];if(-1!==o.indexOf(G)){var H=encodeURIComponent(G);H===G&&(H=escape(G)),o=o.split(G).join(H)}}var V=o.indexOf("#");-1!==V&&(this.hash=o.substr(V),o=o.slice(0,V));var q=o.indexOf("?");if(-1!==q?(this.search=o.substr(q),this.query=o.substr(q+1),e&&(this.query=x.parse(this.query)),o=o.slice(0,q)):e&&(this.search="",this.query={}),o&&(this.pathname=o),S[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var j=this.pathname||"",W=this.search||"";this.path=j+W}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",n=!1,a="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(a=x.stringify(this.query));var s=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||S[e])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),s=s.replace("#","%23"),e+n+r+s+i},i.prototype.resolve=function(t){return this.resolveObject(n(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if(l.isString(t)){var e=new i;e.parse(t,!1,!0),t=e}for(var r=new i,n=Object.keys(this),a=0;a<n.length;a++){var s=n[a];r[s]=this[s]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),u=0;u<o.length;u++){var h=o[u];"protocol"!==h&&(r[h]=t[h])}return S[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!S[t.protocol]){for(var c=Object.keys(t),f=0;f<c.length;f++){var p=c[f];r[p]=t[p]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||w[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var m=r.pathname||"",y=r.search||"";r.path=m+y}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var g=r.pathname&&"/"===r.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=v||g||r.host&&t.pathname,_=b,x=r.pathname&&r.pathname.split("/")||[],d=t.pathname&&t.pathname.split("/")||[],k=r.protocol&&!S[r.protocol];if(k&&(r.hostname="",r.port=null,r.host&&(""===x[0]?x[0]=r.host:x.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),b=b&&(""===d[0]||""===x[0])),v)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,x=d;else if(d.length)x||(x=[]),x.pop(),x=x.concat(d),r.search=t.search,r.query=t.query;else if(!l.isNullOrUndefined(t.search)){if(k){r.hostname=r.host=x.shift();var U=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");U&&(r.auth=U.shift(),r.host=r.hostname=U.shift())}return r.search=t.search,r.query=t.query,l.isNull(r.pathname)&&l.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!x.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var I=x.slice(-1)[0],O=(r.host||t.host||x.length>1)&&("."===I||".."===I)||""===I,A=0,C=x.length;C>=0;C--)I=x[C],"."===I?x.splice(C,1):".."===I?(x.splice(C,1),A++):A&&(x.splice(C,1),A--);if(!b&&!_)for(;A--;A)x.unshift("..");!b||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),O&&"/"!==x.join("/").substr(-1)&&x.push("");var P=""===x[0]||x[0]&&"/"===x[0].charAt(0);if(k){r.hostname=r.host=P?"":x.length?x.shift():"";var U=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");U&&(r.auth=U.shift(),r.host=r.hostname=U.shift())}return b=b||r.host&&x.length,b&&!P&&x.unshift(""),x.length?r.pathname=x.join("/"):(r.pathname=null,r.path=null),l.isNull(r.pathname)&&l.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var t=this.host,e=c.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},,,,function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.syncConfig=e.localConfig=void 0;var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},a=r(29),s=i(a),o=r(30),u=i(o),l={uuid:(0,u.default)()},h={shotTime:40},c=e.localConfig=new s.default("local",chrome.storage.sync?l:n({},l,h));e.syncConfig=chrome.storage.sync?new s.default("sync",h):c},function(t,e,r){var i=r(35),n=r(36),a=[r(33)];t.exports=i.createStore(n,a)},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={chunkLifetime:80,dev:!1,hitboxEnabled:!0,logsLimit:60,periscopeEnabled:!0,serverURL:"https://oddshot.tv/",shotTime:40,spawnerRequestTimeout:5e3,useWatchers:!0,validateMetaData:!0,videoCaptureEnabled:!0,vimeoEnabled:!0,youtubeEnabled:!0}},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this._listeners=new Map}return n(t,[{key:"_getListeners",value:function(t){var e=this._listeners.get(t);return e||(e={on:new Set,once:new Set},this._listeners.set(t,e)),e}},{key:"emit",value:function(t){var e=this._listeners.get(t);if(e){var r=e.once;e.once=new Set;for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];var s=!0,o=!1,u=void 0;try{for(var l,h=e.on[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){l.value.apply(void 0,n)}}catch(t){o=!0,u=t}finally{try{!s&&h.return&&h.return()}finally{if(o)throw u}}var c=!0,f=!1,p=void 0;try{for(var d,m=r[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){d.value.apply(void 0,n)}}catch(t){f=!0,p=t}finally{try{!c&&m.return&&m.return()}finally{if(f)throw p}}}}},{key:"on",value:function(t,e){this._getListeners(t).on.add(e)}},{key:"once",value:function(t,e){this._getListeners(t).once.add(e)}},{key:"remove",value:function(t,e){var r=this._listeners.get(t);r&&(r.on.delete(e),r.once.delete(e))}},{key:"when",value:function(t){var e=this,r=void 0,i=new Promise(function(i,n){return r=i,e.once(t,i)});return i.dispose=function(){return e.remove(t,r)},i}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(t){n(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.maxSize=t,r.push=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return Array.prototype.push.apply(this,e),this.length>this.maxSize&&this.splice(0,this.length-this.maxSize),this.length},r.get=function(t){var e=this.length;if(0===e)return null;for(var r=t%e;r<0;)r+=e;return this[r]},r}return s(e,t),e}(Array);e.default=o},function(t,e,r){"use strict";(function(e){function i(t){t=t||e.location||{};var r,i={},n=typeof t;if("blob:"===t.protocol)i=new s(unescape(t.pathname),{});else if("string"===n){i=new s(t,{});for(r in d)delete i[r]}else if("object"===n){for(r in t)r in d||(i[r]=t[r]);void 0===i.slashes&&(i.slashes=f.test(t.href))}return i}function n(t){var e=c.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function a(t,e){for(var r=(e||"/").split("/").slice(0,-1).concat(t.split("/")),i=r.length,n=r[i-1],a=!1,s=0;i--;)"."===r[i]?r.splice(i,1):".."===r[i]?(r.splice(i,1),s++):s&&(0===i&&(a=!0),r.splice(i,1),s--);return a&&r.unshift(""),"."!==n&&".."!==n||r.push(""),r.join("/")}function s(t,e,r){if(!(this instanceof s))return new s(t,e,r);var o,u,c,f,d,m,y=p.slice(),g=typeof e,v=this,b=0;for("object"!==g&&"string"!==g&&(r=e,e=null),r&&"function"!=typeof r&&(r=h.parse),e=i(e),u=n(t||""),o=!u.protocol&&!u.slashes,v.slashes=u.slashes||o&&e.slashes,v.protocol=u.protocol||e.protocol||"",t=u.rest,u.slashes||(y[2]=[/(.*)/,"pathname"]);b<y.length;b++)f=y[b],c=f[0],m=f[1],c!==c?v[m]=t:"string"==typeof c?~(d=t.indexOf(c))&&("number"==typeof f[2]?(v[m]=t.slice(0,d),t=t.slice(d+f[2])):(v[m]=t.slice(d),t=t.slice(0,d))):(d=c.exec(t))&&(v[m]=d[1],t=t.slice(0,d.index)),v[m]=v[m]||(o&&f[3]?e[m]||"":""),f[4]&&(v[m]=v[m].toLowerCase());r&&(v.query=r(v.query)),o&&e.slashes&&"/"!==v.pathname.charAt(0)&&(""!==v.pathname||""!==e.pathname)&&(v.pathname=a(v.pathname,e.pathname)),l(v.port,v.protocol)||(v.host=v.hostname,v.port=""),v.username=v.password="",v.auth&&(f=v.auth.split(":"),v.username=f[0]||"",v.password=f[1]||""),v.origin=v.protocol&&v.host&&"file:"!==v.protocol?v.protocol+"//"+v.host:"null",v.href=v.toString()}function o(t,e,r){var i=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(r||h.parse)(e)),i[t]=e;break;case"port":i[t]=e,l(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="");break;case"hostname":i[t]=e,i.port&&(e+=":"+i.port),i.host=e;break;case"host":i[t]=e,/:\d+$/.test(e)?(e=e.split(":"),i.port=e.pop(),i.hostname=e.join(":")):(i.hostname=e,i.port="");break;case"protocol":i.protocol=e.toLowerCase(),i.slashes=!r;break;case"pathname":i.pathname=e.length&&"/"!==e.charAt(0)?"/"+e:e;break;default:i[t]=e}for(var n=0;n<p.length;n++){var a=p[n];a[4]&&(i[a[1]]=i[a[1]].toLowerCase())}return i.origin=i.protocol&&i.host&&"file:"!==i.protocol?i.protocol+"//"+i.host:"null",i.href=i.toString(),i}function u(t){t&&"function"==typeof t||(t=h.stringify);var e,r=this,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var n=i+(r.slashes?"//":"");return r.username&&(n+=r.username,r.password&&(n+=":"+r.password),n+="@"),n+=r.host+r.pathname,e="object"==typeof r.query?t(r.query):r.query,e&&(n+="?"!==e.charAt(0)?"?"+e:e),r.hash&&(n+=r.hash),n}var l=r(102),h=r(101),c=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,f=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,p=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};s.prototype={set:o,toString:u},s.extractProtocol=n,s.location=i,s.qs=h,t.exports=s}).call(e,r(12))},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t){return new Promise(function(e,r){chrome.tabs.get(t,function(r){chrome.runtime.lastError&&p.default.throw("PopupContext: there is no tab with id "+t,chrome.runtime.lastError),e(r)})})}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=r(11),o=i(s),u=r(3),l=i(u),h=r(18),c=i(h),f=r(0),p=i(f),d=r(1),m=i(d),y=r(24),g=i(y),v=r(44),b=i(v),_="v"+chrome.runtime.getManifest().version_name,w={update:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Promise.all([n(t),b.default.getCaptureInfo(t)]).then(function(r){var i=a(r,2),n=i[0],s=i[1];if(n){var u=g.default.getWatchersForTab(n.id),h=u[0],f=h&&h.getStatus(),d="loading"===n.status,y=u.length+s.videos,v=1!==y||(h?u.length>1||d||f!==l.default.READY:1!==s.videos),b=void 0;if(b=y>1?l.default.getManyStreamsMessage():d&&c.default.getSourceByURL(n.url)?l.default.getLoadingMessage():f?l.default.getStatusMessage(f):l.default.getStatusMessage(s.videos?l.default.READY:null),!h||n.active){var w={dev:m.default.get("dev"),tabId:t,url:n.url,buttonDisabled:v,status:b,version:_,siteSupported:y>0,providers:c.default.getSupportedSites()};return o.default.set("oddshot_popup_context",w),chrome.runtime.sendMessage({event:"update-popup-context",context:w}),w}e&&p.default.log("PopupContext: tab with id="+t+" is not active")}})}};chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(t){chrome.runtime.lastError&&p.default.throw("PopupContext: there is no active tab",chrome.runtime.lastError),t[0]&&w.update(t[0].id)}),chrome.tabs.onActivated.addListener(function(t){w.update(t.tabId)}),e.default=w},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=r(27),s=i(a),o=r(47),u=i(o),l=r(69),h=i(l),c=r(74),f=i(c),p=r(28),d=i(p),m=r(66),y=i(m),g=r(67),v=i(g),b=r(70),_=i(b),w=r(48),S=i(w),x=r(71),k=i(x),U=r(73),I=i(U),O=r(49),A=i(O),C=r(72),P=i(C),T=r(46),E=i(T),B=r(68),F=i(B),L=[s.default,h.default,u.default,I.default,f.default,d.default,y.default,v.default,_.default,S.default,k.default,A.default,P.default,E.default,F.default];e.default={getSources:function(){return[].concat(L)},getSupportedSites:function(){return[s.default,d.default,f.default,u.default,v.default,A.default,E.default].map(function(t){return{displayName:t.displayName,name:t.sourceName,url:t.providerUrl}})},getRequestFilter:function(){var t;return{urls:(t=[]).concat.apply(t,n(L.map(function(t){return t.streamUrls})))}},getSourceByURL:function(t,e,r){var i=!0,n=!1,a=void 0;try{for(var s,o=L[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var u=s.value;if((!e||u.allowEmbeds)&&u.tabUrlRegex.test(t)&&u.recheckTabUrl(t,r))return u}}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}}}},,function(t,e,r){"use strict";function i(t){var e=t.toString().split("\n");if(!e.length||!u(e[0],"#EXTM3U"))throw new Error("Invalid m3u playlist");e=e.slice(1);var r,i,a=0;for(i=0;i<e.length;++i)r=l(e[i]),e[a]=u(r,"#")?n(r):r,e[a]&&++a;return e.length=a,e}function n(t){var e=o(t),r={};return r[s(e[0])]=e.length>1?a(e[1]):void 0,r}function a(t){var e,r,i=h(t.split(c)),n={};for(e=0;e<i.length;++e){if(r=i[e].split(f),1===i.length&&1===r.length)return r[0];n[l(r[0])]=r.length>1?l(r[1]):void 0}return n}function s(t){return u(t,p)?t.slice(p.length):u(t,"#")?t.slice(1):t}function o(t){var e=t.indexOf(":");return e>0?[t.slice(0,e),t.slice(e+1)]:[t]}function u(t,e){return"string"==typeof t&&("function"==typeof t.startsWith?t.startsWith(e):0===t.indexOf(e))}function l(t){return"function"==typeof t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function h(t){for(var e=0,r=0;r<t.length;++r)t[e]=l(t[r]),t[e]&&(e+=1);return t.length=e,t}var c=/,(?=(?:[^"]|"[^"]*")*$)/,f=/="?([^"]*)/,p="#EXT-X-";t.exports=i},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(25),u=(i(o),r(17)),l=i(u),h=r(75),c=i(h),f=r(76),p=i(f),d=r(0),m=i(d),y=r(3),g=i(y),v=r(26),b=i(v),_=r(14),w=i(_),S=r(4),x=i(S),k=r(57),U=i(k),I=r(15),O=i(I),A=r(1),C=i(A),P=r(16),T=i(P),E=r(2),B=r(77),F=i(B),L=function(){function t(e,r,i,a){n(this,t),this.emitter=new w.default,this.viewedTS=new O.default(11),this.tabId=e,this.frameId=r,this.url=i.split(/[#?]/)[0],this.frameUrl=i,this.watcher=a,this._status=g.default.NOT_READY}return s(t,null,[{key:"recheckTabUrl",value:function(t){return!0}},{key:"isChannelBlacklisted",value:function(t){return U.default.indexOf(this.providerId+"/"+t.toLowerCase())>=0}}]),s(t,[{key:"canCaptureStreams",value:function(){var t=this.status;return-1===[g.default.PAUSED,g.default.BLOCKED,g.default.NOT_LIVE,g.default.OFFLINE,g.default.PROTECTED,g.default.BANNED].indexOf(t)}},{key:"canConsumeChunks",value:function(){return this.status!==g.default.NOT_LIVE}},{key:"canWatch",value:function(){var t=this.status;return[g.default.NOT_READY,g.default.READY,g.default.COOLDOWN,g.default.LOADING].indexOf(t)>=0}},{key:"canChangeStatus",value:function(){var t=this.status;return!this.cooldown&&-1===[g.default.BLOCKED,g.default.UNSUPPORTED,g.default.PROTECTED,g.default.BANNED].indexOf(t)}},{key:"canUseStreamInfo",value:function(){return!0}},{key:"shouldClearOnStatusChange",value:function(t){return!0}},{key:"initChatConnection",value:function(){var t=this;this.getChatSocketURL&&this.getChatSocketURL().then(function(e){if(e&&/^wss?:\/\//.test(e)){var r=t.chat=new WebSocket(e);t.chatHistory=new c.default,r.addEventListener("message",function(e){if(t.onChatMessage)try{t.onChatMessage(r,e.data)}catch(t){m.default.error("Problem in parsing chat message",e.data,t.stack)}}),r.addEventListener("open",function(){t.onChatOpen&&t.onChatOpen(r)})}})}},{key:"createChunksQueue",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.stream,i=e.maxIdleTime,n=e.chunkLifetime,a=e.maxShotTime,s=new p.default({stream:r,maxShotTime:a||this.MAX_SHOT_TIME,maxIdleTime:i||this.MAX_IDLE_TIME,chunkLifetime:n||this.CHUNK_LIFETIME});return s.on("clear",function(){return t.clear.apply(t,arguments)}),s.on("change",function(){t.status===g.default.NOT_READY&&t.updateStatus()}),s}},{key:"destroy",value:function(){this.chat&&(this.chat.close(),this.chat=void 0)}},{key:"extractPTS",value:function(){var t=this.getLastViewedChunkURL();return(0,F.default)(t)}},{key:"getConfig",value:function(t){return this.config}},{key:"getCanonicalUrl",value:function(){return this.details&&this.details.host||this.url}},{key:"getChannel",value:function(){return new T.default(this.getCanonicalUrl()).pathname.split("/")[1]}},{key:"getCommonData",value:function(){var t=this.getChannel(),e={streamerName:t,provider:this.constructor.displayName};if(this.details){var r=(0,E.pick)(this.details,["activeViewers","providerStreamerId","streamerAvatarURL","streamerDisplayName","streamerName","subjectName","thumbnailURL","title"]);return(0,E.defaults)(e,r)}return e}},{key:"getMetaData",value:function(){return Promise.resolve({})}},{key:"getViewedStreamURL",value:function(){var t=this;return new Promise(function(e,r){t.details?e(t.viewedURL):(t.emitter.when("streamDetails").then(function(r){e(t.viewedURL||t.url)}),t.watcher.sendMessage({message:"get-details",config:t.config}))})}},{key:"getLastViewedChunkURL",value:function(){return this.viewedTS.get(-1)}},{key:"getPayload",value:function(){return null}},{key:"getPayloadType",value:function(){return null}},{key:"getProviderName",value:function(){return this.constructor.providerName}},{key:"getProviderDisplayName",value:function(){return this.constructor.displayName}},{key:"getStatus",value:function(){return this.status}},{key:"getStatusMessage",value:function(){return g.default.getStatusMessage(this.getStatus())}},{key:"getStatusName",value:function(){return g.default.getStatusName(this.getStatus())}},{key:"getStreamInfoParams",value:function(){return{streamerName:this.getChannel()}}},{key:"getStreamDetails",value:function(){return this.details?Promise.resolve(this.details):this.emitter.when("streamDetails")}},{key:"init",value:function(){var t=this;return this.getViewedStreamURL().then(function(e){return t.isBlacklisted()?(t.status=g.default.BLOCKED,!1):(t.initChatConnection(),!0)})}},{key:"isBlacklisted",value:function(){return this.constructor.isChannelBlacklisted(this.getChannel())}},{key:"refreshStatus",value:function(){this.emitter.emit("status-change",this.isActive()),l.default.update(this.tabId)}},{key:"resolveTabURL",value:function(t){if(!t||"/"!==t[0])return t;var e=new T.default(this.frameUrl);return e.protocol+"//"+e.host+t}},{key:"setStreamDetails",value:function(t,e){var r=this.details,i=t.host=this.resolveTabURL(t&&t.host);this.details=t,r?(t.currentTime&&(t.currentTime=this.parseTime(t.currentTime),r.currentTime!==t.currentTime&&this.updateStatus()),r.host!==i&&(this.clear(),this.log("Channel changed its stream",{host:i,tabUrl:this.url}),this.isBlacklisted()?this.status=g.default.BLOCKED:(this._status=g.default.NOT_READY,this.refreshStatus()),this.lastState=null,this.watcher.update())):this.init(),this.emitter.emit("streamDetails",t)}},{key:"disable",value:function(){var t=this;this.status=g.default.COOLDOWN,this.cooldown=setTimeout(function(){return t.enable()},5e3)}},{key:"enable",value:function(){this.status===g.default.COOLDOWN&&(this.cooldown&&(this.cooldown=clearTimeout(this.cooldown)),this.status=g.default.READY)}},{key:"clear",value:function(t){this.status=g.default.NOT_READY,this.viewedTS.length=0,this.chatHistory&&this.chatHistory.clear(),this.log(t||"Stream cleared due to status change")}},{key:"getCurrentTime",value:function(){return this.details&&this.details.currentTime}},{key:"getTextFile",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x.default.get(t,a({responseType:"text",silent:!0},e))}},{key:"getJSON",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x.default.get(t,a({responseType:"json",silent:!0},e))}},{key:"parseTime",value:function(t){return"number"==typeof t?t:(t&&t.trim().split(":")).reduce(function(t,e){return 60*t+parseInt(e,10)},0)||0}},{key:"updateStatus",value:function(){this.canChangeStatus()&&(this.status=this.isReady()||"active"===this.lastState?g.default.READY:g.default.NOT_READY)}},{key:"findChunkIndexAtCurrentTime",value:function(t){var e=this.getCurrentTime();return this.findChunkIndexAtTime(e,t||this.sourceChunks)}},{key:"findChunkIndexAtTime",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceChunks,r=C.default.get("shotTime"),i=Math.max(r,t)||r,n=0,a=e.findIndex(function(t){return!!t.extInf&&(n+=t.extInf)>=i});return-1===a?e.length-1:a}},{key:"sliceChunksForCurrentTime",value:function(t){var e=this.getCurrentTime();return this.sliceChunksForTime(e,t||this.sourceChunks)}},{key:"sliceChunksForTime",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceChunks,r=C.default.get("chunkLifetime"),i=Math.max(0,Math.min(this.findChunkIndexAtTime(t,e),e.length-1)),n=0,a=i;a>=0&&(n+=e[a].extInf)<=r;a--);return e.slice(a+1,i+1)}},{key:"takeChatHistory",value:function(){return this.chatHistory?this.chatHistory.getHistory():null}},{key:"setState",value:function(t){switch(this.lastState=t,t){case"optout":this.status=g.default.BLOCKED;break;case"banned":this.status=g.default.BANNED;break;case"active":this.status===g.default.NOT_READY&&(this.status=g.default.READY);break;default:this.status!==g.default.READY||this.isReady()||(this.status=g.default.NOT_READY)}}},{key:"setStreamState",value:function(t){if(this.status!==g.default.BLOCKED&&this.status!==g.default.COOLDOWN)switch(this.playerState=t,t){case"loading":b.default.streamLoading(this);break;case"playing":b.default.streamResumed(this);break;case"paused":b.default.streamPaused(this);break;case"offline":b.default.streamOffline(this);break;case"error":b.default.streamError(this);break;case"notLive":b.default.streamNotLive(this)}}},{key:"isReady",value:function(){return!1}},{key:"isActive",value:function(){var t=this.status===g.default.COOLDOWN||this.isOptout(),e=this.status===g.default.READY;return!t&&e}},{key:"isOptout",value:function(){return"optout"===this.lastState||this.status===g.default.BLOCKED}},{key:"log",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.default.log.apply(m.default,["["+this.viewedURL+"]"].concat(e))}},{key:"warn",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.default.warn.apply(m.default,["["+this.viewedURL+"]"].concat(e))}},{key:"error",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];m.default.error.apply(m.default,["["+this.viewedURL+"]"].concat(e))}},{key:"status",get:function(){return this._status},set:function(t){return this._status!==t&&this.canChangeStatus()&&(this._status=t,this.log("Stream changed status to "+g.default.getStatusName(t)),this.refreshStatus()),this._status}},{key:"viewedURL",get:function(){return this.details&&this.details.host||this.url}}]),t}();L.streamUrls=[],e.default=L},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),c=r(21),f=i(c),p=r(0),d=i(p),m=r(50),y=i(m),g=r(3),v=i(g),b=r(26),_=(i(b),r(4)),w=i(_),S=r(15),x=(i(S),r(10),r(2)),k=r(20),U=i(k),I=r(6),O=i(I),A=(0,x.getChunkLifetime)(),C=function(t){function e(t,r,i,n){a(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,i,n));return o.sourceChunks=[],o.viewedChunks=new Map,o}return o(e,t),h(e,[{key:"addSourceChunk",value:function(t){if(!this.canConsumeChunks())return!1;var e=this.sourceChunks;if(0===e.length||e[e.length-1].mediaSequence+1===t.mediaSequence){for(e.push(t),this._lastPushTimestamp=Date.now();0!==e.length&&this.getSourceChunksLength()-e[0].extInf>A;)this.sourceChunks.shift();return this.status!==v.default.NOT_READY||!this.isReady()&&"active"!==this.lastState||(this.status=v.default.READY),!0}if(this.MAX_IDLE_TIME&&this._lastPushTimestamp){Date.now()-this._lastPushTimestamp>this.MAX_IDLE_TIME&&this.clear("Stream cleared due to max idle time")}return!1}},{key:"addViewedChunk",value:function(t){var e=this,r=(t.mediaSequence,t.extInf,t.timestamp),i=t.url;this.viewedChunks.set(i,r),this.emitter.emit("viewedChunkTimestamp:"+i,r),setTimeout(function(){e.viewedChunks.delete(i)},1e3*A)}},{key:"clear",value:function(t){this.sourceChunks.length=0,f.default.prototype.clear.call(this,t)}},{key:"consume",value:function(t){var e=this;if(this.isM3u(t)){var r=[],i=w.default.get(t,{responseType:"text",silent:!0}).then(function(r){e.isSourceM3u(t)&&e.consumeM3u(t,r,!0),e.consumeM3u(t,r,!1)});return r.push(i),!this.isSourceM3u(t)&&this.sourceStreamUrl&&(i=w.default.get(this.sourceStreamUrl,{responseType:"text",silent:!0}).then(function(t){e.consumeM3u(e.sourceStreamUrl,t,!0)}),r.push(i)),Promise.all(r)}return Promise.resolve()}},{key:"consumeM3u",value:function(t,e,r){function i(t,e){switch(t){case"EXT-X-MEDIA-SEQUENCE":l=e.keys().next().value;break;case"EXT-X-TWITCH-ELAPSED-SECS":h=e.keys().next().value;break;case"EXTINF":o=e.keys().next().value}}function n(t,e){if(t)return t;var r=/(?:^|\/)([0-9]+)\.ts$/.exec(e);return r?Number.parseInt(r[1],0)/1e3:void 0}var a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=void 0,u=!0,l=void 0,h=void 0,c=void 0;c=r?function(t){l&&(u&&(u=!1,0!==a.sourceChunks.length&&a.sourceChunks[a.sourceChunks.length-1].mediaSequence+1<l&&a.clear()),a.addSourceChunk({extInf:o,url:t,mediaSequence:l++,timestamp:n(h,t)}),h&&(h+=o))}:function(t){l&&(a.addViewedChunk({extInf:o,url:t,mediaSequence:l++,timestamp:n(h,t)}),h&&(h+=o))},s.push({keyValuesCallback:i,urlCallback:c}),new y.default(s).parse(e,t)}},{key:"findBestChunkIndex",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.sourceChunks,i=r.length-1,n=0;n<r.length;++n)Math.abs(r[n][t]-e)<Math.abs(r[i][t]-e)&&(i=n);return i}},{key:"findBestResolutionFromPlaylist",value:function(t){return("string"==typeof t?this.parsePlaylist(t):Promise.resolve(t)).then(function(t){var e={incoming:!1,width:0,url:null},r=t.reduce(function(t,e){var r=void 0===e?"undefined":l(e);if("object"===r){var i=e["STREAM-INF"];if(i&&"RESOLUTION"in i){var n=parseInt(i.RESOLUTION.split("x")[0],10);(t.incoming=n>t.width)&&(t.width=n)}}else t.incoming&&"string"===r&&(t.incoming=!1,t.url=e);return t},e);return r&&r.url||null})}},{key:"getLastMediaSequence",value:function(){var t=this.sourceChunks&&this.sourceChunks[this.sourceChunks.length-1];return t&&t.mediaSequence}},{key:"getMediaSequenceFromChunkName",value:function(t){var e=t.match(/-(\d+)\-/);return e?parseInt(e[1],10):0}},{key:"getPayload",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.getLastViewedChunkURL(),r=this.viewedChunks.get(e);if(r){var i=this.findBestChunkIndex("timestamp",r);return this.sourceChunks.slice(0,i)}return t||d.default.error("Unable to get the viewed chunk timestamp - shot may not be synchronized."),this.sourceChunks}},{key:"getPayloadType",value:function(){return"hls"}},{key:"getPlaylistHeaders",value:function(t){var e=t.findIndex(function(t){return"object"!==(void 0===t?"undefined":l(t))}),r=t.slice(0,e-1),i={};return r.forEach(function(t){return Object.assign(i,t)}),i}},{key:"getPlaylistChunks",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{url:""},i=[],n=this.getPlaylistHeaders(t),a=function(t,n){var a=void 0===n?"undefined":l(n);if("object"===a)return u({},t,n);if("string"===a&&t.EXTINF){t.mediaSequence||(t.mediaSequence=e.getMediaSequenceFromChunkName(n));var s=parseFloat(t.EXTINF),o=e.resolvePlaylistChunkTimestamp(t,n,s),h={url:O.default.resolve(r.url,n),mediaSequence:t.mediaSequence,timestamp:o,extInf:s};i.push(h),t.mediaSequence++}return t};return t.reduce(a,u({timestamp:0,mediaSequence:parseInt(n["MEDIA-SEQUENCE"],10)||0},r)),i}},{key:"getSourceChunksLength",value:function(){return this.getPayload(!0).reduce(function(t,e){return t+e.extInf},0)}},{key:"isM3u",value:function(t){return/https?:\/\/[^?]*\.m3u8?/.test(t)}},{key:"isReady",value:function(){return this.getSourceChunksLength()>=(0,x.getShotTime)()}},{key:"mapChunkForPayload",value:function(t){return{extInf:t.extInf,mediaSequence:t.mediaSequence,timestamp:t.timestamp,url:t.url}}},{key:"parsePlaylist",value:function(t,e){return this.getTextFile(t,e).then(U.default)}},{key:"resolvePlaylistChunkTimestamp",value:function(t,e,r){var i=t.timestamp;return t.timestamp+=r,i}}]),e}(f.default);e.default=C},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=r(25),o=i(s),u=r(50),l=(i(u),r(0)),h=i(l),c=r(56),f=i(c),p=r(18),d=i(p),m=r(3),y=i(m),g=r(4),v=(i(g),r(1)),b=i(v),_=r(17),w=i(_),S=(r(10),r(2)),x=r(45),k=new Map,U=chrome.i18n,I={delete:function(t){var e=k.get(t);if(e){h.default.log("Going to delete all frames on tab (tabId = "+t+")");var r=!0,i=!1,n=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=a(s.value,2);u[0];u[1].destroy()}}catch(t){i=!0,n=t}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}}return k.delete(t)},findBy:function(t,e){var r=this,i=[],s=[].concat(n(k.keys())),o=s.map(function(t){return r.getWatchersForTab(t)}),u=!0,l=!1,h=void 0;try{for(var c,f=o[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var p=a(c.value,1),d=p[0];d[t]===e&&i.push(d)}}catch(t){l=!0,h=t}finally{try{!u&&f.return&&f.return()}finally{if(l)throw h}}return i},findByURL:function(t){return this.findBy("url",t)},findByInitialURL:function(t){return this.findBy("initialUrl",t)},getFrames:function(t){return k.get(t)},get:function(t,e){var r=this.getFrames(t);return r&&r.get(e)},getBestFrame:function(t){return this.getWatchersForTab(t).sort(function(t,e){return t.source.status-e.source.status})[0]},getWatchersForTab:function(t){var e=this.getFrames(t);return e?[].concat(n(e.values())):[]},getAll:function(){var t,e=this,r=[].concat(n(k.keys())),i=r.map(function(t){return e.getWatchersForTab(t)});return(t=[]).concat.apply(t,n(i))},register:function(){for(var t=this,e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];var n=r.map(function(e){return t.registerFrame(e,0)});return Promise.all(n)},registerFrame:function(t,e){var r=this;return new Promise(function(i,n){chrome.webNavigation.getFrame({tabId:t.id,frameId:e},function(n){if(r.unregisterFrame(t,e),!n)return i(null);var a=d.default.getSourceByURL(n.url,0!==e,t.url);if(a){var s=new f.default(a,t.id,e,n.url),o=k.get(t.id)||new Map;o.set(e,s),k.set(t.id,o),h.default.log('Registered frame with id "'+s.id+'" and url "'+n.url+'"'),s.executeContentScript().then(function(){return s.init()}).catch(function(t){h.default.throw("Error occurred during frame initialization (id = "+s.id+"):",t),o.delete(e)}).then(function(){return i()})}else i()})})},unregisterFrame:function(t,e){var r=k.get(t.id),i=r&&r.get(e);i&&(h.default.log("Unregistered frame with id = "+i.id+" and url = "+i.url),i.destroy(),r.delete(e),t.size||k.delete(t.id))},tabUpdate:function(t,e){var r=this.previousChange,i=this.previousUrl,n=this.get(t.id,0);if(this.previousChange=e,this.previousUrl=t.url,n){if("function"==typeof n.source.onTabUpdate){var a=n.source.onTabUpdate(e);return"unregister"===a&&this.delete(t.id),a}if(e.url&&e.url!==n.initialUrl&&(n.urlChanged=!0),n.urlChanged){if("loading"===e.status)return this.delete(t.id)}else if("complete"===e.status)return}return h.default.debug("New change info: ",e,"tab.url",t.url),"complete"!==e.status||r&&"complete"===r.status&&i===t.url?null:this.register(t).then(function(){w.default.update(t.id)})},reset:function(){var t=!0,e=!1,r=void 0;try{for(var i,n=watchers[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=a(i.value,2);s[0];s[1].source.lastState=null}}catch(t){e=!0,r=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw r}}},takeShot:function(t,e){if(!t||!t.source.isActive())return o.default.show(y.default.getStatusMessage(t&&t.getStatus())),!1;var r=t.source,i=[(0,S.getUUID)(),t.getMetaData(),t.extractPTS(),t.getPayload(),t.getPayloadType(),r.getViewedStreamURL()];return r.disable(),h.default.time("Got meta data and PTS number in"),Promise.all(i).then(function(i){var n=a(i,6),s=n[0],u=n[1],l=n[2],c=n[3],f=n[4],p=n[5];h.default.timeEnd("Got meta data and PTS number in");var d={eventType:e,payload:c,payloadType:f,pts:l,streamData:u,user:s,stream:p,chat:r.takeChatHistory(),pluginVersion:chrome.runtime.getManifest().version};return h.default.time("Shoot taken in"),(0,x.spawnerCall)("shoot",d).then(function(t){if(h.default.timeEnd("Shoot taken in"),!t.url)throw t.error;try{chrome.tabs.create({url:t.url,active:!1}),ga("send","event",{eventCategory:"Shot",eventAction:e,eventLabel:r.getProviderDisplayName()})}catch(t){}o.default.clearAll()}).catch(function(e){t.update(),r.setState("inactive"),r.enable(),b.default.isDev()&&e.status?o.default.show(U.getMessage("error"),e.statusText+" ("+e.status+")"):o.default.show(U.getMessage("error"),U.getMessage("failedRetrievingShotData"))})}).catch(function(t){throw h.default.throw(t),o.default.show(U.getMessage("providerNotResponds",[r.constructor.displayName]),U.getMessage("invalidMetaData")),t})},setStreamState:function(t,e){t.setStreamState(e)},dump:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.getAll(),r={};console.time("dump took");var i=e.map(function(e){return Promise.all([e.id,e.source.frameUrl,e.source.getViewedStreamURL(),e.source.getChannel(),e.getPayload(),e.getPayloadType(),t&&e.getMetaData(),e.source.getStreamDetails(),e.getStatus(),e.getStatusName(),e.getStatusMessage(),e.source.playerState,e.source.getProviderDisplayName(),e.source.lastState,e.source.isReady(),e.source.isActive()]).then(function(t){var e=a(t,16),i=e[0],n=e[1],s=e[2],o=e[3],u=e[4],l=e[5],h=e[6],c=e[7],f=e[8],p=e[9],d=e[10],m=e[11],y=e[12],g=e[13],v=e[14],b=e[15];r[i]={id:i,frameUrl:n,viewedUrl:s,channel:o,payload:u,payloadType:l,streamData:h,details:c,status:f,statusName:p,statusMessage:d,playerState:m,providerDisplayName:y,watchingState:g,isReady:v,isActive:b}})});return Promise.all(i).then(function(){return h.default.log("Dump from all video sources:",r),console.timeEnd("dump took"),r}).catch(function(t){return h.default.throw("Cannot make a dump",t),console.timeEnd("dump took"),null})}};window.dump=I.dump.bind(I),e.default=I},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=0,a={};e.default={show:function(t,e){"object"===(void 0===t?"undefined":i(t))&&(e=t.message,t=t.title);var r={type:"basic",title:t,message:e,iconUrl:"icon.png"},s=""+n++;a[e]&&chrome.notifications.clear(a[e]),a[e]=s,chrome.notifications.create(s,r,function(){})},clearAll:function(){chrome.notifications.getAll(function(t){if(t instanceof Array){var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;chrome.notifications.clear(s)}}catch(t){r=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw i}}}else for(var o in t)chrome.notifications.clear(o)})}}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),a=i(n),s=r(3),o=i(s);chrome.i18n;e.default={streamPaused:function(t){t&&t.status!==o.default.PAUSED&&(t.shouldClearOnStatusChange(o.default.PAUSED)&&t.clear(),t.status=o.default.PAUSED,a.default.log("Shots: stream paused",{tabId:t.tabId,url:t.url}))},streamResumed:function(t){var e=t&&t.status;if(e===o.default.PAUSED||e===o.default.LOADING||e===o.default.OFFLINE||e===o.default.NOT_LIVE){var r=t.isReady()||"active"===t.lastState?o.default.READY:o.default.NOT_READY;t.shouldClearOnStatusChange(r)&&t.clear(),t.status=r,a.default.log("Shots: stream resumed",{tabId:t.tabId,url:t.url})}},streamLoading:function(t){t&&t.status!==o.default.LOADING&&(t.shouldClearOnStatusChange(o.default.LOADING)&&t.clear(),t.status=o.default.LOADING,a.default.log("Shots: stream is loading",{tabId:t.tabId,url:t.url}))},streamOffline:function(t){t&&t.status!==o.default.OFFLINE&&(t.shouldClearOnStatusChange(o.default.OFFLINE)&&t.clear(),t.status=o.default.OFFLINE,a.default.log("Shots: stream seems to be offline",{tabId:t.tabId,url:t.url}))},streamError:function(t){t&&(t.clear(),t.status=o.default.NOT_READY)},streamNotLive:function(t){t&&t.status!==o.default.NOT_LIVE&&(t.clear(),t.status=o.default.NOT_LIVE)},validate:function(t,e){var r=t.validators;if(r)for(var i in r){var n=r[i],s=Array.isArray(n)?n:[n],o=!0,u=!1,l=void 0;try{for(var h,c=s[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var f=h.value;if(!f(e[i]))return a.default.error("Shots: invalid metadata, missing "+i,{key:i,value:e[i],url:t.url}),!1}}catch(t){u=!0,l=t}finally{try{!o&&c.return&&c.return()}finally{if(u)throw l}}}return!0}}},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),p=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},d=r(22),m=i(d),y=r(3),g=i(y),v=r(0),b=i(v),_=r(43),w=(i(_),r(4)),S=i(w),x=r(2),k=r(32),U=i(k),I=r(20),O=(i(I),r(11)),A=i(O),C=r(6),P=i(C),T=chrome.i18n,E=new Set(["jzkbprff40iqj646a697cyrvl0zt2m6",A.default.get("oddshot_clientID")||"jzkbprff40iqj646a697cyrvl0zt2m6"]),B=void 0,F=new Set(["login","logout","team","directory","jobs","store","subscriptions"]),L=function(t){function e(){var t,r,i,n;s(this,e);for(var a=arguments.length,u=Array(a),l=0;l<a;l++)u[l]=arguments[l];return r=i=o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),i.MAX_IDLE_TIME=3e4,i.streamUrlRegex=/^https?:\/\/(.*\.ttvnw\.net|(usher|api)\.twitch\.tv|.*\.hls\.twitch\.tv)\//i,i.isPlayerInFrame=!1,n=r,o(i,n)}return u(e,t),f(e,[{key:"getConfig",value:function(t){this.getPlayerConfig(t);return{player:this.getPlayerConfig(t),streamDetails:this.getStreamDetailsConfig(t),shotIcons:[e.getShotIconConfig("#7d5bbe","#2c2541",".channel-info-bar__action-container .flex:last-child, .cn-metabar"),e.getShotIconConfig("#b19dd8","#efeef1",".video-player-hosting-ui__footer .justify-content-between > .flex, .host-frame .js-channel-options"),{id:"player",tagName:"button",className:"player-button",children:["tooltip","svg"],insertBefore:".player-button--clips, .player-button--chromecast, .qa-theatre-mode-button, .qa-fullscreen-button, .player-button--twitch",parent:{selector:".player .player-buttons-right"},attributes:{type:"button"},style:{width:"3em",height:"4em",paddingBottom:"1em",float:"left",textAlign:"center",cursor:"pointer"},nodes:{tooltip:{tagName:"span",className:"player-tip js-tip",attributes:{"data-tip":T.getMessage(this.status===g.default.READY?"takeShot":"notReadyStatusTitle")}},svg:{fill:"#fff",attributes:{viewBox:"-2.5 -4 20 30"},style:{opacity:"1"}}},inactive:{nodes:{svg:{style:{opacity:"0.3"}}}},focused:{nodes:{svg:{fill:"#a991d4"}}}}]}}},{key:"getPlayerConfig",value:function(t){return this.isPlayerInFrame&&t===this.frameId?null:{node:{selector:"#player .player, #video-1, .player"},order:["offline","notLive","loading","paused","playing"],paused:{matches:'[data-paused="true"]'},playing:{matches:'[data-paused="false"]'},loading:{matches:'[data-loading="true"]'},offline:{matches:'[data-ended="true"], [data-error="true"]'},notLive:{matches:'[data-online="false"]'}}}},{key:"getStreamDetailsConfig",value:function(t){return this.isPlayerInFrame&&t!==this.frameId?null:{activeViewers:{reader:"number",selector:['[data-a-target="channel-viewers-count"] .tw-stat__value',".cn-metabar .cn-metabar__livecount"]},streamerAvatarURL:{attribute:"src",selector:[".channel-header__user-avatar img",".cn-tabs img.cn-bar__avatar, .cn-bar img.cn-bar__avatar"]},subjectName:{selector:['.tw-card [data-a-target="stream-game-link"]','.cn-metabar .card__info a[data-tt_content="current_game"], .cn-metabar a[data-tt_medium="twitch_channel"]:nth-child(2)']},host:{attribute:"href",selector:["a.video-player-hosting-ui__link:not(:empty)",'#channel a[data-tt_content="host_channel"]']},hostChannel:{selector:["a.video-player-hosting-ui__link .video-player-hosting-ui__channel-name",'#channel a[data-tt_content="host_channel"]']},title:{reader:"textChildNodes",selector:['.tw-card [data-a-target="stream-title"]',".cn-metabar .card__title, .cn-metabar .js-card__title"]},streamerProfileUrl:{attribute:"href",selector:["a.channel-header__user",".js-directory a.cn-tabs__profile, .cn-bar a.cn-tabs__profile"]}}}},{key:"canConsumeSource",value:function(){var t=this.status;return-1===[g.default.BLOCKED,g.default.NOT_LIVE,g.default.OFFLINE,g.default.BANNED].indexOf(t)}},{key:"shouldClearOnStatusChange",value:function(t){return t===g.default.OFFLINE}},{key:"getViewedStreamURL",value:function(){return"https://twitch.tv/"+this.getChannel()}},{key:"consume",value:function(t){var e=P.default.parse(t,!0);if(/\.m3u8$/.test(e.pathname)){var r=this.getBIDFromUrl(e);this.source&&r&&r!==this.source.bid&&(this.source={},this.log("Stream BID changed from "+this.source.bid+" to "+e.query.bid))}}},{key:"consumeSource",value:function(){var t=this,r=this.source;return this.canConsumeSource()?r&&r.url?this.parsePlaylist(r.url).then(function(r){var i=function(r,i){var n=void 0===i?"undefined":c(i);if("object"===n)if(i.EXTINF)r.extInf=e.resolveExtInf(i.EXTINF);else{var a=i["TWITCH-ELAPSED-SECS"]||i["EXT-X-TWITCH-ELAPSED-SECS"],s=i["MEDIA-SEQUENCE"]||i["EXT-X-MEDIA-SEQUENCE"];a&&(r.timestamp=parseFloat(a)),s&&(r.mediaSequence=+s)}else if("string"===n){var o=t.getChunk(i,r.timestamp,r.extInf,++r.mediaSequence);o&&(t.addSourceChunk(o),r.timestamp+=r.extInf)}return r};r.reduce(i,{timestamp:0,extInf:4})}):this.getSource().then(function(){return t.consumeSource()}):null}},{key:"destroy",value:function(){m.default.prototype.destroy.call(this),this._consumeSourceInterval=clearInterval(this._consumeSourceInterval)}},{key:"getChunk",value:function(t,e,r,i){return this.source&&this.source.url?{timestamp:e,extInf:r,mediaSequence:i,url:P.default.resolve(this.source.url,t)}:null}},{key:"getMediaSequenceFromUrl",value:function(t){try{var e=P.default.parse(t).pathname.split("/").pop(),r=e.match(/\-(\d+)\-/);return parseInt(r[1],10)}catch(t){return null}}},{key:"getBIDFromUrl",value:function(t){var e=t&&"object"===(void 0===t?"undefined":c(t))?t:P.default.parse(t,!0),r=/\bbid=(\d+)\b/i.exec(e.query.token);return r&&r[1]}},{key:"getChatSocketURL",value:function(){return Promise.resolve("wss://irc-ws.chat.twitch.tv/")}},{key:"getChannelData",value:function(){var t=this.getChannel();return t?e.apiCall("channels/"+t).then(function(t){return{title:t.status,providerStreamerId:t._id,streamerDisplayName:t.display_name,streamerName:t.name,subjectName:t.game,streamerAvatarURL:t.logo,languageCode:[t.broadcaster_language,t.language]}}):Promise.reject("Channel not found for url "+this.url)}},{key:"getStreamData",value:function(){var t=this.getChannel();return t?e.apiCall("streams/"+t).then(function(t){var e=t.stream;return e?{activeViewers:e.viewers,thumbnailURL:e.preview&&e.preview.large}:{}}):Promise.reject("Channel not found for url "+this.url)}},{key:"getCommonData",value:function(){return h({},p(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getCommonData",this).call(this),{clientID:B})}},{key:"getLastViewedChunkURL",value:function(){return this.viewedTS.get(-3)}},{key:"getLastViewedMediaSequence",value:function(){var t=this.getLastViewedChunkURL();return t&&this.getMediaSequenceFromUrl(t)}},{key:"getMetaData",value:function(){var t=[this.getChannelData(),this.getStreamData()];return Promise.all(t).then(function(t){var e=l(t,2),r=e[0],i=e[1],n=h({},i,r);return b.default.log("Twitch: received metadata from API",n),n})}},{key:"getPayload",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.getLastViewedMediaSequence();if(e){var r=this.findBestChunkIndex("mediaSequence",e);return this.sourceChunks.slice(0,r)}return t||b.default.error("Unable to get the viewed chunk timestamp - shot may not be synchronized"),this.sourceChunks}},{key:"getSource",value:function(){var t=this;return this.getUsherUrl().then(function(e){return t.findBestResolutionFromPlaylist(e)}).then(function(e){var r=t.getBIDFromUrl(e);return t.source={url:e,bid:r}})}},{key:"getUsherUrl",value:function(){var t=this.getChannel().toLowerCase();return(0,x.dontGiveUp)(function(){return e.getToken(t).then(function(e){var r=U.default.stringify({token:e.token,sig:e.sig,allow_source:!0,allow_spectre:!0,player_backend:"html5",p:Math.floor(999999*Math.random()),baking_bread:!0});return"https://usher.ttvnw.net/api/channel/hls/"+t+".m3u8?"+r})},2)}},{key:"init",value:function(){var t=this;this._consumeSourceInterval=setInterval(function(){return t.consumeSource()},3500),this.consumeSource(),this.executeScriptOnPlayerFrame().then(function(e){t.isPlayerInFrame=e})}},{key:"executeScriptOnPlayerFrame",value:function(){var t=this;return(0,x.dontGiveUp)(function(){return new Promise(function(e,r){setTimeout(function(){chrome.webNavigation.getAllFrames({tabId:t.tabId},function(i){var n=!0,a=!1,s=void 0;try{for(var o,u=i[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value;if("player.twitch.tv"===P.default.parse(l.url).host)return t.watcher.executeContentScript(l.frameId),e(!0)}}catch(t){a=!0,s=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}r()})},200)})}).catch(function(){return!1})}},{key:"isSourceM3u",value:function(t){return/https?:\/\/.*ttvnw\.net\/.*\/chunked\/py-index-live\.m3u8/.test(t)}},{key:"onChatMessage",value:function(t,e){if(e.startsWith("@")&&e.indexOf(" PRIVMSG ")>=0){var r=this.parseChatMessage(e.substr(1));this.chatHistory.add(r)}else e.startsWith("PING")&&t.send("PONG")}},{key:"onChatOpen",value:function(t){var e=this.getChannel().toLowerCase(),r=Math.floor(999999*Math.random());t.send("CAP REQ :twitch.tv/tags twitch.tv/commands"),t.send("PASS blah"),t.send("NICK justinfan"+r),setTimeout(function(){return t.send("JOIN #"+e)},300)}},{key:"parseChatTags",value:function(t){t=t.trim()+" ";var e=t.indexOf(" "),r=t.slice("@"===t.charAt(0)?1:0,e).split(";"),i={},n=!0,a=!1,s=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value,h=l.indexOf("="),c=l.slice(0,h),f=l.slice(h+1);-1===h?i[c]=!0:/^[0-9]+$/.test(f)?i[c]=parseInt(f,10):(f=f.replace(/\\:/g,";").replace(/\\s/g," ").replace(/\\\\/g,"\\").replace(/\\r/g,"\r").replace(/\\n/g,"\n"),i[c]=f)}}catch(t){a=!0,s=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}return i}},{key:"parseChatMessage",value:function(t){var e=t.slice(0,-1).split("@"),r=this.parseChatTags(e[0]),i=e[1].substr(e[1].indexOf(":")+1);return e.length>2&&(i+="@"+e.slice(2).join("@")),{author:r["display-name"],color:r.color,message:i}}}],[{key:"recheckTabUrl",value:function(t){var e=P.default.parse(t).pathname.split("/");return e[1]&&!F.has(e[1].toLowerCase())&&!e[2]}},{key:"apiCall",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.getClientIDs(),r="https://api.twitch.tv/kraken/"+t;return b.default.log("Twitch: getting data from API "+t),(0,x.dontGiveUp)(function(t){return B=e[e.length-t],S.default.get(r,{timeout:3e3,headers:{"Client-ID":B}})},e.length)}},{key:"getToken",value:function(t){var e=this.getClientIDs();return(0,x.dontGiveUp)(function(r){return S.default.get("https://api.twitch.tv/api/channels/"+t+"/access_token",{params:{adblock:!1,need_https:!0,platform:"web",player_type:"site"},headers:{"Client-ID":e[e.length-r]}})})}},{key:"resolveExtInf",value:function(t){var e="object"===(void 0===t?"undefined":c(t))?Object.keys(t).shift():t;return parseFloat(e)}},{key:"getClientIDs",value:function(){return[].concat(a(E))}},{key:"getShotIconConfig",value:function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return h({children:["svg","label"],insertBefore:".mg-x-1, .cn-metabar__more .ember-view",parent:{selector:r},style:{display:"inline-flex",alignItems:"center",margin:"0 10px 0 20px",background:"transparent",opacity:"1",color:t,cursor:"pointer"},nodes:{svg:{fill:"currentColor",attributes:{width:20,height:25},style:{display:"inline-block",verticalAlign:"middle",margin:"1px 0 0"}},label:{tagName:"span",textContent:T.getMessage("takeShot"),style:{display:"inline-block",verticalAlign:"middle",marginBottom:"-1px",pointerEvents:"none"}}},inactive:{style:{opacity:"0.4"}},focused:{style:{color:e},nodes:{svg:{fill:e}}}},i)}}]),e}(m.default);L.sourceName="twitch",L.providerId="twitch.tv",L.providerName="Twitch",L.providerUrl="https://twitch.tv/",L.displayName="Twitch",L.streamUrls=["*://*.ttvnw.net/*","*://usher.twitch.tv/*","*://*.twitch.tv/*","*://*.justin.tv/*","*://*.akamaized.net/*"],L.tabUrlRegex=/^https?:\/\/(www\.)?(go\.)?twitch\.tv\/./i,chrome.webRequest.onSendHeaders.addListener(function(t){if(t.tabId>=0&&/access_token/.test(t.url)){var e=t.requestHeaders.find(function(t){return"Client-ID"===t.name});e&&e.value&&(E.add(e.value),E.size>1&&A.default.set("oddshot_clientID",e.value))}},{urls:["*://api.twitch.tv/*"]},["requestHeaders"]),e.default=L},function(t,e,r){"use strict";function i(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t){if(!t)return{};var e=t.split("/");return e.filter(function(t,e){return!(e%2)}).reduce(function(t,r,i){return t[r]=e[2*i+1],t},{})}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},f=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},p=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),d=r(6),m=n(d),y=r(97),g=r(1),v=n(g),b=r(4),_=n(b),w=r(21),S=n(w),x=r(3),k=n(x),U=r(0),I=n(U),O=r(2),A=chrome.i18n,C=/(?!)/,P=v.default.get("youtubeEnabled"),T=function(){function t(e,r){if(o(this,t),r)this.from=e,this.to=r;else{var i=e.match(/(\d+)\-(\d+)/);this.from=i&&parseInt(i[1],10),this.to=i&&parseInt(i[2],10)}}return p(t,[{key:"isValid",value:function(){return this.from>=0&&this.to>=0&&"number"==typeof this.from&&"number"==typeof this.to}},{key:"toString",value:function(){return this.from+"-"+this.to}}]),t}(),E=function(t){function e(t,r,i,n){o(this,e);var s=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,i,n));return s.MAX_IDLE_TIME=3e4,s.MAX_SHOT_TIME=55,s.CHUNK_LIFETIME=1/0,s.streamUrlRegex=/^https?:\/\/(.*\.)?googlevideo\.com\/videoplayback\?/i,s.url=i,s.source={},s.audioChunks=s.createChunksQueue({stream:O.AUDIO_STREAM}),s.videoChunks=s.createChunksQueue({stream:O.VIDEO_STREAM}),s.shouldWatchStream=!1,s}return s(e,t),p(e,null,[{key:"apiCall",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],r="https://www.googleapis.com/youtube/v3/"+t;return I.default.log("YouTube: getting data from API "+t),_.default.get(r,{params:c({key:"AIzaSyBDBi-4roGzWJN4du9TuDMLd_jVTcVkKz4"},e),timeout:2500})}},{key:"recheckTabUrl",value:function(t){var e=m.default.parse(t,!0);return!!e.query.v||/.+\/live\/?$/.test(e.pathname)}}]),p(e,[{key:"getChannel",value:function(){return m.default.parse(this.details&&this.details.host||this.url,!0).query.v||this.details&&this.details.videoId}},{key:"genChannel",value:function(){var t=this;return this.getStreamDetails().then(function(){return t.getChannel()})}},{key:"getRepresentationsFromMpd",value:function(t,e){var r=this,i=new DOMParser,n=i.parseFromString(t,"text/xml");return e.map(function(t){var e=Array.apply(null,n.querySelectorAll('AdaptationSet[mimeType="'+t+'"] Representation'));return r.findBestRepresentation(e)})}},{key:"getSignatureFromUrl",value:function(t){var e=t.match(/\/s\/([^\/]+)\//i);return e&&e[1]}},{key:"getSqFromUrl",value:function(t){var e="object"===(void 0===t?"undefined":h(t))?t:m.default.parse(t,!0);if(e.query.sq)return parseInt(e.query.sq,10);var r=/\/sq\/(\d+)\//.exec(e.pathname);return r&&r[1]?parseInt(r[1],10):null}},{key:"getSource",value:function(){var t=this,e=this.getChannel();return this.getTextFile("https://www.youtube.com/get_video_info?video_id="+e+"&el=embedded").then(function(e){var r=m.default.parse("?"+e,!0),i=r.query;if("fail"===i.status)throw new Error("YT API query failed, response: "+JSON.stringify(i));var n="1"===i.live_playback,a=n?14400:1/0;if("True"===i.use_cipher_signature)throw new Error('Parameter "use_cipher_signature" = True');return[t.audioChunks,t.videoChunks].map(function(t){return t.setChunkLifetime(a)}),{type:"mp4",url:i.dashmpd,live:n}}).catch(function(e){return t.warn("Video is protected or cannot be parsed:",e),t.status=k.default.PROTECTED,{type:"mp4"}})}},{key:"init",value:function(){var t=this;return this.getSource().then(function(e){if(t.source=e,chrome.tabs.executeScript(t.tabId,{file:"clients/youtube.js",frameId:t.watcher.frameId,matchAboutBlank:!0}),!e||!e.url)return t.status=k.default.OFFLINE,void I.default.warn("[YouTube] stream '"+t.url+"' seems to be offline.");I.default.log("[YouTube] found source "+e.type.toUpperCase()+" playlist: "+e.url),e.live&&(t._consumeSourceInterval=clearInterval(t._consumeSourceInterval)||setInterval(function(){return t.consumeSource(t.source)},3500)),t.consumeSource(e)})}},{key:"canCaptureStreams",value:function(){var t=this.status;return this.source&&t!==k.default.OFFLINE}},{key:"canWatch",value:function(){return f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"canWatch",this).call(this)&&!1!==this.shouldWatchStream}},{key:"consumeSource",value:function(t){var e=this;return this._consumePromise=this._consumePromise||this.getTextFile(t.url).then(function(r){var i=e.getRepresentationsFromMpd(r,["video/mp4","audio/mp4"]),n=l(i,2),a=n[0],s=n[1];return e.shouldWatchStream=t.live&&a.segments.length<20,Promise.all([e.consumeChannel(a,O.VIDEO_STREAM,e.videoChunks),e.consumeChannel(s,O.AUDIO_STREAM,e.audioChunks)])}).then(function(){e._consumePromise=null})}},{key:"consumeChannel",value:function(t,e,r){var i=this,n=this.getIndexSegmentUrl(t),a=this.getChannel(),s="#id="+a+"&live="+this.source.live;if(!n){var o=t.segments,u=t.init,l=u||this.createSegmentUrl(t.url,{sq:0});r.setInitChunk({url:""+l+s,init:!0,stream:e,timestamp:null,mediaSequence:0});var h=function(n,a,s){var o={extInf:parseFloat(a.dur),mediaSequence:parseInt(a.sq,10),timestamp:i.source.live?parseInt(a.lmt,10)/1e6:n.timestamp,url:i.createSegmentUrl(t.url,a),stream:e};return r.push(o),n.timestamp+=o.extInf,n},c=r.last,f=c&&c.mediaSequence,p=f&&(0,O.findLastIndex)(o,function(t){return t.sq===String(f)})||0;return(p>0?o.slice(p):o).reduce(h,{timestamp:0}),Promise.resolve(r)}return this.getTextFile(n,{responseType:"arraybuffer"}).then(function(n){return new Promise(function(a,o){var u=new y.MP4Box,l=setTimeout(function(){return o("Cannot read and parse MP4 index")},3e3);u.onReady=function(n){clearTimeout(l);var o=i.findSidxBox(u),h=o.timescale;r.setInitChunk({url:i.createSegmentUrl(t.url,{range:t.initRange})+s,init:!0,stream:e,timestamp:null});var c=function(n,a,s){var u=a.subsegment_duration/h,l=new T(n.rangeFrom,n.rangeFrom+a.referenced_size-1),c={extInf:u,timestamp:n.timestamp,url:i.createSegmentUrl(t.url,{range:l}),stream:e};return r.push(c),{timestamp:c.timestamp+c.extInf,rangeFrom:l.to+o.first_offset+1}};o.references.reduce(c,{timestamp:0,rangeFrom:t.indexRange.to+1}),i.log('MP4 "'+e+'" playlist has been parsed, last chunk:',r.last),a(r)},u.onError=function(e){clearTimeout(l),I.default.throw("Cannot read MP4 file from source",t,e),o(e)},n.fileStart=0,u.appendBuffer(n),u.flush()})})}},{key:"createSegmentUrl",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=m.default.parse(t,!0),i=Object.keys(e);if("/"===t[t.length-1]){return""+t+i.filter(function(t){return-1===r.pathname.indexOf("/"+t+"/")}).map(function(t){return t+"/"+encodeURIComponent(e[t])}).join("/")}return t+"&"+i.filter(function(t){return null==r.query[t]}).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}},{key:"getIndexSegmentUrl",value:function(t){if(t.useRanges){var e=new T(0,t.indexRange.to);return this.createSegmentUrl(t.url,{range:e})}return null}},{key:"destroy",value:function(){S.default.prototype.destroy.call(this),this._consumeSourceInterval=clearInterval(this._consumeSourceInterval)}},{key:"findBestRepresentation",value:function(t){var e=function(t,e){var r=t?parseInt(t.getAttribute("bandwidth"),10):0;return parseInt(e.getAttribute("bandwidth"),10)>r?e:t},r=t.find(function(t){return"1080"===t.getAttribute("height")})||t.reduce(e)||t[t.length-1],i=r.querySelector("Initialization"),n=r.querySelector("SegmentBase")||r.querySelector("SegmentURL"),a=i&&(i.getAttribute("range")||i.getAttribute("sourceURL")),s=i&&new T(a),o=s&&this.findIndexRange(s,n);if(o&&s.isValid()&&o.isValid())return{useRanges:!0,url:r.querySelector("BaseURL").textContent,initRange:s,indexRange:o};var l=r.querySelector("BaseURL").textContent,h=u(l.replace(/^.*\/videoplayback\//,""));return{useRanges:!1,url:l,segments:Array.apply(null,r.querySelectorAll("SegmentURL")).map(function(t){var e=u(t.getAttribute("media"));return c({dur:h.dur},e)}),init:a}}},{key:"findIndexRange",value:function(t,e){var r=e.getAttribute("indexRange");if(r)return new T(r);var i=new T(e.getAttribute("media"));return new T(t.to+1,i.from-1)}},{key:"findSidxBox",value:function(t){return t.inputIsoFile.boxes.find(function(t){return"sidx"===t.type})}},{key:"getChunkFromUrl",value:function(t){var e=m.default.parse(t,!0),r=t.match(/\/sq\/(\d+)\/.*\blmt=(\d+)\b/);if(r&&r[1]){var i=parseInt(r[2],10);return{mediaSequence:parseInt(r[1],10),extInf:parseFloat(e.query.dur),timestamp:Math.round(i/1e3),url:t}}I.default.error("Cannot parse chunk url: "+t)}},{key:"getInitChunk",value:function(t){var e=this[t+"Chunks"],r=e&&e[0];return r&&r.init?r:null}},{key:"getInitChunks",value:function(){return[this.getInitChunk("audio"),this.getInitChunk("video")].filter(function(t){return!!t})}},{key:"getStreamInfoParams",value:function(){return this.getVideoData().then(function(t){return{streamerName:t.streamerName,providerStreamerId:t.providerStreamerId}})}},{key:"getVideoData",value:function(){var t=this;return this.genChannel().then(function(t){var r={id:t,part:"snippet,liveStreamingDetails",maxResults:1};return e.apiCall("videos",r)}).then(function(e){var r=e.items;if(!r||0===r.length)throw new Error("Channel details cannot be found for '"+channel+"'");var i=r[0];if(!i||!i.snippet)throw new Error("Couldn't fetch requested video info data",i);var n=i.snippet,a=i.liveStreamingDetails,s=n.defaultAudioLanguage;return{title:n.title,providerStreamerId:n.channelId,streamerName:n.channelTitle,activeViewers:a&&parseInt(a.concurrentViewers,10)||null,thumbnailURL:t.getThumbnailUrlFromSnippet(n),languageCode:[s?s.substring(0,2):null],tags:n.tags||[]}})}},{key:"getChannelData",value:function(t){var r={id:t,part:"snippet",maxResults:1};return e.apiCall("channels",r).then(function(e){var r=e.items;if(!r||0===r.length)throw new Error("Channel details cannot be found for '"+t+"'");var i=l(r,1),n=i[0],a=n.snippet,s=a.thumbnails;return{streamerAvatarURL:s.high.url||s.default.url}})}},{key:"getMetaData",value:function(){var t=this;return this.getVideoData().then(function(e){return t.getChannelData(e.providerStreamerId).then(function(t){return c({},e,t)})})}},{key:"getCurrentMediaSequence",value:function(){var t=this.details&&this.details.mediaSequence;return isNaN(t)?null:parseInt(t,10)+1}},{key:"getCurrentTime",value:function(){var t=this.details&&this.details.currentTime;return isNaN(t)?null:parseFloat(t)}},{key:"getPlayerTime",value:function(){var t=this.details&&this.details.playerTime;return isNaN(t)?null:parseFloat(t)}},{key:"getPayload",value:function(){var t=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Promise.resolve(this._consumePromise).then(function(){var e=[t.audioChunks.getInitChunk(),t.videoChunks.getInitChunk()].filter(function(t){return t}),r=t.trimChunks(),i=l(r,2);return[].concat(e,i[0],i[1])})}},{key:"getPayloadType",value:function(){return this.source.type}},{key:"getProviderDisplayName",value:function(){return this.source.live?"YouTube Live":"YouTube VOD"}},{key:"getThumbnailUrlFromSnippet",value:function(t){var e=t&&t.thumbnails;if(e){var r=["maxres","high","standard","medium","default"],i=r.find(function(t){return e[t]&&e[t].url});return i?e[i].url:null}return null}},{key:"isReady",value:function(){var t=this.getPayloadType();return"hls"===t?f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"isReady",this).call(this):"mp4"===t&&(this.audioChunks.length>0||this.videoChunks.length>0)}},{key:"setStreamState",value:function(t){if(this.status!==k.default.NOT_LIVE)return f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setStreamState",this).call(this,t)}},{key:"trimChunks",value:function(){var t=this,e=this.source;if(e.live){var r=this.getCurrentMediaSequence();if(r)return this.log("Trimming to media sequence: "+r),[this.audioChunks.trimToMediaSequence(r),this.videoChunks.trimToMediaSequence(r)]}var i=e.live?this.getPlayerTime():Math.max(this.getCurrentTime(),40);return i?(this.log("Trimming for current time: "+i),[this.audioChunks.trimForTimestamp(i+3),this.videoChunks.trimForTimestamp(i+3)]):[this.audioChunks.trimBy(function(){return t.audioChunks.length-2}),this.videoChunks.trimBy(function(){return t.videoChunks.length-2})]}},{key:"config",get:function(){return{player:{node:{selector:"#player .html5-video-player"},order:"hls"===this.getPayloadType()?["offline","loading","paused","playing"]:[],offline:{matches:".ended-mode"},paused:{matches:".paused-mode"},playing:{matches:".playing-mode"},loading:{matches:".loading-mode"}},shotIcons:[{tagName:"button",className:"yt-uix-button yt-uix-button-size-default yt-uix-button-opacity yt-uix-button-has-icon",children:["svg","label"],parent:{selector:".watch-secondary-actions"},style:{color:"buttontext",cursor:"pointer"},nodes:{svg:{fill:"buttontext",attributes:{width:15,height:20},style:{verticalAlign:"middle"}},label:{tagName:"span",className:"yt-uix-button-content",textContent:A.getMessage("takeShot"),style:{display:"inline-block",verticalAlign:"middle",padding:"2px 8px 0",pointerEvents:"none"}}},inactive:{style:{color:"rgba(0, 0, 0, 0.15)"},nodes:{svg:{fill:"rgba(0, 0, 0, 0.15)"}}}},{className:"style-scope",children:["svg"],parent:{selector:"ytd-menu-renderer.ytd-video-primary-info-renderer"},style:{width:"40px",height:"40px",marginLeft:"8px",borderRadius:"50%",textAlign:"center",background:"none",color:"#A0A0A0",cursor:"pointer"},nodes:{svg:{fill:"#A0A0A0",attributes:{width:16,height:20},style:{margin:"9px auto 0"}}},inactive:{style:{color:"rgba(0, 0, 0, 0.15)"},nodes:{svg:{fill:"rgba(0, 0, 0, 0.15)"}}},focused:{style:{color:"#414141"},nodes:{svg:{fill:"#414141"}}},pressed:{style:{background:"rgba(33, 33, 33)"}}},{id:"player",className:"ytp-button",children:["svg"],insertBefore:0,parent:{selector:".ytp-right-controls"},style:{padding:"0 6px 0 8px",textAlign:"center",boxSizing:"border-box",opacity:"0.9"},nodes:{svg:{fill:"#fff",attributes:{viewBox:"0 0 15 24"},style:{height:"100%",padding:"6px 0 5px",boxSizing:"border-box"}}},inactive:{style:{opacity:"0.2"}},focused:{style:{opacity:"1"}}}],streamDetails:{activeViewers:{reader:"textContentNumber",selector:".watch-view-count"},providerStreamerId:{attribute:"content",selector:'meta[itemprop="channelId"]'},streamerAvatarURL:{attribute:"src",selector:".yt-thumb-clip img"},streamerName:{selector:".yt-user-info a"},title:{selector:".watch-title span"},mediaSequence:{reader:"youtubeMediaSequence",selector:"#player .html5-video-player, #player-api .html5-video-player"},playerTime:{selector:"#player .html5-video-player, #player-api .html5-video-player",attribute:"data-current-time"},currentTime:{selector:".html5-video-player video",attribute:"currentTime"},videoId:{attribute:"content",selector:'meta[itemprop="videoId"]'}}}}},{key:"viewedURL",get:function(){return"https://youtube.com/watch?v="+this.getChannel()}}]),e}(S.default);E.sourceName="youtube",E.providerId="youtube.com",E.providerName="YouTube",E.providerUrl="https://youtube.com/",E.displayName="YouTube",E.streamUrls=["*://*.googlevideo.com/*"],E.tabUrlRegex=P?/^https?:\/\/(w+\.)?youtube\.com\/(watch|channel|[^\/]+\/live)/i:C,e.default=E},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),s=r(0),o=i(s),u=r(14),l=i(u),h=r(2),c={NOT_READY:0,IDLE:1,BUSY:2},f=new l.default;chrome.storage.onChanged.addListener(function(t,e){f.emit(e,t)});var p=function(){function t(e,r){var i=this;n(this,t),this._emitter=new l.default,this._lastWrite=0,this._outdatedKeys=new Set,this._status=c.NOT_READY,this._storageArea=chrome.storage[e],this._timeout=this._storageArea.MAX_WRITE_OPERATIONS_PER_HOUR?36e5/this._storageArea.MAX_WRITE_OPERATIONS_PER_HOUR:0,this._storageArea.get(null,function(t){var n=[],a=t||{};i._storage=a;var s=!0,u=!1,l=void 0;try{for(var h,p=Object.keys(a)[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var d=h.value;d in r||(delete a[d],n.push(d))}}catch(t){u=!0,l=t}finally{try{!s&&p.return&&p.return()}finally{if(u)throw l}}var m=!0,y=!1,g=void 0;try{for(var v,b=Object.keys(r)[Symbol.iterator]();!(m=(v=b.next()).done);m=!0){var _=v.value;_ in a||(a[_]=r[_],i._outdatedKeys.add(_))}}catch(t){y=!0,g=t}finally{try{!m&&b.return&&b.return()}finally{if(y)throw g}}f.on(e,function(t){var e=!0,r=!1,i=void 0;try{for(var n,s=Object.keys(t)[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=n.value;"newValue"in t[o]?a[o]=t[o].newValue:delete a[o]}}catch(t){r=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw i}}});var w=function(){i._status=c.IDLE,i._emitter.emit("storageReady"),i._save()};if(0!==n.length){!function t(){i._storageArea.remove(n,function(){chrome.runtime.lastError?(o.default.throw(chrome.runtime.lastError),setTimeout(function(){t()},i._timeout)):(i._lastWrite=Date.now(),w())})}()}else w()})}return a(t,[{key:"_ensureReady",value:function(){var t=this;return new Promise(function(e){t.isReady()?e():t._emitter.once("storageReady",e)})}},{key:"_save",value:function(){var t=this;if(this._status===c.IDLE&&0!==this._outdatedKeys.size){this._status=c.BUSY;var e=this._lastWrite+this._timeout-Date.now();setTimeout(function(){var e=t._outdatedKeys;t._outdatedKeys=new Set;!function r(){t._storageArea.set((0,h.pick)(t._storage,Array.from(e),function(){chrome.runtime.lastError&&o.default.throw(chrome.runtime.lastError),chrome.runtime.lastError||0!==t._outdatedKeys.size?setTimeout(function(){var i=!0,n=!1,a=void 0;try{for(var s,o=t._outdatedKeys[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var u=s.value;e.add(u)}}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}t._outdatedKeys=new Set,r()},t._timeout):(t._lastWrite=Date.now(),t._status=c.IDLE)}))}()},e>0?e:0)}}},{key:"get",value:function(t){var e=this;return this._ensureReady().then(function(){return e._storage[t]})}},{key:"getSync",value:function(t){return this.isReady()?this._storage[t]:void 0}},{key:"isReady",value:function(){return this._status!==c.NOT_READY}},{key:"set",value:function(t,e){var r=this;return this._ensureReady().then(function(){return r._outdatedKeys.add(t),r._storage[t]=e,r._save(),e})}}]),t}();e.default=p},function(t,e,r){"use strict";function i(){var t,e="";for(t=0;t<32;t+=1)switch(t){case 8:case 20:e+="-",e+=(16*Math.random()|0).toString(16);break;case 12:e+="-",e+="4";break;case 16:e+="-",e+=(4*Math.random()|8).toString(16);break;default:e+=(16*Math.random()|0).toString(16)}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e,r){(function(t,i){var n;(function(){"use strict";function a(t){return t=String(t),t.charAt(0).toUpperCase()+t.slice(1)}function s(t,e,r){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return e&&r&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(i=i[/[\d.]+$/.exec(t)])&&(t="Windows "+i),t=String(t),e&&r&&(t=t.replace(RegExp(e,"i"),r)),t=u(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function o(t,e){var r=-1,i=t?t.length:0;if("number"==typeof i&&i>-1&&i<=S)for(;++r<i;)e(t[r],r,t);else l(t,e)}function u(t){return t=d(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:a(t)}function l(t,e){for(var r in t)I.call(t,r)&&e(t[r],r,t)}function h(t){return null==t?a(t):O.call(t).slice(8,-1)}function c(t,e){var r=null!=t?typeof t[e]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!t[e])}function f(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function p(t,e){var r=null;return o(t,function(i,n){r=e(r,i,n,t)}),r}function d(t){return String(t).replace(/^ +| +$/g,"")}function m(t){function e(e){return p(e,function(e,r){var i=r.pattern||f(r);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(i,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=u(e[0].replace(RegExp(i,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e})}function r(){return this.description||""}var i=g,n=t&&"object"==typeof t&&"String"!=h(t);n&&(i=t,t=null);var a=i.navigator||{},o=a.userAgent||"";t||(t=o);var y,b,_=n||k==v,w=n?!!a.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(O.toString()),S=n?"Object":"ScriptBridgingProxyObject",U=n?"Object":"Environment",I=n&&i.java?"JavaPackage":h(i.java),A=n?"Object":"RuntimeObject",C=/\bJava/.test(I)&&i.java,P=C&&h(i.environment)==U,T=C?"a":"",E=C?"b":"",B=i.document||{},F=i.operamini||i.opera,L=x.test(L=n&&F?F["[[Class]]"]:h(F))?L:F=null,D=t,R=[],M=null,z=t==o,j=z&&F&&"function"==typeof F.version&&F.version(),N=function(e){return p(e,function(e,r){return e||RegExp("\\b"+(r.pattern||f(r))+"\\b","i").exec(t)&&(r.label||r)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),G=function(e){return p(e,function(e,r){return e||RegExp("\\b"+(r.pattern||f(r))+"\\b","i").exec(t)&&(r.label||r)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),H=e([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),V=function(e){return p(e,function(e,r,i){return e||(r[H]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(H)]||RegExp("\\b"+f(i)+"(?:\\b|\\w*\\d)","i").exec(t))&&i})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),q=function(e){return p(e,function(e,r){var i=r.pattern||f(r);return!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=s(e,i,r.label||r)),e})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(N&&(N=[N]),V&&!H&&(H=e([V])),(y=/\bGoogle TV\b/.exec(H))&&(H=y[0]),/\bSimulator\b/i.test(t)&&(H=(H?H+" ":"")+"Simulator"),"Opera Mini"==G&&/\bOPiOS\b/.test(t)&&R.push("running in Turbo/Uncompressed mode"),"IE"==G&&/\blike iPhone OS\b/.test(t)?(y=m(t.replace(/like iPhone OS/,"")),V=y.manufacturer,H=y.product):/^iP/.test(H)?(G||(G="Safari"),q="iOS"+((y=/ OS ([\d_]+)/i.exec(t))?" "+y[1].replace(/_/g,"."):"")):"Konqueror"!=G||/buntu/i.test(q)?V&&"Google"!=V&&(/Chrome/.test(G)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(H))||/\bAndroid\b/.test(q)&&/^Chrome/.test(G)&&/\bVersion\//i.test(t)?(G="Android Browser",q=/\bAndroid\b/.test(q)?q:"Android"):"Silk"==G?(/\bMobi/i.test(t)||(q="Android",R.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&R.unshift("accelerated")):"PaleMoon"==G&&(y=/\bFirefox\/([\d.]+)\b/.exec(t))?R.push("identifying as Firefox "+y[1]):"Firefox"==G&&(y=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(q||(q="Firefox OS"),H||(H=y[1])):!G||(y=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(G))?(G&&!H&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(y+"/")+8))&&(G=null),(y=H||V||q)&&(H||V||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(q))&&(G=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(q)?q:y)+" Browser")):"Electron"==G&&(y=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&R.push("Chromium "+y):q="Kubuntu",j||(j=function(e){return p(e,function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",f(G),"(?:Firefox|Minefield|NetFront)"])),(y="iCab"==N&&parseFloat(j)>3&&"WebKit"||/\bOpera\b/.test(G)&&(/\bOPR\b/.test(t)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(N)&&"WebKit"||!N&&/\bMSIE\b/i.test(t)&&("Mac OS"==q?"Tasman":"Trident")||"WebKit"==N&&/\bPlayStation\b(?! Vita\b)/i.test(G)&&"NetFront")&&(N=[y]),"IE"==G&&(y=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(G+=" Mobile",q="Windows Phone "+(/\+$/.test(y)?y:y+".x"),R.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(G="IE Mobile",q="Windows Phone 8.x",R.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=G&&"Trident"==N&&(y=/\brv:([\d.]+)/.exec(t))&&(G&&R.push("identifying as "+G+(j?" "+j:"")),G="IE",j=y[1]),z){if(c(i,"global"))if(C&&(y=C.lang.System,D=y.getProperty("os.arch"),q=q||y.getProperty("os.name")+" "+y.getProperty("os.version")),_&&c(i,"system")&&(y=[i.system])[0]){q||(q=y[0].os||null);try{y[1]=i.require("ringo/engine").version,j=y[1].join("."),G="RingoJS"}catch(t){y[0].global.system==i.system&&(G="Narwhal")}}else"object"==typeof i.process&&!i.process.browser&&(y=i.process)?"object"==typeof y.versions?"string"==typeof y.versions.electron?(R.push("Node "+y.versions.node),G="Electron",j=y.versions.electron):"string"==typeof y.versions.nw&&(R.push("Chromium "+j,"Node "+y.versions.node),G="NW.js",j=y.versions.nw):(G="Node.js",D=y.arch,q=y.platform,j=/[\d.]+/.exec(y.version),j=j?j[0]:"unknown"):P&&(G="Rhino");else h(y=i.runtime)==S?(G="Adobe AIR",q=y.flash.system.Capabilities.os):h(y=i.phantom)==A?(G="PhantomJS",j=(y=y.version||null)&&y.major+"."+y.minor+"."+y.patch):"number"==typeof B.documentMode&&(y=/\bTrident\/(\d+)/i.exec(t))?(j=[j,B.documentMode],(y=+y[1]+4)!=j[1]&&(R.push("IE "+j[1]+" mode"),N&&(N[1]=""),j[1]=y),j="IE"==G?String(j[1].toFixed(1)):j[0]):"number"==typeof B.documentMode&&/^(?:Chrome|Firefox)\b/.test(G)&&(R.push("masking as "+G+" "+j),G="IE",j="11.0",N=["Trident"],q="Windows");q=q&&u(q)}if(j&&(y=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(z&&a.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(M=/b/i.test(y)?"beta":"alpha",j=j.replace(RegExp(y+"\\+?$"),"")+("beta"==M?E:T)+(/\d+\+?/.exec(y)||"")),"Fennec"==G||"Firefox"==G&&/\b(?:Android|Firefox OS)\b/.test(q))G="Firefox Mobile";else if("Maxthon"==G&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(H))"Xbox 360"==H&&(q=null),"Xbox 360"==H&&/\bIEMobile\b/.test(t)&&R.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(G)&&(!G||H||/Browser|Mobi/.test(G))||"Windows CE"!=q&&!/Mobi/i.test(t))if("IE"==G&&z)try{null===i.external&&R.unshift("platform preview")}catch(t){R.unshift("embedded")}else(/\bBlackBerry\b/.test(H)||/\bBB10\b/.test(t))&&(y=(RegExp(H.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||j)?(y=[y,/BB10/.test(t)],q=(y[1]?(H=null,V="BlackBerry"):"Device Software")+" "+y[0],j=null):this!=l&&"Wii"!=H&&(z&&F||/Opera/.test(G)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==G&&/\bOS X (?:\d+\.){2,}/.test(q)||"IE"==G&&(q&&!/^Win/.test(q)&&j>5.5||/\bWindows XP\b/.test(q)&&j>8||8==j&&!/\bTrident\b/.test(t)))&&!x.test(y=m.call(l,t.replace(x,"")+";"))&&y.name&&(y="ing as "+y.name+((y=y.version)?" "+y:""),x.test(G)?(/\bIE\b/.test(y)&&"Mac OS"==q&&(q=null),y="identify"+y):(y="mask"+y,G=L?u(L.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(y)&&(q=null),z||(j=null)),N=["Presto"],R.push(y));else G+=" Mobile";(y=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(y=[parseFloat(y.replace(/\.(\d)$/,".0$1")),y],"Safari"==G&&"+"==y[1].slice(-1)?(G="WebKit Nightly",M="alpha",j=y[1].slice(0,-1)):j!=y[1]&&j!=(y[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(j=null),y[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==y[0]&&537.36==y[2]&&parseFloat(y[1])>=28&&"WebKit"==N&&(N=["Blink"]),z&&(w||y[1])?(N&&(N[1]="like Chrome"),y=y[1]||(y=y[0],y<530?1:y<532?2:y<532.05?3:y<533?4:y<534.03?5:y<534.07?6:y<534.1?7:y<534.13?8:y<534.16?9:y<534.24?10:y<534.3?11:y<535.01?12:y<535.02?"13+":y<535.07?15:y<535.11?16:y<535.19?17:y<536.05?18:y<536.1?19:y<537.01?20:y<537.11?"21+":y<537.13?23:y<537.18?24:y<537.24?25:y<537.36?26:"Blink"!=N?"27":"28")):(N&&(N[1]="like Safari"),y=y[0],y=y<400?1:y<500?2:y<526?3:y<533?4:y<534?"4+":y<535?5:y<537?6:y<538?7:y<601?8:"8"),N&&(N[1]+=" "+(y+="number"==typeof y?".x":/[.+]/.test(y)?"":"+")),"Safari"==G&&(!j||parseInt(j)>45)&&(j=y)),"Opera"==G&&(y=/\bzbov|zvav$/.exec(q))?(G+=" ",R.unshift("desktop mode"),"zvav"==y?(G+="Mini",j=null):G+="Mobile",q=q.replace(RegExp(" *"+y+"$"),"")):"Safari"==G&&/\bChrome\b/.exec(N&&N[1])&&(R.unshift("desktop mode"),G="Chrome Mobile",j=null,/\bOS X\b/.test(q)?(V="Apple",q="iOS 4.3+"):q=null),j&&0==j.indexOf(y=/[\d.]+$/.exec(q))&&t.indexOf("/"+y+"-")>-1&&(q=d(q.replace(y,""))),N&&!/\b(?:Avant|Nook)\b/.test(G)&&(/Browser|Lunascape|Maxthon/.test(G)||"Safari"!=G&&/^iOS/.test(q)&&/\bSafari\b/.test(N[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(G)&&N[1])&&(y=N[N.length-1])&&R.push(y),R.length&&(R=["("+R.join("; ")+")"]),V&&H&&H.indexOf(V)<0&&R.push("on "+V),H&&R.push((/^on /.test(R[R.length-1])?"":"on ")+H),q&&(y=/ ([\d.+]+)$/.exec(q),b=y&&"/"==q.charAt(q.length-y[0].length-1),q={architecture:32,family:y&&!b?q.replace(y[0],""):q,version:y?y[1]:null,toString:function(){var t=this.version;return this.family+(t&&!b?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(y=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(D))&&!/\bi686\b/i.test(D)?(q&&(q.architecture=64,q.family=q.family.replace(RegExp(" *"+y),"")),G&&(/\bWOW64\b/i.test(t)||z&&/\w(?:86|32)$/.test(a.cpuClass||a.platform)&&!/\bWin64; x64\b/i.test(t))&&R.unshift("32-bit")):q&&/^OS X/.test(q.family)&&"Chrome"==G&&parseFloat(j)>=39&&(q.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=N&&N[0],W.manufacturer=V,W.name=G,W.prerelease=M,W.product=H,W.ua=t,W.version=G&&j,W.os=q||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=m,W.toString=r,W.version&&R.unshift(j),W.name&&R.unshift(G),q&&G&&(q!=String(q).split(" ")[0]||q!=G.split(" ")[0]&&!H)&&R.push(H?"("+q+")":"on "+q),R.length&&(W.description=R.join(" ")),W}var y={function:!0,object:!0},g=y[typeof window]&&window||this,v=g,b=y[typeof e]&&e,_=y[typeof t]&&t&&!t.nodeType&&t,w=b&&_&&"object"==typeof i&&i;!w||w.global!==w&&w.window!==w&&w.self!==w||(g=w);var S=Math.pow(2,53)-1,x=/\bOpera/,k=this,U=Object.prototype,I=U.hasOwnProperty,O=U.toString,A=m();g.platform=A,void 0!==(n=function(){return A}.call(e,r,e,t))&&(t.exports=n)}).call(this)}).call(e,r(23)(t),r(12))},function(t,e,r){"use strict";e.decode=e.parse=r(99),e.encode=e.stringify=r(100)},function(t,e,r){function i(){return r(34),{}}t.exports=i},function(module,exports){"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var r,i,n,a,s,o=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,r=0;r<a;r+=1)s[r]=str(r,u)||"null";return n=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,n}if(rep&&"object"==typeof rep)for(a=rep.length,r=0;r<a;r+=1)"string"==typeof rep[r]&&(i=rep[r],(n=str(i,u))&&s.push(quote(i)+(gap?": ":":")+n));else for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(n=str(i,u))&&s.push(quote(i)+(gap?": ":":")+n);return n=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,n}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,r){var i;if(gap="",indent="","number"==typeof r)for(i=0;i<r;i+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var r,i,n=t[e];if(n&&"object"==typeof n)for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i=walk(n,r),void 0!==i?n[r]=i:delete n[r]);return reviver.call(t,e,n)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},function(t,e,r){function i(){var t="undefined"==typeof console?null:console;if(t){(t.warn?t.warn:t.log).apply(t,arguments)}}function n(t,e,r){r||(r=""),t&&!c(t)&&(t=[t]),e&&!c(e)&&(e=[e]);var n=r?"__storejs_"+r+"_":"",a=r?new RegExp("^"+n):null;if(!/^[a-zA-Z0-9_\-]*$/.test(r))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var m={_namespacePrefix:n,_namespaceRegexp:a,_testStorage:function(t){try{var e="__storejs__test__";t.write(e,e);var r=t.read(e)===e;return t.remove(e),r}catch(t){return!1}},_assignPluginFnProp:function(t,e){var r=this[e];this[e]=function(){function e(){if(r)return u(arguments,function(t,e){i[e]=t}),r.apply(n,i)}var i=s(arguments,0),n=this,a=[e].concat(i);return t.apply(n,a)}},_serialize:function(t){return JSON.stringify(t)},_deserialize:function(t,e){if(!t)return e;var r="";try{r=JSON.parse(t)}catch(e){r=t}return void 0!==r?r:e},_addStorage:function(t){this.enabled||this._testStorage(t)&&(this.storage=t,this.enabled=!0)},_addPlugin:function(t){var e=this;if(c(t))return void u(t,function(t){e._addPlugin(t)});if(!o(this.plugins,function(e){return t===e})){if(this.plugins.push(t),!f(t))throw new Error("Plugins must be function values that return objects");var r=t.call(this);if(!p(r))throw new Error("Plugins must return an object of function properties");u(r,function(r,i){if(!f(r))throw new Error("Bad plugin property: "+i+" from plugin "+t.name+". Plugins should only return functions.");e._assignPluginFnProp(r,i)})}},addStorage:function(t){i("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(t)}},y=h(m,d,{plugins:[]});return y.raw={},u(y,function(t,e){f(t)&&(y.raw[e]=l(y,t))}),u(t,function(t){y._addStorage(t)}),u(e,function(t){y._addPlugin(t)}),y}var a=r(5),s=a.slice,o=a.pluck,u=a.each,l=a.bind,h=a.create,c=a.isList,f=a.isFunction,p=a.isObject;t.exports={createStore:n};var d={version:"2.0.12",enabled:!1,get:function(t,e){var r=this.storage.read(this._namespacePrefix+t);return this._deserialize(r,e)},set:function(t,e){return void 0===e?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each(function(r,i){t.call(e,e._deserialize(r),(i||"").replace(e._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return n.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return n(this.storage,this.plugins,t)}}},function(t,e,r){t.exports=[r(38),r(40),r(41),r(37),r(42),r(39)]},function(t,e,r){function i(t){if(!t||!u(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(f.cookie.replace(new RegExp(e),"$1"))}function n(t){for(var e=f.cookie.split(/; ?/g),r=e.length-1;r>=0;r--)if(c(e[r])){var i=e[r].split("="),n=unescape(i[0]),a=unescape(i[1]);t(a,n)}}function a(t,e){t&&(f.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function s(t){t&&u(t)&&(f.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function o(){n(function(t,e){s(e)})}function u(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(f.cookie)}var l=r(5),h=l.Global,c=l.trim;t.exports={name:"cookieStorage",read:i,write:a,each:n,remove:s,clearAll:o};var f=h.document},function(t,e,r){function i(){return h.localStorage}function n(t){return i().getItem(t)}function a(t,e){return i().setItem(t,e)}function s(t){for(var e=i().length-1;e>=0;e--){var r=i().key(e);t(n(r),r)}}function o(t){return i().removeItem(t)}function u(){return i().clear()}var l=r(5),h=l.Global;t.exports={name:"localStorage",read:n,write:a,each:s,remove:o,clearAll:u}},function(t,e){function r(t){return o[t]}function i(t,e){o[t]=e}function n(t){for(var e in o)o.hasOwnProperty(e)&&t(o[e],e)}function a(t){delete o[t]}function s(t){o={}}t.exports={name:"memoryStorage",read:r,write:i,each:n,remove:a,clearAll:s};var o={}},function(t,e,r){function i(t){return h[t]}function n(t,e){h[t]=e}function a(t){for(var e=h.length-1;e>=0;e--){var r=h.key(e);t(h[r],r)}}function s(t){return h.removeItem(t)}function o(){a(function(t,e){delete h[t]})}var u=r(5),l=u.Global;t.exports={name:"oldFF-globalStorage",read:i,write:n,each:a,remove:s,clearAll:o};var h=l.globalStorage},function(t,e,r){function i(t,e){if(!d){var r=u(t);p(function(t){t.setAttribute(r,e),t.save(c)})}}function n(t){if(!d){var e=u(t),r=null;return p(function(t){r=t.getAttribute(e)}),r}}function a(t){p(function(e){for(var r=e.XMLDocument.documentElement.attributes,i=r.length-1;i>=0;i--){var n=r[i];t(e.getAttribute(n.name),n.name)}})}function s(t){var e=u(t);p(function(t){t.removeAttribute(e),t.save(c)})}function o(){p(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(c);for(var r=e.length-1;r>=0;r--)t.removeAttribute(e[r].name);t.save(c)})}function u(t){return t.replace(/^\d/,"___$&").replace(m,"___")}var l=r(5),h=l.Global;t.exports={name:"oldIE-userDataStorage",write:i,read:n,each:a,remove:s,clearAll:o};var c="storejs",f=h.document,p=function(){if(!f||!f.documentElement||!f.documentElement.addBehavior)return null;var t,e,r;try{e=new ActiveXObject("htmlfile"),e.open(),e.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),e.close(),t=e.w.frames[0].document,r=t.createElement("div")}catch(e){r=f.createElement("div"),t=f.body}return function(e){var i=[].slice.call(arguments,0);i.unshift(r),t.appendChild(r),r.addBehavior("#default#userData"),r.load(c),e.apply(this,i),t.removeChild(r)}}(),d=(h.navigator?h.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),m=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g")},function(t,e,r){function i(){return h.sessionStorage}function n(t){return i().getItem(t)}function a(t,e){return i().setItem(t,e)}function s(t){for(var e=i().length-1;e>=0;e--){var r=i().key(e);t(n(r),r)}}function o(t){return i().removeItem(t)}function u(){return i().clear()}var l=r(5),h=l.Global;t.exports={name:"sessionStorage",read:n,write:a,each:s,remove:o,clearAll:u}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={array:function(t){return Array.isArray(t)},notEmpty:function(t){return t&&t.length>0},number:function(t){return"number"==typeof t},string:function(t){return"string"==typeof t}};e.default=i},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){return new Promise(function(r,i){chrome.tabs.sendMessage(t,{message:"get-video-capture-info"},{frameId:e},function(t){r(t)})})}function a(t){return(0,d.getAllFrames)({tabId:t}).then(function(t){return t.map(function(t){return t.frameId})}).catch(function(t){return[]})}function s(t,e){return t.videos+=e.videosLength,t}Object.defineProperty(e,"__esModule",{value:!0});var o=r(6),u=i(o),l=r(32),h=i(l),c=r(18),f=(i(c),r(1)),p=i(f),d=r(2),m=chrome.i18n,y=p.default.get("videoCaptureEnabled"),g=["oddshot.tv"],v={"*":{legacy:!0,tagName:"div",className:"OddshotIcon-videoCapture",children:["svg","label"],nodes:{svg:{},label:{textContent:m.getMessage("takeShot")}}},"clips.twitch.tv":{tagName:"button",className:"player-button",children:["tooltip","svg"],insertBefore:".player-button--clips, .player-button--chromecast, .player-menu",parent:{selector:".player .player-buttons-right"},attributes:{type:"button"},style:{width:"3em",height:"4em",paddingBottom:"1em",float:"left",textAlign:"center",cursor:"pointer"},nodes:{tooltip:{tagName:"span",className:"player-tip js-tip",attributes:{"data-tip":m.getMessage("takeShot")}},svg:{fill:"#fff",attributes:{viewBox:"-2.5 -4 20 30"},style:{opacity:"1"}}},inactive:{nodes:{svg:{style:{opacity:"0.3"}}}},focused:{nodes:{svg:{fill:"#a991d4"}}}}},b={isBlacklisted:function(t){var e=t.hostname;return g.indexOf(e)>=0},getConfig:function(t){var e=u.default.parse(t);return this.isBlacklisted(e)?null:v[e.host]||v["*"]},getConfigForFrame:function(t,e){return y?new Promise(function(r,i){chrome.webNavigation.getFrame({tabId:t,frameId:e},function(t){return r(t?b.getConfig(t.url):null)})}):Promise.resolve(null)},getCaptureInfo:function(t){return a(t).then(function(e){return Promise.all(e.map(function(e){return n(t,e)}))}).then(function(t){return t.filter(function(t){return!!t})}).then(function(t){return t.reduce(s,{videos:0})})},captureFromFrame:function(t,e){chrome.tabs.sendMessage(t,{message:"capture"},{frameId:e})},capture:function(t){var e=t.href,r=t.title,i=t.src,n=t.currentTime,a=p.default.get("serverURL"),s=u.default.parse(e),o=h.default.stringify({source:e,time:n,title:r,url:u.default.resolve(e,i)});try{chrome.tabs.create({url:u.default.resolve(a,"upload?"+o),active:!1}),ga("send","event",{eventCategory:"VideoCapture",eventAction:s.pathname,eventLabel:s.host})}catch(t){}}};e.default=b},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e,r){var i=l.default.get("spawnerRequestTimeout"),n=a()+"/"+t;return"streamInfo"===t?o.default.get(n,{params:e,timeout:i}):o.default.post(n,e,{params:r,timeout:i})}function a(){return l.default.get("serverURL").replace(/(spawner)?\/*$/,"")+"/spawner"}Object.defineProperty(e,"__esModule",{value:!0}),e.spawnerCall=n,e.spawnerURL=a;var s=r(4),o=i(s),u=r(1),l=i(u)},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),c=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},f=r(6),p=i(f),d=r(22),m=i(d),y=r(1),g=i(y),v=r(4),b=i(v),_=g.default.get("periscopeEnabled"),w=function(t){function e(){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return u(e,t),h(e,[{key:"findSource",value:function(){var t=this;return this.getCachedBroadcastData().then(function(e){var r=e.hls_url||e.replay_url;if(r)return t.source={type:"hls",url:r,replay:!e.hls_url},t.source;throw t.error("Cannot find ",e),new Error("Cannot find playlist url")})}},{key:"consumeSource",value:function(){var t=this;if(this.source)return this.parsePlaylist(this.source.url).then(function(e){if(e[0]&&e[0].hasOwnProperty("STREAM-INF")){return t.findBestResolutionFromPlaylist(e).then(function(e){return p.default.resolve(t.source.url,e)}).then(function(e){return t.parsePlaylist(e)})}return e}).then(function(e){var r,i=t.getPlaylistChunks(e,{url:t.source.url});(r=t.sourceChunks).push.apply(r,a(i))})}},{key:"canWatch",value:function(){return!1}},{key:"destroy",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._consumeSourceInterval=clearInterval(this._consumeSourceInterval)}},{key:"getBroadcastId",value:function(){return this.getChannelInfo().broadcastId}},{key:"getChannel",value:function(){return this.getChannelInfo().channel}},{key:"getChannelInfo",value:function(){var t=p.default.parse(this.frameUrl),e=t.pathname.split("/");return{broadcastId:e[2],channel:e[1]}}},{key:"getPayload",value:function(){if(!this.source)return[];var t=this.source,e=this.getBroadcastId(),r=0;if(t.replay){var i=this.getCurrentTime();return this.sourceChunks.trimForTime(i).map(function(t){return l({},t,{url:t.url+"#id="+e})})}return this.sourceChunks.trimLastSeconds(1).map(function(t){return r+=t.extInf,l({},t,{url:t.url+"#id="+e,timestamp:r-t.extInf})})}},{key:"getStreamerName",value:function(){return this.getCachedBroadcastData().then(function(t){return t.broadcast.username})}},{key:"getStreamInfoParams",value:function(){return this.getStreamerName().then(function(t){return{streamerName:t}})}},{key:"getViewedStreamURL",value:function(){var t=this.getBroadcastId();return this.getStreamerName().then(function(e){return"https://www.periscope.tv/"+e+"/"+t})}},{key:"getBroadcastData",value:function(){var t=this.getBroadcastId();return e.apiCall("accessVideoPublic?broadcast_id="+t+"&replay_redirect=false")}},{key:"getCachedBroadcastData",value:function(){return this._broadcastData=this._broadcastData||this.getBroadcastData(),this._broadcastData}},{key:"getMetaData",value:function(){return this.getBroadcastData().then(function(t){var e=t.broadcast,r=e.camera_rotation;return{languageCode:[e.language],providerStreamerId:e.user_id,streamerAvatarURL:e.profile_image_url,streamerDisplayName:e.user_display_name,streamerName:e.username,tags:e.tags,thumbnailURL:e.image_url,title:e.status,rotation:90*Math.round(r/90)%360}})}},{key:"getMediaSequenceFromChunkName",value:function(t){var e=t.match(/_(\d+)\.ts/);return e?parseInt(e[1],10):0}},{key:"init",value:function(){var t=this;return this.findSource().then(function(e){return clearInterval(t._consumeSourceInterval),e.replay||(t._consumeSourceInterval=setInterval(function(){return t.consumeSource()},4e3)),t.sourceChunks=t.createChunksQueue({chunkLifetime:e.replay?1/0:null,maxShotTime:70}),t.consumeSource()})}},{key:"onTabUpdate",value:function(t){var r=t.url&&t.url.split(/[#?]/)[0];if(r&&r!==this.url){if(!e.tabUrlRegex.test(r))return"unregister";this.frameUrl=t.url,this.url=r,this._broadcastData=null,this.clear(),this.init()}}},{key:"config",get:function(){return{shotIcons:[{id:"player",tagName:"div",className:"Pill Pill--withIcon",children:["svg"],insertBefore:0,parent:{selector:".VideoOverlayRedesign-BottomBar-Right"},style:{display:"inline-block",opacity:"0.6",cursor:"pointer"},nodes:{svg:{fill:"#fff",style:{margin:"6px 8px"},attributes:{width:16,height:20,viewBox:"0 0 16 22"}}},inactive:{style:{opacity:"0.15"}},focused:{style:{opacity:"1"}}}],streamDetails:{currentTime:{selector:".BaseVideo video[src]",attribute:"currentTime"}}}}}],[{key:"apiCall",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="https://api.periscope.tv/api/v2/"+t;return b.default.get(r,{params:l({},e),timeout:5e3})}}]),e}(m.default);w.sourceName="periscope",w.providerId="periscope",w.providerName="Periscope",w.providerUrl="https://periscope.tv/",w.displayName="Periscope",w.streamUrls=[],w.tabUrlRegex=_?/^https?:\/\/(www\.)?(periscope|pscp)\.tv\/[^\/]+\/.*/i:/(?!)/,e.default=w},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}function l(t){var e=d.default.parse(t);return/\bhitbox\b/.test(e.host)?d.default.format(f({},e,{host:O})):t}Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),c=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},p=r(6),d=i(p),m=r(22),y=i(m),g=r(43),v=i(g),b=r(0),_=i(b),w=r(3),S=i(w),x=r(4),k=i(x),U=r(1),I=(i(U),chrome.i18n),O="smashcast-hls.akamaized.net",A=["channels","games","esports","settings","store","browse","video","dashboard","foryou","legal","signup","embedchat","team"],C=function(t){function e(){var t,r,i,n;s(this,e);for(var a=arguments.length,u=Array(a),l=0;l<a;l++)u[l]=arguments[l];return r=i=o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),i.streamUrlRegex=/^https?:\/\/([^\/]*)\.akamaized\.net/,i.validators={streamerName:v.default.notEmpty,providerStreamerId:v.default.number},n=r,o(i,n)}return u(e,t),h(e,[{key:"canConsumeSource",value:function(){var t=this.status;return-1===[S.default.BLOCKED,S.default.NOT_LIVE,S.default.OFFLINE,S.default.BANNED].indexOf(t)}},{key:"consume",value:function(t){}},{key:"consumeSource",value:function(){var t=this,e=this.source,r=this.sourceChunks;return this.canConsumeSource()?e&&e.url?this.parsePlaylist(e.url).then(function(r){return t.getPlaylistChunks(r,e)}).then(function(t){return r.push.apply(r,a(t))}):this.getSource().then(function(){return t.consumeSource()}):null}},{key:"destroy",value:function(){y.default.prototype.destroy.call(this),this._consumeSourceInterval=clearInterval(this._consumeSourceInterval)}},{key:"getChannel",value:function(){var t=d.default.parse(this.getCanonicalUrl()),e=t.pathname,r=e.split("/");return"embed"===r[1]?r[2]:r[1]}},{key:"getChatSocketURL",value:function(t){var r=this;return e.apiCall("chat/servers").then(function(t){var e=t[0].server_ip;return k.default.get("http://"+e+"/socket.io/1/",{responseType:"text",silent:!0}).then(function(t){var r=t.split(":")[0];return"ws://"+e+"/socket.io/1/websocket/"+r})}).catch(function(e){if(t)throw _.default.error("Unable to get chat socket URL",e.stack),e;return r.getChatSocketURL(!0)})}},{key:"getChannelData",value:function(){var t=this.getChannel();return t?e.apiCall("media/live/"+t+"?showHidden=true",{timeout:2500}):Promise.reject("Channel not found")}},{key:"getMetaData",value:function(){var t=this;return this.getChannelData().then(function(e){var r=e.livestream[0];return _.default.log("Smashcast: received metadata from API",r),"1"===r.media_is_live?{title:r.media_status,providerStreamerId:parseInt(r.channel.user_id,10),streamerName:r.channel.user_name,activeViewers:parseInt(r.media_views,10),subjectName:r.category_name,streamerAvatarURL:d.default.resolve("http://edge.sf.hitbox.tv",r.channel.user_logo),languageCode:r.media_countries}:(_.default.warn("Smashcast: stream "+t.url+" seems to be offline, cannot get stream data"),{})})}},{key:"getPayload",value:function(){var t=this.viewedTS.get(-2);if(t){var e=this.getTimestampFromChunkUrl(t);return this.sourceChunks.trimForTimestamp(e)}return this.sourceChunks.chunks.slice(0)}},{key:"getSource",value:function(){var t=this,r=this.getChannel();return e.apiCall("player/hlsconfig/live/"+r+"?showHidden=true").then(function(e){var r=e.hls,i=r.bitrates.find(function(t){return"source"===t.label.toLowerCase()})||r.bitrates[0];return t.source={live:!0,url:l(i.url)}}).catch(function(e){throw t.status=S.default.OFFLINE,e})}},{key:"init",value:function(){var t=this;this.sourceChunks=this.createChunksQueue(),this._consumeSourceInterval=setInterval(function(){return t.consumeSource()},3500),this.consumeSource()}},{key:"onChatMessage",value:function(t,e){var r=this;if("1::"===e)t.send('5:::{"name":"message","args":[{"method":"joinChannel","params":{"channel":"'+this.channel+'","name":"UnknownSoldier","token":null,"isAdmin":false}}]}');else if("2::"===e)t.send("2::");else if(e.startsWith("5:::"))try{var i=e.indexOf("{");if(i>=0){var n=JSON.parse(e.substr(i));if("message"===n.name){var a=n.args.map(function(t){return JSON.parse(t)});a.forEach(function(t){"chatMsg"===t.method&&!0!==t.buffer&&r.chatHistory.add({author:t.params.name,color:"#"+t.params.nameColor,message:t.params.text})})}}}catch(t){_.default.throw("Smashcast: Cannot handle chat message",{message:e},t)}}},{key:"getTimestampFromChunkUrl",value:function(t){var e=t.match(/(\d+)\.ts/);if(e){return parseInt(e[1],10)/1e3}return null}},{key:"resolvePlaylistChunkTimestamp",value:function(t,r,i){return this.source.live?this.getTimestampFromChunkUrl(r):c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"resolvePlaylistChunkTimestamp",this).call(this,t,r,i)}},{key:"config",get:function(){return{chat:{input:{selector:".chatwrapper .chat-input .public-DraftEditor-content"}},player:{node:{selector:".media-player__wrapper"},order:["offline","loading","paused","playing"],paused:{matches:".pause"},playing:{matches:".play"},loading:{hasChild:"#player-loading:not(.ng-hide)"},offline:{hasChild:"#player.vjs-error"}},shotIcons:[{id:"player",tagName:"li",children:["div"],insertBefore:0,parent:{selector:".player-controls .player-controls__controls"},style:{cursor:"pointer"},nodes:{div:{className:"player-controls__control_wrapper",children:["svg"],attributes:{title:I.getMessage("takeShot")},nodes:{svg:{fill:"#fff",className:"player-controls__button",attributes:{viewBox:"0 0 15 20"},style:{marginTop:"-2px"}}}}},inactive:{nodes:{div:{nodes:{svg:{fill:"rgba(255, 255, 255, 0.2)"}}}}},focused:{nodes:{div:{nodes:{svg:{fill:"#208efc"}}}}}}],streamDetails:{activeViewers:{reader:"number",selector:".media-player-meta__viewers .media-player-meta__viewers__text"},streamerAvatarURL:{reader:"backgroundImage",selector:".detail-sidebar__user .detail-sidebar__user__image .logo"},streamerName:{selector:".media-player-meta__name"},title:{selector:".media-player-meta__status"}}}}},{key:"viewedURL",get:function(){return"https://www.smashcast.tv/"+this.getChannel()}}],[{key:"recheckTabUrl",value:function(t){var e=d.default.parse(t).pathname.split("/");return e[1]&&-1===A.indexOf(e[1].toLowerCase())}},{key:"apiCall",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],r="https://api.smashcast.tv/"+t;return _.default.log("Smashcast: getting data from API "+t),k.default.get(r,e)}}]),e}(y.default);C.sourceName="smashcast",C.providerId="smashcast.tv",C.providerName="Smashcast",C.providerUrl="https://smashcast.tv/",C.displayName="Smashcast",C.streamUrls=["*://*.akamaized.net/*"],C.tabUrlRegex=/^https?:\/\/(www\.)?(test\.dev\.)?smashcast\.tv\/./,e.default=C},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},c=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),f=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},p=r(16),d=i(p),m=r(20),y=(i(m),r(27)),g=i(y),v=r(4),b=i(v),_=r(2),w=r(3),S=(i(w),r(1)),x=(i(S),function(t){function e(){var t,r,i,n;a(this,e);for(var o=arguments.length,u=Array(o),l=0;l<o;l++)u[l]=arguments[l];return r=i=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),i.streamUrlRegex=/^https?:\/\/(www\.)?usher\.ttvnw\.net\/vod\//i,n=r,s(i,n)}return o(e,t),c(e,[{key:"getConfig",value:function(t){var r=f(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConfig",this).call(this,t);return h({},r,{player:null,streamDetails:h({},r.streamDetails,{currentTime:{selector:".player-video video",attribute:"currentTime"}})})}},{key:"getViewedStreamURL",value:function(){return Promise.resolve(this.viewedURL)}},{key:"getChannel",value:function(){var t=this.details&&this.details.streamerProfileUrl,e=t&&t.split("/");return e&&e[e.length-1]}},{key:"canWatch",value:function(){return!1}},{key:"consume",value:function(t){}},{key:"consumeSource",value:function(){var t=this,e=this.source;return e&&e.url?this.parsePlaylist(e.url).then(function(r){t.sourceChunks.length=0;var i=function(r,i){var n=void 0===i?"undefined":l(i);if("object"===n)return h({},r,i);if("string"===n&&r.EXTINF){if(!r.mediaSequence){var a=i.match(/-(\d+)\-/);r.mediaSequence=a?parseInt(a[1],10):0}var s=parseFloat(r.EXTINF),o={url:new d.default(i,e.url).toString(),mediaSequence:r.mediaSequence,timestamp:r.timestamp,extInf:s};t.sourceChunks.push(o),r.timestamp+=s,r.mediaSequence++}return r};r.reduce(i,{timestamp:0,mediaSequence:0}),t.log("Playlist has been parsed, last chunk:",t.sourceChunks[t.sourceChunks.length-1]),t.updateStatus()}):this.getSource().then(function(){return t.consumeSource()})}},{key:"getPayload",value:function(){return this.sliceChunksForCurrentTime()}},{key:"getVideoId",value:function(){return new d.default(this.url).pathname.split("/")[2]}},{key:"getUsherUrl",value:function(){var t=this.getVideoId();return e.getToken(t).then(function(e){var r=parseInt(999999*Math.random(),10),i=encodeURIComponent(e.token);return"http://usher.twitch.tv/vod/"+t+".m3u8?nauth="+i+"&nauthsig="+e.sig+"&allow_source=true&allow_spectre=true&player_backend=html5&p="+r+"&baking_bread=false"})}},{key:"getVideoData",value:function(){var t=this.getVideoId();return this._videoData=this._videoData||g.default.apiCall("videos/v"+t),this._videoData}},{key:"getMetaData",value:function(){return this.getVideoData().then(function(t){var e=t.channel.name;return Promise.all([t,g.default.apiCall("channels/"+e)])}).then(function(t){var e=u(t,2),r=e[0],i=e[1];return{title:r.title,providerStreamerId:i._id,streamerName:r.channel.name,streamerDisplayName:r.channel.display_name,subjectName:r.game,streamerAvatarURL:i.logo,languageCode:[r.language,i.broadcaster_language],thumbnailURL:r.preview}})}},{key:"getViewedStreamURL",value:function(){var t=this;return this.getVideoData().then(function(e){var r=t.getVideoId();return"https://twitch.tv/"+e.channel.name+"/v/"+r})}},{key:"getStreamInfoParams",value:function(){return this.getVideoData().then(function(t){return{streamerName:t.channel.name}})}},{key:"init",value:function(){this.consumeSource()}},{key:"isReady",value:function(){return this.sourceChunks.length>0}},{key:"viewedURL",get:function(){var t=this.getVideoId();return"https://twitch.tv/"+this.getChannel()+"/v/"+t}}],[{key:"recheckTabUrl",value:function(t){return!0}},{key:"getToken",value:function(t){var e=this.getClientIDs();return(0,_.dontGiveUp)(function(r){return b.default.get("https://api.twitch.tv/api/vods/"+t+"/access_token",{params:{adblock:!1,need_https:!1,platform:"web",player_type:"site"},headers:{"Client-ID":e[e.length-r]}})})}}]),e}(g.default));x.displayName="Twitch VOD",x.tabUrlRegex=/^https?:\/\/(www\.)?(go\.)?twitch\.tv\/videos\/\d+/i,e.default=x},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=r(6),c=i(h),f=r(22),p=i(f),d=r(1),m=i(d),y=r(4),g=i(y),v=r(2),b=r(3),_=(i(b),chrome.i18n),w=m.default.get("vimeoEnabled"),S=function(t){function e(){var t,r,i,n;a(this,e);for(var o=arguments.length,u=Array(o),l=0;l<o;l++)u[l]=arguments[l];return r=i=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),i.streamUrlRegex=/^https?:\/\/(.*\.)(akamaihd\.net|vimeocdn\.com)\//i,i.config={player:{node:{selector:".player_container .player"}},shotIcons:[{id:"player",tagName:"div",className:"box",children:["label","button"],parent:{selector:".player .controls-wrapper .sidedock"},style:{display:"flex",opacity:"1"},nodes:{label:{className:"rounded-box invisible",children:["span"],attributes:{role:"presentation",hidden:null},style:{color:"#fff"},nodes:{span:{textContent:_.getMessage("takeShot")}}},button:{className:"rounded-box",children:["svg"],nodes:{svg:{fill:"#fff",attributes:{width:26,height:30,viewBox:"0 0 16 22"},style:{width:"2.6em",height:"3em",padding:"0.3em 0.5em"}}}}},inactive:{style:{opacity:"0.5"}},focused:{nodes:{label:{className:"rounded-box visible"}}}}],streamDetails:{currentTime:{selector:".player_container .player video",attribute:"currentTime"},streamerAvatarURL:{selector:".clip_info-wrapper .clip_info-user_actions img",attribute:"src"},streamerDisplayName:{selector:".clip_info .js-user_link"},streamerURI:{selector:".clip_info .js-user_link",attribute:"href"},title:{selector:".clip_info .clip_info-header"}}},n=r,s(i,n)}return o(e,t),l(e,[{key:"canUseStreamInfo",value:function(){return!1}},{key:"canWatch",value:function(){return!1}},{key:"getChannel",value:function(){return this.details&&this.details.streamerName?this.details.streamerURI.replace(/^.*\//,""):null}},{key:"getVideoId",value:function(){var t=c.default.parse(this.frameUrl),e=t.pathname.split("/");return e[e.length-1]}},{key:"init",value:function(){var t=this,e=this.getVideoId();return this.getVideoConfig(e).then(function(e){return t.findSource(e.request.files)}).then(function(){return t.consumeSource(t.source)}).catch(function(e){setTimeout(function(){return t.init()},3e3)})}},{key:"consumeSource",value:function(t){this.sourceChunks=t.chunks||t.segments.map(function(e,r){return{url:c.default.resolve(t.url,e.url),extInf:e.end-e.start,mediaSequence:r+1,timestamp:e.start}}),t.initSegment&&(this.initChunk={init:!0,url:"data:"+t.mimeType+";base64,"+t.initSegment,mediaSequence:0,timestamp:null}),this.updateStatus()}},{key:"findDASH",value:function(t){var e=this;return this.getJSON(t).then(function(r){var i=c.default.resolve(t,r.base_url),n=r.video.reduce(function(t,e){return!t||t.avg_bitrate<e.avg_bitrate?e:t});return e.source={type:"dash",url:c.default.resolve(i,n.base_url),segments:n.segments,initSegment:n.init_segment,mimeType:n.mime_type}})}},{key:"findHLS",value:function(t){var e=this;return this.findBestResolutionFromPlaylist(t).then(function(r){var i=c.default.resolve(t,r);return e.parsePlaylist(i).then(function(t){var r=e.getPlaylistChunks(t,{url:i,mediaSequence:1});return e.source={type:"hls",url:i,chunks:r}})})}},{key:"findSource",value:function(t){var e=t.hls?"hls":t.dash?"dash":null,r=t.hls||t.dash;if(r&&e){var i=r.cdns[r.default_cdn],n=i&&i.url;if(n)return"dash"===e?this.findDASH(n):this.findHLS(n)}throw this.error("Vimeo CDN not found:",t),new Error("Vimeo CDN not found")}},{key:"getMetaData",value:function(){var t=this,r=this.getVideoId();return e.apiCall("videos/"+r).then(function(e){return{languageCode:[e.language],providerStreamerId:e.user&&Number(e.user.uri.replace(/^.*\//g,"")),streamerAvatarURL:e.user&&t.getPictureLink(e.user.pictures),streamerDisplayName:e.user&&e.user.name,streamerName:e.user&&c.default.parse(e.user.link).pathname.replace(/^\/+/,""),tags:e.tags.map(function(t){return t.name}),thumbnailURL:t.getPictureLink(e.pictures),title:e.name}})}},{key:"getPictureLink",value:function(t){var e=t&&t.sizes.reduce(function(t,e){return!t||e.width>t.width?e:t});return e&&e.link}},{key:"isReady",value:function(){return this.sourceChunks&&this.sourceChunks.length>0}},{key:"getPayload",value:function(){var t=this.sliceChunksForCurrentTime(this.sourceChunks);return this.initChunk&&this.source&&"dash"===this.source.type&&t.unshift(this.initChunk),t}},{key:"getPayloadType",value:function(){return this.source&&this.source.type}},{key:"getVideoConfig",value:function(t){var e=this,r="https://player.vimeo.com/video/"+t+"/config";return(0,v.dontGiveUp)(function(){return e.getJSON(r)},2)}},{key:"viewedURL",get:function(){return"https://vimeo.com/"+this.getVideoId()}}],[{key:"apiCall",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],r="https://api.vimeo.com/"+t;return g.default.get(r,{headers:{Authorization:"Bearer 6fc3cd3883ebb26e537978ebec1eb303",Accept:"application/vnd.vimeo.*+json;version=3.2"},params:u({},e),timeout:2500})}}]),e}(p.default);S.sourceName="vimeo",S.providerId="vimeo",S.providerName="Vimeo",S.providerUrl="https://vimeo.com/",S.displayName="Vimeo",S.streamUrls=[],S.tabUrlRegex=w?/^https?:\/\/(www\.)?vimeo\.com\/(.*\/)?(\d+)/i:/(?!)/,e.default=S},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t){return void 0===t||""===t?null:(t.startsWith('"')&&(t=JSON.parse(t)),/^(?:\+|-)?(?:\d+(?:\.\d*)?|\.\d+)$/.test(t)?Number.parseFloat(t):t)}function a(t){if(!t)return null;var e=t.split(","),r=new Map,i=!0,a=!1,s=void 0;try{for(var o,u=e[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var l=o.value;if(""!==l){var h=l.split(/=(.*)/);r.set(n(h[0]),n(h[1]))}}}catch(t){a=!0,s=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return r}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=r(80),u=function(){function t(e){i(this,t),this._callbacks=e}return s(t,[{key:"_callback",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n=!0,a=!1,s=void 0;try{for(var o,u=this._callbacks[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value;l[t]&&l[t].apply(l,r)}}catch(t){a=!0,s=t}finally{try{!n&&u.return&&u.return()}finally{if(a)throw s}}}},{key:"parse",value:function(t,e){var r=t.split("\n");if("#EXTM3U"===r[0]){r.shift();var i=!0,n=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var h=u.value;if(h.startsWith("#")){var c=h.substring(1).split(/:(.*)/);this._callback("keyValuesCallback",c[0],a(c[1]))}else""!==h&&this._callback("urlCallback",(0,o.resolveUrl)(e,h),h)}}catch(t){n=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw s}}}}}]),t}();e.default=u},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function a(){return new Promise(function(t,e){var r={active:!0,lastFocusedWindow:!0};chrome.tabs.query(r,function(r){r[0]?t(r[0]):e(new Error("Tab not found"))})})}Object.defineProperty(e,"__esModule",{value:!0});var s=r(17),o=i(s),u=r(44),l=i(u),h=r(24),c=i(h),f=r(0),p=i(f),d=r(26),m=(i(d),r(4)),y=i(m),g=r(1),v=i(g),b={"get-host-config":function(t,e,r){return e.videoCapture?l.default.getConfigForFrame(this.id,r):t?t.getConfig(null,r):null},"get-keyboard-shortcut":function(t){chrome.commands&&chrome.commands.getAll(function(t){var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;if("take-shot"===s.name){chrome.runtime.sendMessage({message:"reply-keyboard-shortcut",shortcut:s.shortcut});break}}}catch(t){r=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw i}}})},"request-popup-context":function(t){return o.default.update(this.id,!0)},"set-details":function(t,e,r){if(t&&t.streamId===e.streamId){return t.source.setStreamDetails(e.details,r),!0}return!1},"set-stream-state":function(t,e){t&&t.streamId===e.streamId&&c.default.setStreamState(t,e.state)},"take-shot":function(t,e,r){var i=e.streamId;t||i?!t||i&&t.streamId!==i||c.default.takeShot(t,e.eventType):l.default.captureFromFrame(this.id,r)},"video-capture":function(t,e){l.default.capture(e.video)},"register-frame":function(t,e,r){r&&c.default.registerFrame(this,r)},"unregister-frame":function(t,e,r){c.default.unregisterFrame(this,r)},log:function(t,e){p.default.log.apply(p.default,n(e.params))},error:function(t,e){p.default.error.apply(p.default,n(e.params))},"console-dump":function(){return p.default.dump()},"send-report":function(t,e){return c.default.dump().then(function(){return p.default.dump().then(function(t){var r=v.default.get("serverURL").replace(/\/+$/,""),i=Object.assign(t,{email:e.email,description:e.description});return y.default.post(r+"/plugin-report",i,{silent:!0}),i})})},"get-config":function(){return v.default.get()},"set-config":function(t,e){v.default.patch(e.patch)}};e.default={exec:function(t,e,r){function i(t,e){var i=b[r];if(t&&i){var n=c.default.get(t.id,e)||c.default.get(t.id,0);return s.unshift(n),s.push(e),Promise.resolve(i.apply(t,s))}return Promise.resolve(null)}for(var n=arguments.length,s=Array(n>3?n-3:0),o=3;o<n;o++)s[o-3]=arguments[o];return t?i(t,e):a().then(function(t){var e=c.default.getBestFrame(t.id);return i(t,e&&e.frameId)})}}},,,,function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function a(t){var e=void 0;"undefined"!=typeof browser&&t.originUrl&&-1===t.tabId&&(e=c.default.findByInitialURL(t.originUrl)[0]);var r=c.default.get(t.tabId,t.frameId)||c.default.get(t.tabId,0)||e,i=r&&r.source;i&&i.canCaptureStreams()&&(/\.ts$/i.test(t.url)&&i.viewedTS.push(t.url),i.consume&&i.streamUrlRegex&&i.streamUrlRegex.test(t.url)&&i.consume(t.url,t))}var s=r(17),o=i(s),u=r(51),l=i(u),h=r(24),c=i(h),f=r(0),p=i(f),d=r(18),m=i(d),y=r(3),g=(i(y),r(1)),v=(i(g),r(2));try{/\bfirefox\b/i.test(navigator.userAgent)||(!function(t,e,r,i,n,a,s){t.GoogleAnalyticsObject=n,t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},t[n].l=1*new Date,a=e.createElement(r),s=e.getElementsByTagName(r)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(a,s)}(window,document,"script",0,"ga"),(0,v.getUUID)().then(function(t){ga("create","UA-61016407-4","auto"),ga("set","checkProtocolTask",function(){}),ga("set","appName","Oddshot Browser Extension"),ga("set","appId",chrome.runtime.id),ga("set","appVersion",chrome.runtime.getManifest().version),ga("set","userId",t),ga("send","pageview","/background.html")}))}catch(t){}chrome.runtime.onMessage.addListener(function(t,e,r){try{if(t.message&&(e.tab||"number"!=typeof e.frameId))return l.default.exec(e.tab,e.frameId,t.message,t).then(function(t){null!=t&&r(t)}),!0}catch(t){p.default.throw(t)}}),chrome.runtime.onMessageExternal&&chrome.runtime.onMessageExternal.addListener(function(t,e,r){r({plugin:"Oddshot",version:chrome.runtime.getManifest().version})}),chrome.tabs.onRemoved.addListener(function(t,e){c.default.delete(t)});var b={};chrome.tabs.onUpdated.addListener(function(t,e,r){b[t]=Promise.resolve(b[t]).then(function(){return c.default.tabUpdate(r,e)}),!0===r.active&&"status"in e&&o.default.update(t)}),chrome.tabs.query({status:"complete"},function(t){c.default.register.apply(c.default,n(t))}),chrome.webRequest.onCompleted.addListener(a,m.default.getRequestFilter()),chrome.commands&&chrome.commands.onCommand.addListener(function(t){l.default.exec(null,null,t,{eventType:"hotkey"})})},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=r(3),h=i(l),c=r(0),f=i(c),p=r(1),d=i(p),m=r(2),y=r(45),g=r(25),v=(i(g),chrome.i18n,function(){function t(e,r,i,n){var s=this;a(this,t),this.streamId=Date.now(),this.tabId=r,this.frameId=i,this.id=r+":"+i,this.source=new e(r,i,n,this),this.initialUrl=n,this.url=this.source.url,this.createdDate=Date.now(),this.frameIds=new Set([]),this.source.emitter.on("status-change",function(t){var e=t?"shot-ready":"shot-not-ready";s.forEachFrame(function(r){var i=s.getConfig(t,r);s.sendMessage({message:e,config:i},r)})}),this.source.emitter.on("update-client",function(t){var e=s.getConfig(),r=s.forEachFrame(function(t){return s.sendMessage({message:"update",config:e},t)});Promise.all(r).then(t)})}return u(t,[{key:"destroy",value:function(){var t=this;this.streamId;this.source.destroy(),this.updateTimeout=clearTimeout(this.updateTimeout),this.forEachFrame(function(e){t.sendMessage({message:"remove-client-script"},e)})}},{key:"dispatch",value:function(t){t&&t.state&&this.source.setState(t.state)}},{key:"executeContentScript",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.frameId;return this.frameIds.has(e)?Promise.resolve():(this.frameIds.add(e),(0,m.dontGiveUp)(function(r){return new Promise(function(i,n){t.sendMessage({message:"remove-client-script",streamId:t.streamId-1},e),chrome.tabs.executeScript(t.tabId,{file:"client.js",frameId:e},function(a){var s=chrome.runtime.lastError||chrome.extension.lastError;s?(f.default.throw("Failed content-script execution (attempt: "+r+")",s),n(s)):(f.default.log('Completed content-script execution on frame "'+t.tabId+":"+e+'" and url "'+t.url+'"'),i(a))}),/\bfirefox\b/i.test(navigator.userAgent)&&setTimeout(function(){return i([])},1e3)})},2))}},{key:"extractPTS",value:function(){return this.source.extractPTS()}},{key:"forEachFrame",value:function(t){var e=this;return[].concat(n(this.frameIds)).map(function(r){return t.call(e,r)})}},{key:"init",value:function(){this.updateStreamInfo()}},{key:"isReady",value:function(){return this.source.status===h.default.READY}},{key:"getConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.frameId,r=null!=t?t:this.isReady(),i=this.source.getConfig(e),n=this.getStatusMessage(),a=this.streamId;return o({isReady:r,streamId:a,status:n},i)}},{key:"getMetaData",value:function(){var t=this.source;return Promise.resolve(t.getMetaData()).then(function(e){return(0,m.defaults)(t.getCommonData(),e)}).catch(function(e){return f.default.throw("Error in getting stream data, trying to use common data",e),t.getCommonData()})}},{key:"getPayload",value:function(){return Promise.resolve(this.source.getPayload()).then(function(t){return Array.isArray(t)?t.slice(0):t})}},{key:"getPayloadType",value:function(){return this.source.getPayloadType()}},{key:"getStatus",value:function(){return this.source.getStatus()}},{key:"getStatusName",value:function(){return this.source.getStatusName()}},{key:"getStatusMessage",value:function(){return this.source.getStatusMessage()}},{key:"getURL",value:function(){var t=this.source;return t.viewedURL||t.url}},{key:"getWatchingTime",value:function(){return Date.now()-this.createdDate}},{key:"normalizeURL",value:function(t){return t.split(/[?#]/)[0]}},{key:"sendMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.frameId,r=this.tabId,i=this.streamId;return new Promise(function(n,a){chrome.tabs.sendMessage(r,o({streamId:i},t),{frameId:e},function(t){n(t)})})}},{key:"setUpdateTimeout",value:function(t){var e=this;clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(function(){return e.update()},t)}},{key:"update",value:function(){var t=this;if(d.default.get("useWatchers")&&"noWatchers"!==this.source.lastState){if(this.updateTimeout=clearTimeout(this.updateTimeout),!this.source.canWatch())return void this.setUpdateTimeout(5e4);var e=[this.source.getViewedStreamURL(),this.getWatchingTime()];Promise.all(e).then(function(e){var r=s(e,2),i=r[0],n=r[1];(0,y.spawnerCall)("watching",null,{stream:i,watchingTime:n}).then(function(e){var r=e.timeout,n=e.streams;if(r.min&&r.min<2147483647){var a=Math.floor(Math.random()*(r.max-r.min+1))+r.min;t.setUpdateTimeout(a)}if(n){var s=!0,o=!1,u=void 0;try{for(var l,h=n[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var c=l.value;c&&i===c.stream&&t.dispatch(c)}}catch(t){o=!0,u=t}finally{try{!s&&h.return&&h.return()}finally{if(o)throw u}}}}).catch(function(e){throw t.source.setState(null),t.setUpdateTimeout(5e4),e})})}}},{key:"updateStreamInfo",value:function(){var t=this;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.source.canUseStreamInfo()))return Promise.resolve();var e=this.source,r=[e.getViewedStreamURL(),e.getProviderName(),e.getStreamInfoParams()];return Promise.all(r).then(function(t){var e=s(t,3),r=e[0],i=e[1],n=e[2];return(0,y.spawnerCall)("streamInfo",o({stream:r,providerName:i},n))}).then(function(e){e.hasOptedOut?t.dispatch({state:"optout"}):e.isBanned?t.dispatch({state:"banned"}):e.noWatchers?t.dispatch({state:"noWatchers"}):t.update()}).catch(function(e){t.update()})}},{key:"setStreamState",value:function(t){this.source.setStreamState(t)}}]),t}());e.default=v},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=[]},,,,,,,,,function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=r(21),h=i(l),c=r(4),f=i(c),p=r(2),d=r(16),m=i(d),y=function(t){function e(){var t,r,i,n;a(this,e);for(var o=arguments.length,u=Array(o),l=0;l<o;l++)u[l]=arguments[l];return r=i=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),i.streamUrlRegex=/^https?:\/\/(.*)\.afreeca\.gscdn\.com\/(.*)\.ts/i,i.config={chat:{input:{selector:"#chat_write #write_area"},button:{selector:"#chat_write #btn_send"}},shotIcons:[{children:["svg"],parent:{selector:".bj"},style:{margin:"-8px 0 0 8px"},nodes:{svg:{fill:"#328fde",attributes:{width:20,height:26,viewBox:"0 0 15 20"},style:{padding:"0 5px"}}},inactive:{nodes:{svg:{fill:"#ddd"}}}}],streamDetails:{activeViewers:{reader:"textContentNumber",selector:".viewer .count"},streamerAvatarURL:{attribute:"src",selector:".bjlogo img"},title:".bj dt"}},n=r,s(i,n)}return o(e,t),u(e,[{key:"init",value:function(){var t=this;return(0,p.dontGiveUp)(function(){return t.getProviderStreamerId()},4),Promise.resolve()}},{key:"getChannelId",value:function(){return new m.default(this.url).pathname.split("/")[2]}},{key:"getProviderStreamerId",value:function(){var t=this,e=this.getChannel();return f.default.get("http://live.afreecatv.com:8079/app/index.cgi?szBjId="+e,{silent:!0,responseType:"text"}).then(function(e){var r=new DOMParser,i=r.parseFromString(e,"text/html"),n=i.querySelector('meta[property="og:url"]'),a=n&&n.content&&new m.default("http://afreeca.com/"+n.content,!0);if(!a||!a.query.nStationNo)throw new Error("Missing nStationNo");return t.providerStreamerId=parseInt(a.query.nStationNo,10)})}},{key:"getMetaData",value:function(){var t=this.getChannel();return Promise.resolve({streamerName:t,providerStreamerId:this.providerStreamerId,languageCode:["ko"]})}},{key:"isReady",value:function(){return"active"===this.lastState}},{key:"viewedURL",get:function(){return"http://afreeca.com/"+this.getChannel()+"/"+this.getChannelId()}}]),e}(h.default);y.sourceName="afreeca",y.providerId="afreeca.com",y.providerName="AfreecaTV.com",y.providerUrl="http://afreecatv.com/",y.displayName="AfreecaTV",y.streamUrls=["*://*.afreeca.gscdn.com/*"],y.tabUrlRegex=/^https?:\/\/(w+\.)?play\.afreeca(tv)?\.com\/\w+/i,e.default=y},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},c=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},f=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),p=r(16),d=i(p),m=r(20),y=i(m),g=r(21),v=i(g),b=r(4),_=(i(b),r(3)),w=(i(_),r(78)),S=i(w),x=r(2),k=chrome.i18n,U=((0,x.getChunkLifetime)(),4e3),I=function(t){function e(t,r,i,n){s(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,i,n));return a.streamUrlRegex=/^https?:\/\/.*\.fbcdn\.net\//i,a.CHUNK_LIFETIME=50,a.liveVideo={videoId:null,postId:null},a.audioChunks=a.createChunksQueue({stream:x.AUDIO_STREAM}),a.videoChunks=a.createChunksQueue({stream:x.VIDEO_STREAM}),chrome.tabs.executeScript(t,{file:"clients/facebook.js"},function(){return a.updateClientScript()}),a._interval=setInterval(function(){return a.updateClientScript()},1500),a._mpdConsumeInterval=setInterval(function(){a.isSynchronized()&&a.consumeMPD(a.source)},U),a}return u(e,t),f(e,[{key:"config",get:function(){var t=this.liveVideo&&this.liveVideo.postId,e=t?'form > input[value="'+t+'"], .uiStreamStory[data-story-id*="VK:'+t+'"] video':null,r={closest:".uiStreamStory._1kfp, ._1qkq",index:1,selector:e};return{chat:{input:{root:h({},r),selector:"div[contenteditable]"},inputEventName:"keydown"},player:{node:{root:h({},r),selector:"video"},order:["paused","playing"],paused:{property:"paused"},playing:{notProperty:"paused"}},shotIcons:[{children:["svg","label"],parent:{root:{closest:"form",index:1,selector:e},selector:"._42nr"},style:{display:"inline-block",textAlign:"right",color:"#5890FF",cursor:"pointer"},nodes:{svg:{fill:"#5890FF",attributes:{width:13,height:18,viewBox:"0 0 15 20"},style:{margin:"0 6px -3px"}},label:{textContent:k.getMessage("takeShot"),style:{verticalAlign:"baseline",fontWeight:"bold",color:"inherit",pointerEvents:"none"}}},inactive:{style:{color:"rgba(127, 127, 127, 0.3)"},nodes:{svg:{fill:"rgba(127, 127, 127, 0.3)"}}}},{tagName:"div",children:["svg","label"],parent:{root:h({},r),selector:"._5px1"},style:{display:"inline-block",color:"#fff",opacity:"1",cursor:"pointer"},nodes:{svg:{fill:"#fff",attributes:{width:16,height:14,viewBox:"0 0 15 20"},style:{verticalAlign:"top",margin:"-1px 5px 0 0",padding:"1px 0"}},label:{textContent:k.getMessage("takeShot"),style:{display:"inline-block",verticalAlign:"top",color:"inherit",textDecoration:"none"}}},inactive:{style:{opacity:"0.2"}},focused:{nodes:{label:{style:{textDecoration:"underline"}}}}},{id:"player",tagName:"div",children:["svg"],insertBefore:0,parent:{root:h({},r),selector:"._2mbl"},style:{display:"inline-block",verticalAlign:"bottom",padding:"4px 2px",color:"#f0f0f0",opacity:"1",cursor:"pointer"},nodes:{svg:{fill:"#f0f0f0",attributes:{width:24,height:24,viewBox:"0 0 15 20"}}},inactive:{style:{opacity:"0.2"}},focused:{style:{color:"#fff"},nodes:{svg:{fill:"#fff"}}}}],streamDetails:{_parent:h({},r),activeViewers:{selector:"._5jnq._1jb_",attribute:"data-store"},streamerAvatarURL:{attribute:"src",selector:"._38vo img, img._54ru"},streamerDisplayName:{selector:"a.profileLink, a._zci"},streamURL:{attribute:"href",selector:"a.profileLink, a._8o._8r"},title:{selector:"._454q, .userContent, ._5o2k"}}}}}]),f(e,[{key:"canWatch",value:function(){return!1}},{key:"canUseStreamInfo",value:function(){return!1}},{key:"clear",value:function(t){return this.audioChunks.clear(),this.videoChunks.clear(),c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clear",this).call(this,t)}},{key:"consume",value:function(t){var e=this.getVideoIdFromMpdUrl(t),r=this.liveVideo;if(e&&r.videoId===e){var i=new d.default(t,!0);this.isSynchronized()||this.initVideo(i)}}},{key:"consumeMPD",value:function(t){var e=this,r=t.url;return this._consumePromise=Promise.resolve(this._consumePromise).then(function(){return e.getTextFile(r).then(function(t){var r,i,n=new S.default(t),s=n.findBestRepresentation("video/mp4"),o=n.findBestRepresentation("audio/mp4"),u=e.getRepresentationChunks(s),l=e.getRepresentationChunks(o);e.setInitChunks(s.template,o.template),(r=e.videoChunks).push.apply(r,a(u)),(i=e.audioChunks).push.apply(i,a(l))})})}},{key:"destroy",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._interval=clearInterval(this._interval),this._mpdConsumeInterval=clearInterval(this._mpdConsumeInterval)}},{key:"extractPTS",value:function(){return null}},{key:"findVideoIdForPostId",value:function(t){var e=this;return t?this.getTextFile("https://www.facebook.com/video/playback/playlist.m3u8?v="+t).then(y.default).then(function(t){var e=t.find(function(t){return"string"==typeof t}),r=e.match(/\/(\d+)__v__\.m3u8/);return r&&r[1]}).catch(function(r){return e.error("Unable to find videoId for postId = "+t+" using HLS playlist.",r),null}):Promise.resolve(null)}},{key:"getChannel",value:function(){if(!this.details)return null;var t=new d.default(this.details.streamURL,!0),e=t.pathname.split("/");return"profile.php"===e[1]?t.query.id:e[1]}},{key:"getInitUrl",value:function(t){return t.replace(/\-\d+\.m4/,"-init.m4")}},{key:"getMetaData",value:function(){var t=this.details;if(!t)return Promise.reject("Cannot get stream data from html");var e=new d.default(this.details&&this.details.streamURL,!0),r=/\/profile\.php/i.test(e.pathname)?parseInt(e.query.id,10):void 0;return{activeViewers:(t.activeViewers?JSON.parse(t.activeViewers):{}).viewerCount,providerStreamerId:r}}},{key:"getVideoIdFromMpdUrl",value:function(t){var e=t.match(/\/(\d+)\.mpd/);return e&&e[1]}},{key:"getInitChunkFromTemplate",value:function(t){var e=this.source.url.toString();return{url:new d.default(t.initialization,e).toString(),timestamp:null}}},{key:"getRepresentationChunks",value:function(t){var e=this,r=t.template,i=r.timescale||1e3;return t.segments.map(function(t){return{url:e.resolveUrlToSegment(r,t),extInf:t.duration/i,timestamp:t.timestamp/i}})}},{key:"getPayload",value:function(){var t=this;return this.source&&this.liveVideo.videoId?Promise.resolve(this._consumePromise).then(function(){return[].concat(t.audioChunks.trimLastSeconds(3),t.videoChunks.trimLastSeconds(3))}):[]}},{key:"getPayloadType",value:function(){return"dash"}},{key:"getSourceChunksLength",value:function(){return Math.min(this.audioChunks.length,this.videoChunks.length)}},{key:"getStatus",value:function(){return this.liveVideo.videoId?this.status:null}},{key:"initVideo",value:function(t){return this.clear(),this.source={type:"dash",url:t,videoId:this.liveVideo.videoId},this.consumeMPD(this.source)}},{key:"isReady",value:function(){return this.liveVideo.videoId&&this.getSourceChunksLength()>=(0,x.getShotTime)()}},{key:"isSynchronized",value:function(){return this.source&&this.source.videoId===this.liveVideo.videoId}},{key:"isVideoId",value:function(t,e){return t&&e&&t.length===e.length&&t.substring(0,7)===e.substring(0,7)}},{key:"onTabUpdate",value:function(t){t.url&&(this.url=t.url.split(/[#?]/)[0])}},{key:"resolveUrlToSegment",value:function(t,e){var r=t.media,i=e.timestamp,n=r.replace("$Time$",i);return new d.default(n,this.source.url.toString()).toString()}},{key:"setChunkUrlQuality",value:function(t,e){return t.replace(/\/dash-\w+\//,"/dash-"+e+"/")}},{key:"setInitChunks",value:function(t,e){var r=this.getInitChunkFromTemplate(t),i=this.getInitChunkFromTemplate(e);this.videoChunks.setInitChunk(r),this.audioChunks.setInitChunk(i)}},{key:"setLiveVideo",value:function(t){var e=this,r=this.liveVideo;if(t&&r.postId!==t.postId)return this.findVideoIdForPostId(t.postId).then(function(i){e.liveVideo=h({},t,{videoId:i||t.videoId}),e.clear("Buffer for postId = "+r.postId+" and videoId = "+r.videoId+" cleared"),e.log("current live video:",e.liveVideo)})}},{key:"updateClientScript",value:function(){var t=this;this.emitter.emit("update-client",function(e){var r=l(e,1),i=r[0];t.setLiveVideo(i)})}},{key:"viewedURL",get:function(){var t=this.getChannel(),e=this.liveVideo.postId;return t&&e?"https://www.facebook.com/"+t+"/videos/"+e:"https://www.facebook.com"}}]),e}(v.default);I.sourceName="facebook",I.providerId="facebook.com",I.providerName="Facebook Live",I.providerUrl="https://www.facebook.com/livemap",I.displayName="Facebook Live",I.streamUrls=["*://*.fbcdn.net/*"],I.tabUrlRegex=/^https?:\/\/(www\.)?facebook\.com\//i,e.default=I},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},c=r(46),f=i(c),p=r(1),d=i(p),m=d.default.get("periscopeEnabled"),y=function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),l(e,[{key:"config",get:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"config",this),r=t.shotIcons[0];return u({},t,{shotIcons:[u({},r,{className:null,insertBefore:".EmbedFooter-fixed",parent:{selector:".VideoPlayer .EmbedFooter"},style:u({},r.style,{width:"16px",height:"20px",margin:"0 15px 2px",flex:"1",textAlign:"right"}),nodes:{svg:{fill:"#fff",attributes:{width:16,height:20,viewBox:"0 0 16 22"}}}})]})}}]),e}(f.default);y.displayName="Periscope Embed",y.tabUrlRegex=m?/^https?:\/\/(www\.)?(periscope|pscp)\.tv\/w\/[^\/]+\/card/i:/(?!)/,y.allowEmbeds=!0,e.default=y},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},c=r(6),f=i(c),p=r(47),d=i(p),m=function(t){function e(){var t,r,i,n;a(this,e);for(var o=arguments.length,u=Array(o),l=0;l<o;l++)u[l]=arguments[l];return r=i=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),i.CHUNK_LIFETIME=1/0,i.MAX_SHOT_TIME=70,n=r,s(i,n)}return o(e,t),l(e,[{key:"getPayload",value:function(){var t=this.getCurrentTime();return this.sourceChunks.trimForTime(t)}},{key:"getVideoId",value:function(){var t=f.default.parse(this.getCanonicalUrl()),e=t.pathname.match(/^\/[^\/]+\/videos?\/(\d+)/);return e?parseInt(e[1],10):null}},{key:"getSource",value:function(){var t=this,e=this.getVideoId();return d.default.apiCall("player/config/video/"+e).then(function(e){var r=e.clip,i=r.bitrates.find(function(t){return t.isDefault})||r.bitrates[0];return t.source={live:!1,url:i.url}})}},{key:"init",value:function(){this.sourceChunks=this.createChunksQueue(),this.consumeSource()}},{key:"config",get:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"config",this);return u({},t,{player:{node:t.player.node,order:[]},streamDetails:u({},t.streamDetails,{host:{attribute:"href",selector:"media-player-branding .media-player-branding"},currentTime:{attribute:"currentTime",selector:".media-player__wrapper video"}})})}},{key:"viewedURL",get:function(){return"https://www.smashcast.tv/"+this.getChannel()+"/videos/"+this.getVideoId()}}]),e}(d.default);m.displayName="Smashcast VOD",m.tabUrlRegex=/^https?:\/\/(www\.)?(test\.dev\.)?smashcast\.tv\/[^\/]+\/videos?\/\d+/,e.default=m},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},h=r(6),c=i(h),f=r(27),p=i(f),d=r(3),m=(i(d),chrome.i18n,function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),u(e,[{key:"getConfig",value:function(t){var r=l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConfig",this).call(this,t),i=r.shotIcons.find(function(t){return"player"===t.id});return{player:r.player,shotIcons:[i],streamDetails:{_parent:{selector:".player .player-userinfo"},activeViewers:{reader:"textContentNumber",selector:".js-meta-viewers"},streamerAvatarURL:{attribute:"src",selector:".js-meta-picture"},streamerDisplayName:{selector:".player-userinfo__name a"},subjectName:{selector:".js-meta-game"},title:{selector:".js-meta-title"}}}}},{key:"getChannel",value:function(){return e.getParsedUrl(this.details&&this.details.host||this.frameUrl).query.channel}},{key:"viewedURL",get:function(){return"https://twitch.tv/"+this.getChannel()}}],[{key:"getParsedUrl",value:function(t){return c.default.parse(t,!0)}},{key:"recheckTabUrl",value:function(t,e){return!p.default.tabUrlRegex.test(e)}}]),e}(p.default));m.displayName="Twitch Embed",m.tabUrlRegex=/^https?:\/\/(www\.)?player\.twitch\.tv\/.*\bchannel=/i,m.allowEmbeds=!0,e.default=m},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),l=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},h=r(16),c=i(h),f=r(48),p=i(f),d=r(3),m=i(d),y=chrome.i18n,g=function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),u(e,[{key:"getConfig",value:function(t){var r=l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getConfig",this).call(this,t);return{player:r.player,shotIcons:[{id:"player",className:"player-button",children:["tooltip","svg"],insertBefore:".player-button--clips, .player-button--chromecast, .player-button--twitch",parent:{selector:".player .player-buttons-right"},style:{width:"3em",height:"3em",paddingBottom:"1em",float:"left",textAlign:"center",cursor:"pointer",boxSizing:"content-box"},nodes:{tooltip:{tagName:"span",className:"player-tip js-tip",attributes:{"data-tip":y.getMessage(this.status===m.default.READY?"takeShot":"notReadyStatusTitle")}},svg:{fill:"#fff",attributes:{viewBox:"0 0 15 20"},style:{width:"100%",height:"100%",padding:"4px 5px 6px",boxSizing:"border-box",position:"relative"}}},inactive:{nodes:{svg:{fill:"rgba(255, 255, 255, 0.2)"}}},focused:{nodes:{svg:{fill:"#a991d4"}}}}],streamDetails:{_parent:{selector:".player"},activeViewers:{reader:"textContentNumber",selector:".player-userinfo .js-meta-viewers"},streamerAvatarURL:{attribute:"src",selector:".player-userinfo .js-meta-picture"},streamerDisplayName:{selector:".player-userinfo .player-userinfo__name a"},subjectName:{selector:".player-userinfo .js-meta-game"},title:{selector:".player-userinfo .js-meta-title"},nonEmbedURL:{attribute:"href",selector:".player-userinfo .js-meta-url"},currentTime:r.streamDetails.currentTime}}}},{key:"getChannel",value:function(){return new c.default(this.details&&this.details.nonEmbedURL,!0).pathname.split("/")[1]}},{key:"getVideoId",value:function(){var t=new c.default(this.frameUrl,!0),e=t.query.video;return e&&e.replace(/^v/,"")}}]),e}(p.default);g.displayName="Twitch VOD Embed",g.tabUrlRegex=/^https?:\/\/(www\.)?player\.twitch\.tv\/.*\bvideo=v\d+\b/i,g.allowEmbeds=!0,e.default=g},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=r(49),l=i(u),h=r(1),c=i(h),f=c.default.get("vimeoEnabled"),p=function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(l.default);p.displayName="Vimeo Embed",p.tabUrlRegex=f?/^https?:\/\/(www\.)?player\.vimeo\.com\/video\/\d+/i:/(?!)/,p.allowEmbeds=!0,e.default=p},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},c=r(6),f=i(c),p=r(28),d=i(p),m=function(t){function e(){return a(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),l(e,[{key:"getCanonicalUrl",value:function(){return this.details&&this.details.host||this.frameUrl}},{key:"config",get:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"config",this);return u({},t,{streamDetails:u({},t.streamDetails,{title:{selector:".ytp-title .ytp-title-link, .overlay .title"},subjectName:{selector:'.gameName span[itemprop="name"]'},streamerName:{selector:'.channelName span[itemprop="name"]'},host:{selector:'link[rel="canonical"]',attribute:"href"}})})}}],[{key:"recheckTabUrl",value:function(t){var e=f.default.parse(t,!0);return!!e.pathname.split("/")[2]&&"0"!==e.query.controls&&!e.query.adformat&&!e.query.widget_referrer}}]),e}(d.default);m.displayName="YouTube Embed",m.tabUrlRegex=/^(https?:)?\/\/(.+\.)?youtube\.com\/embed\b/i,m.allowEmbeds=!0,e.default=m},function(t,e,r){"use strict";function i(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),u=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(i)},l=r(28),h=function(t){return t&&t.__esModule?t:{default:t}}(l),c=function(t){function e(){return n(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return s(e,t),o(e,[{key:"getProviderDisplayName",value:function(){return this.source.live?"YouTube Gaming":"YouTube Gaming VOD"}},{key:"config",get:function(){var t=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"config",this);return{player:t.player,shotIcons:[{className:"style-scope",children:["svg"],insertBefore:3,parent:{selector:".actions.ytg-watch-footer"},style:{width:"40px",height:"40px",marginLeft:"24px",borderRadius:"50%",textAlign:"center",background:"none",cursor:"pointer"},nodes:{svg:{fill:"#fff",attributes:{width:15,height:20},style:{margin:"9px auto 0"}}},inactive:{nodes:{svg:{fill:"#666"}}},focused:{style:{background:"rgba(255, 255, 255, 0.1)"}}},{id:"player",tagName:"button",className:"ytp-button",children:["svg"],insertBefore:0,parent:{selector:".ytp-right-controls"},style:{padding:"0 6px 0 8px",textAlign:"center",boxSizing:"border-box",opacity:"0.9"},nodes:{svg:{fill:"#fff",attributes:{viewBox:"0 0 15 24"},style:{height:"100%",padding:"6px 0 5px",boxSizing:"border-box"}}},inactive:{style:{opacity:"0.2"}},focused:{style:{opacity:"1"}}}],streamDetails:{providerStreamerId:t.streamDetails.providerStreamerId,mediaSequence:t.streamDetails.mediaSequence,currentTime:t.streamDetails.currentTime,videoId:t.streamDetails.videoId,activeViewers:{reader:"textContentNumber",selector:"#title .viewer-count"},streamerAvatarURL:{reader:"backgroundImage",selector:"ytg-thumbnail #image"},subjectName:{selector:".ytg-watch-footer ytg-nav-endpoint:nth-child(2) .ytg-formatted-string"},title:{attribute:"title",selector:"#title .video-title"}}}}}]),e}(h.default);c.sourceName="youtube_gaming",c.providerId="gaming.youtube.com",c.providerUrl="https://gaming.youtube.com/",c.displayName="YouTube Gaming",c.tabUrlRegex=/^https?:\/\/(.*\.)?gaming\.youtube\.com\/(watch|channel|[^\/]+\/live)/i,e.default=c},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(){function t(){i(this,t),this.messages=[],this._startTime=Date.now()}return n(t,[{key:"add",value:function(t){t&&(this.purgeMessages(),t.time=Date.now(),this.messages.push(t))}},{key:"clear",value:function(){this.messages.length=0,this._startTime=Date.now()}},{key:"getHistory",value:function(){this.purgeMessages();var t=Date.now();return{startTime:Math.max(this._startTime,t-6e4),endTime:t,messages:this.messages}}},{key:"purgeMessages",value:function(){var t=Date.now(),e=this.messages.length;this.messages=this.messages.filter(function(e){return e.time>=t-6e4}),this.messages.length<e&&(this._startTime=Date.now()-6e4)}}]),t}();e.default=a},function(t,e,r){"use strict";function i(t,e){for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var n=r[i],a=Object.getOwnPropertyDescriptor(e,n);a&&a.configurable&&void 0===t[n]&&Object.defineProperty(t,n,a)}return t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):i(t,e))}function o(t,e){return t.remain>0&&(t.howmany++,t.remain-=e.extInf),t}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),h=r(14),c=function(t){return t&&t.__esModule?t:{default:t}}(h),f=r(2),p=(0,f.getShotTime)(),d=(0,f.getChunkLifetime)(),m=3e4,y=function(t){function e(t){var r=t.stream,i=t.maxIdleTime,s=t.chunkLifetime,o=t.maxShotTime;n(this,e);var u=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.stream=r,u.config={maxIdleTime:i||m,chunkLifetime:s||d,maxShotTime:o||d},u.chunks=[],u.initChunk=null,u}return s(e,t),l(e,[{key:"clear",value:function(){this.chunks.length=0}},{key:"findChunkIndexAtTime",value:function(t){var e=this.chunks,r=Math.max(p,t)||p,i=0,n=e.findIndex(function(t){return!!t.extInf&&(i+=t.extInf)>=r});return-1===n?e.length-1:n}},{key:"findChunkIndexAtTimestamp",value:function(t){var e=this.chunks;return e.findIndex(function(r,i){return r.timestamp+r.extInf>=t||i===e.length-1})}},{key:"findChunkIndexWithMediaSequence",value:function(t){var e=this.last,r=this.size-1,i=r-e.mediaSequence+t,n=this.chunks[i];return n&&n.mediaSequence===t?i:r}},{key:"findStartChunkIndex",value:function(t){var e=this.chunks,r=this.config;if(e.length){for(var i=0,n=t;n>=0&&(i+=e[n].extInf)<=r.maxShotTime;n--);return n+1}return 0}},{key:"getInitChunk",value:function(){var t=this.initChunk;return t?u({init:!0},this.mapChunk(t)):null}},{key:"isSuccessor",value:function(t){var e=this.last,r=e&&null!=e.mediaSequence;return!e||(r?e.mediaSequence+1===t.mediaSequence:+e.timestamp<t.timestamp)}},{key:"mapChunk",value:function(t){var e=this.stream;return e?u({stream:e},t):t}},{key:"purge",value:function(){for(var t=this.chunks,e=this.config;0!==t.length&&this.length-t[0].extInf>e.chunkLifetime;)t.shift()}},{key:"push",value:function(){for(var t=this.chunks,e=this.size,r=this.config,i=arguments.length,n=Array(i),a=0;a<i;a++)n[a]=arguments[a];var s=!0,o=!1,u=void 0;try{for(var l,h=n[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var c=l.value;this.isSuccessor(c)&&(t.push(this.mapChunk(c)),this._lastPushTimestamp=Date.now())}}catch(t){o=!0,u=t}finally{try{!s&&h.return&&h.return()}finally{if(o)throw u}}if(e!==this.size)this.emit("change");else if(r.maxIdleTime&&this._lastPushTimestamp){var f=Date.now()-this._lastPushTimestamp;f>r.maxIdleTime&&(this.emit("clear","Stream cleared due to max idle time"),this._lastPushTimestamp=null)}this.purge()}},{key:"setInitChunk",value:function(t){this.initChunk=t}},{key:"setChunkLifetime",value:function(t){this.config.chunkLifetime="number"==typeof t?t:d}},{key:"slice",value:function(t,e){var r=this.getInitChunk(),i=this.chunks.slice(t,e);return r&&i.unshift(r),i}},{key:"trimBy",value:function(t){var e=this.chunks,r=t(),i=Math.max(0,Math.min(r,e.length-1)),n=this.findStartChunkIndex(i);return e.slice(n,i+1)}},{key:"trimForTime",value:function(t){var e=this;return this.trimBy(function(){return e.findChunkIndexAtTime(t)})}},{key:"trimForTimestamp",value:function(t){var e=this;return this.trimBy(function(){return e.findChunkIndexAtTimestamp(t)})}},{key:"trimToMediaSequence",value:function(t){var e=this;return this.trimBy(function(){return e.findChunkIndexWithMediaSequence(t)})}},{key:"trimLastChunks",value:function(t){return this.size>t?this.slice(0,-t):this.slice(0)}},{key:"trimLastSeconds",value:function(t){var e=this.chunks.reduceRight(o,{remain:t,howmany:0});return this.trimLastChunks(e.howmany||0)}},{key:"size",get:function(){return this.chunks.length}},{key:"length",get:function(){return this.chunks.reduce(function(t,e){return t+e.extInf},0)},set:function(t){0===t&&this.clear()}},{key:"last",get:function(){var t=this.chunks;return t[t.length-1]}}]),e}(c.default);e.default=y},function(t,e,r){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){return((31&t[0])<<8)+t[1]}function s(t){var e=(15&t[0])>>1;return((t[1]<<22)+(t[2]>>1<<15)+(t[3]<<7)+(t[4]>>1)+e*Math.pow(2,30))/f}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();e.default=function(t){if(!t)return Promise.resolve(null);c.default.log("Attempt to download and parse last watched TS",t);var e={Range:"bytes=0-10000"};return l.default.get(t,{responseType:"arraybuffer",silent:!0,headers:e}).then(function(t){return new p(t).start()}).catch(function(t){return c.default.throw("Cannot download TS file",t),null})};var u=r(4),l=i(u),h=r(0),c=i(h),f=9e4,p=function(){function t(e){n(this,t),this.content=new Uint8Array(e),this.pmt_pid=-1,this.pcr_pid=-1,this.pts_resolved=!1}return o(t,[{key:"start",value:function(){var t=this;return new Promise(function(e,r){try{for(var i=0;i<t.content.length&&!t.pts_resolved;i+=188){var n=t.content.slice(i,i+188),o=t.parsePacket(n);if(0===o.pid&&(t.pmt_pid=a(o.payload.slice(10,12))),o.pid===t.pmt_pid&&(t.pcr_pid=a(o.payload.slice(8,10))),o.pid===t.pcr_pid&&1===o.payload_unit_start_indicator){var u=o.adaptation_field?o.payload.slice(o.adaptation_field.adaptation_field_length+1):o.payload;if((128&u[6])>>7){var l=s(u.slice(8,14));t.pts_resolved=!0,c.default.log("PTS found: "+l),e(parseInt(l,10))}}}}catch(t){c.default.throw("Error in parsing TS",t)}finally{t.pts_resolved||(c.default.error("PTS not found"),e(null))}})}},{key:"parseAdaptationField",value:function(t){var e=t[4];return e<=0?{adaptation_field_length:e}:{adaptation_field_length:e,discontinuity_indicator:(128&t[5])>>>7,random_access_indicator:(64&t[5])>>>6,elementary_stream_priority_indicator:(32&t[5])>>>5,pcr_flag:(16&t[5])>>>4,opcr_flag:(8&t[5])>>>3,splicing_point_flag:(4&t[5])>>>2,transport_private_data_flag:(2&t[5])>>>1,adaptation_field_extension_flag:1&t[5]}}},{key:"parsePacket",value:function(t){if(71!==t[0])throw new Error("Not a TS packet");var e={transport_error_indicator:(128&t[1])>>>7,payload_unit_start_indicator:(64&t[1])>>>6,transport_priority:(32&t[1])>>>5,pid:(31&t[1])<<8|t[2],transport_scrambling_control:(192&t[3])>>>6,adaptation_field_control:(48&t[3])>>>4,continuity_counter:15&t[3],packet:t};if(2&e.adaptation_field_control&&(e.adaptation_field=this.parseAdaptationField(t)),1&e.adaptation_field_control){for(var r=5+(2&e.adaptation_field?e.adaptation_field.adaptation_field_length:0),i=188;255===t[i-1];--i);e.payload=t.slice(r,i)}return e}}]),t}()},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t){return{timestamp:parseInt(t.getAttribute("t"),10),duration:parseInt(t.getAttribute("d"),10)}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();e.mapSegmentAttributes=n;var s=function(){function t(e){i(this,t);var r=new DOMParser;this.xml=r.parseFromString(e,"text/xml")}return a(t,[{key:"query",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.xml;return Array.apply(null,e.querySelectorAll(t))}},{key:"findBestRepresentation",value:function(t){var e='AdaptationSet[mimeType="'+t+'"] Representation, AdaptationSet Representation[mimeType="'+t+'"]',r=this.query(e),i=function(t,e){var r=parseInt(e.getAttribute("bandwidth"),10);return r>t.bandwidth?{item:e,bandwidth:r}:t},n=r.reduce(i,{item:null,bandwidth:0})||r[r.length-1],a=n.item;return{mimeType:t,representation:a,template:this.getSegmentTemplate(a),baseUrl:this.getSegmentBaseUrl(a),segments:this.getSegments(a)}}},{key:"getSegmentTemplate",value:function(t){var e=t.querySelector("SegmentTemplate");return e?{media:e.getAttribute("media"),initialization:e.getAttribute("initialization"),timescale:parseInt(e.getAttribute("timescale"),10)}:null}},{key:"getSegmentBaseUrl",value:function(t){var e=t.querySelector("BaseURL");return e?e.textContent:null}},{key:"getSegments",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.query("SegmentTimeline S, SegmentURL",t).map(n)}}]),t}();e.default=s},,function(t,e,r){"use strict";function i(t,e){if(!t||/^(?:[a-z][a-z0-9+-.]*:)?\/\//i.test(e))return e;for(var r,i,n="",a=t.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),s=0;(i=a.indexOf("/../",s))>-1;s=i+r)r=/^\/(?:\.\.\/)*/.exec(a.slice(i))[0].length,n=(n+a.substring(s,i)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(r-1)/3+"}$"),"/");return n+a.substr(s)}Object.defineProperty(e,"__esModule",{value:!0}),e.resolveUrl=i},,,,,,,,,,,,,,,,,function(t,e,r){var i=function(){var t=new Date,e=4;return{setLogLevel:function(t){e=t==this.debug?1:t==this.info?2:t==this.warn?3:(this.error,4)},debug:function(r,n){1>=e&&console.debug("["+i.getDurationString(new Date-t,1e3)+"]","["+r+"]",n)},info:function(r,n){2>=e&&console.info("["+i.getDurationString(new Date-t,1e3)+"]","["+r+"]",n)},warn:function(r,n){3>=e&&console.warn("["+i.getDurationString(new Date-t,1e3)+"]","["+r+"]",n)},error:function(r,n){4>=e&&console.error("["+i.getDurationString(new Date-t,1e3)+"]","["+r+"]",n)}}}();i.getDurationString=function(t,e){function r(t,e){for(var r=""+t,i=r.split(".");i[0].length<e;)i[0]="0"+i[0];return i.join(".")}var i=e||1,n=t/i,a=Math.floor(n/3600);n-=3600*a;var s=Math.floor(n/60);n-=60*s;var o=1e3*n;return n=Math.floor(n),o-=1e3*n,o=Math.floor(o),a+":"+r(s,2)+":"+r(n,2)+"."+r(o,3)},i.printRanges=function(t){var e=t.length;if(e>0){for(var r="",n=0;n<e;n++)n>0&&(r+=","),r+="["+i.getDurationString(t.start(n))+","+i.getDurationString(t.end(n))+"]";return r}return"(empty)"};var n=function(t){if(!(t instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=t,this.uint8=new Uint8Array(t),this.position=0};n.prototype.getPosition=function(){return this.position},n.prototype.getEndPosition=function(){return this.buffer.byteLength},n.prototype.getLength=function(){return this.buffer.byteLength},n.prototype.seek=function(t){var e=Math.max(0,Math.min(this.uint8.length,t));this.position=isNaN(e)||!isFinite(e)?0:e},n.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},n.prototype.readUint8=function(){var t;if(this.position+1<=this.uint8.length)return t=this.uint8[this.position],this.position++,t;throw"Not enough bytes in buffer"},n.prototype.readUint16=function(){var t,e;if(this.position+2<=this.uint8.length)return t=this.uint8[this.position],this.position++,e=this.uint8[this.position],this.position++,t<<8|e;throw"Not enough bytes in buffer"},n.prototype.readUint24=function(){var t;if(this.position+3<=this.uint8.length)return t=this.uint8[this.position]<<16,this.position++,t|=this.uint8[this.position]<<8,this.position++,t|=this.uint8[this.position],this.position++,t;throw"Not enough bytes in buffer"},n.prototype.readUint32=function(){var t;if(this.position+4<=this.uint8.length)return t=this.uint8[this.position]<<24,this.position++,t|=this.uint8[this.position]<<16,this.position++,t|=this.uint8[this.position]<<8,this.position++,t|=this.uint8[this.position],this.position++,t;throw"Not enough bytes in buffer"},n.prototype.readUint64=function(){var t;if(this.position+8<=this.uint8.length)return t=this.readUint32()<<32,t|=this.readUint32();throw"Not enough bytes in buffer"},n.prototype.readString=function(t){if(this.position+t<=this.uint8.length){for(var e="",r=0;r<t;r++)e+=String.fromCharCode(this.readUint8());return e}throw"Not enough bytes in buffer"},n.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(0===e)break;t.push(e)}return String.fromCharCode.apply(null,t)},n.prototype.readInt8=function(){return this.readUint8()},n.prototype.readInt16=function(){return this.readUint16()},n.prototype.readInt32=function(){return this.readUint32()},n.prototype.readUint8Array=function(t){for(var e=[],r=0;r<t;r++)e[r]=this.readUint8();return e},n.prototype.readInt16Array=function(t){for(var e=[],r=0;r<t;r++)e[r]=this.readUint16();return e},n.prototype.readUint32Array=function(t){for(var e=[],r=0;r<t;r++)e[r]=this.readUint32();return e},n.prototype.readInt32Array=function(t){for(var e=[],r=0;r<t;r++)e[r]=this.readInt32();return e};var a=function(t,e,r){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:"object"==typeof t?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==r?a.LITTLE_ENDIAN:r};a.prototype={},a.prototype.getPosition=function(){return this.position},a.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,r=this._buffer.byteLength;if(e<=r)return void(e>this._byteLength&&(this._byteLength=e));for(r<1&&(r=1);e>r;)r*=2;var i=new ArrayBuffer(r),n=new Uint8Array(this._buffer);new Uint8Array(i,0,n.length).set(n),this.buffer=i,this._byteLength=e}},a.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),r=new Uint8Array(this._buffer,0,e.length);e.set(r),this.buffer=t}},a.BIG_ENDIAN=!1,a.LITTLE_ENDIAN=!0,a.prototype._byteLength=0,Object.defineProperty(a.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(a.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(a.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(a.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),a.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e},a.prototype.isEof=function(){return this.position>=this._byteLength},a.prototype.mapUint8Array=function(t){this._realloc(1*t);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},a.prototype.readInt32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var r=new Int32Array(t);return a.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),a.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},a.prototype.readInt16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var r=new Int16Array(t);return a.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),a.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},a.prototype.readInt8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Int8Array(t);return a.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},a.prototype.readUint32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var r=new Uint32Array(t);return a.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),a.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},a.prototype.readUint16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var r=new Uint16Array(t);return a.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),a.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},a.prototype.readUint8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Uint8Array(t);return a.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},a.prototype.readFloat64Array=function(t,e){t=null==t?this.byteLength-this.position/8:t;var r=new Float64Array(t);return a.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),a.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},a.prototype.readFloat32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var r=new Float32Array(t);return a.memcpy(r.buffer,0,this.buffer,this.byteOffset+this.position,t*r.BYTES_PER_ELEMENT),a.arrayToNative(r,null==e?this.endianness:e),this.position+=r.byteLength,r},a.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,null==t?this.endianness:t);return this.position+=4,e},a.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,null==t?this.endianness:t);return this.position+=2,e},a.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},a.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,null==t?this.endianness:t);return this.position+=4,e},a.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,null==t?this.endianness:t);return this.position+=2,e},a.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},a.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,null==t?this.endianness:t);return this.position+=4,e},a.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,null==t?this.endianness:t);return this.position+=8,e},a.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,a.memcpy=function(t,e,r,i,n){var a=new Uint8Array(t,e,n),s=new Uint8Array(r,i,n);a.set(s)},a.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},a.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},a.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=0;r<t.byteLength;r+=t.BYTES_PER_ELEMENT)for(var i=r+t.BYTES_PER_ELEMENT-1,n=r;i>n;i--,n++){var a=e[n];e[n]=e[i],e[i]=a}return t},a.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],r=0;r<t.length;r++)e[r]=t[r];return String.fromCharCode.apply(null,e)},a.prototype.readString=function(t,e){return null==e||"ASCII"==e?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==t?this.byteLength-this.position:t)]):new TextDecoder(e).decode(this.mapUint8Array(t))},a.prototype.readCString=function(t){var e=this.byteLength-this.position,r=new Uint8Array(this._buffer,this._byteOffset+this.position),i=e;null!=t&&(i=Math.min(t,e));for(var n=0;n<i&&0!==r[n];n++);var a=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(n)]);return null!=t?this.position+=i-n:n!=e&&(this.position+=1),a};var s=Math.pow(2,32);a.prototype.readUint64=function(){return this.readUint32()*s+this.readUint32()},a.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},e.DataStream=a,a.prototype.save=function(t){var e=new Blob([this.buffer]),r=window.webkitURL||window.URL;if(!r||!r.createObjectURL)throw"DataStream.save: Can't create object URL.";var i=r.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",t),n.click(),r.revokeObjectURL(i)},a.prototype._dynamicSize=!0,Object.defineProperty(a.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}}),a.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),r=new Uint8Array(e),i=new Uint8Array(this._buffer,t,r.length);r.set(i),this.buffer=e,this.position-=t},a.prototype.writeInt32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeInt32(t[r],e)},a.prototype.writeInt16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeInt16(t[r],e)},a.prototype.writeInt8Array=function(t){if(this._realloc(1*t.length),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])},a.prototype.writeUint32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeUint32(t[r],e)},a.prototype.writeUint16Array=function(t,e){if(this._realloc(2*t.length),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeUint16(t[r],e)},a.prototype.writeUint8Array=function(t){if(this._realloc(1*t.length),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])},a.prototype.writeFloat64Array=function(t,e){if(this._realloc(8*t.length),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeFloat64(t[r],e)},a.prototype.writeFloat32Array=function(t,e){if(this._realloc(4*t.length),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)a.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var r=0;r<t.length;r++)this.writeFloat32(t[r],e)},a.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,null==e?this.endianness:e),this.position+=4},a.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,null==e?this.endianness:e),this.position+=2},a.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1},a.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,null==e?this.endianness:e),this.position+=4},a.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,null==e?this.endianness:e),this.position+=2},a.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1},a.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,null==e?this.endianness:e),this.position+=4},a.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,null==e?this.endianness:e),this.position+=8},a.prototype.writeUCS2String=function(t,e,r){null==r&&(r=t.length);for(var i=0;i<t.length&&i<r;i++)this.writeUint16(t.charCodeAt(i),e);for(;i<r;i++)this.writeUint16(0)},a.prototype.writeString=function(t,e,r){var i=0;if(null==e||"ASCII"==e)if(null!=r){var n=Math.min(t.length,r);for(i=0;i<n;i++)this.writeUint8(t.charCodeAt(i));for(;i<r;i++)this.writeUint8(0)}else for(i=0;i<t.length;i++)this.writeUint8(t.charCodeAt(i));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,r)))},a.prototype.writeCString=function(t,e){var r=0;if(null!=e){var i=Math.min(t.length,e);for(r=0;r<i;r++)this.writeUint8(t.charCodeAt(r));for(;r<e;r++)this.writeUint8(0)}else{for(r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));this.writeUint8(0)}},a.prototype.writeStruct=function(t,e){for(var r=0;r<t.length;r+=2){var i=t[r+1];this.writeType(i,e[t[r]],e)}},a.prototype.writeType=function(t,e,r){var i;if("function"==typeof t)return t(this,e);if("object"==typeof t&&!(t instanceof Array))return t.set(this,e,r);var n=null,s="ASCII",o=this.position;switch("string"==typeof t&&/:/.test(t)&&(i=t.split(":"),t=i[0],n=parseInt(i[1])),"string"==typeof t&&/,/.test(t)&&(i=t.split(","),t=i[0],s=parseInt(i[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,a.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,a.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,a.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,a.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,a.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,a.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,a.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,a.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,a.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,a.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,a.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,a.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,n);break;case"string":this.writeString(e,s,n);break;case"u16string":this.writeUCS2String(e,this.endianness,n);break;case"u16stringle":this.writeUCS2String(e,a.LITTLE_ENDIAN,n);break;case"u16stringbe":this.writeUCS2String(e,a.BIG_ENDIAN,n);break;default:if(3==t.length){for(var u=t[1],l=0;l<e.length;l++)this.writeType(u,e[l]);break}this.writeStruct(t,e)}null!=n&&(this.position=o,this._realloc(n),this.position=o+n)},a.prototype.writeUint64=function(t){var e=Math.floor(t/s);this.writeUint32(e),this.writeUint32(4294967295&t)},a.prototype.writeUint24=function(t){this.writeUint8((16711680&t)>>16),this.writeUint8((65280&t)>>8),this.writeUint8(255&t)},a.prototype.adjustUint32=function(t,e){var r=this.position;this.seek(t),this.writeUint32(e),this.seek(r)},a.prototype.mapInt32Array=function(t,e){this._realloc(4*t);var r=new Int32Array(this._buffer,this.byteOffset+this.position,t);return a.arrayToNative(r,null==e?this.endianness:e),this.position+=4*t,r},a.prototype.mapInt16Array=function(t,e){this._realloc(2*t);var r=new Int16Array(this._buffer,this.byteOffset+this.position,t);return a.arrayToNative(r,null==e?this.endianness:e),this.position+=2*t,r},a.prototype.mapInt8Array=function(t){this._realloc(1*t);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=1*t,e},a.prototype.mapUint32Array=function(t,e){this._realloc(4*t);var r=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return a.arrayToNative(r,null==e?this.endianness:e),this.position+=4*t,r},a.prototype.mapUint16Array=function(t,e){this._realloc(2*t);var r=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return a.arrayToNative(r,null==e?this.endianness:e),this.position+=2*t,r},a.prototype.mapFloat64Array=function(t,e){this._realloc(8*t);var r=new Float64Array(this._buffer,this.byteOffset+this.position,t);return a.arrayToNative(r,null==e?this.endianness:e),this.position+=8*t,r},a.prototype.mapFloat32Array=function(t,e){this._realloc(4*t);var r=new Float32Array(this._buffer,this.byteOffset+this.position,t);return a.arrayToNative(r,null==e?this.endianness:e),this.position+=4*t,r};var o=function(){this.buffers=[],this.bufferIndex=-1};o.prototype=new a(new ArrayBuffer,0,a.BIG_ENDIAN),o.prototype.initialized=function(){var t;return this.bufferIndex>-1||(this.buffers.length>0?(t=this.buffers[0],0===t.fileStart?(this.buffer=t,this.bufferIndex=0,i.debug("MultiBufferStream","Stream ready for parsing"),!0):(i.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(i.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},ArrayBuffer.concat=function(t,e){i.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(new Uint8Array(t),0),r.set(new Uint8Array(e),t.byteLength),r.buffer},o.prototype.reduceBuffer=function(t,e,r){var i;return i=new Uint8Array(r),i.set(new Uint8Array(t,e,r)),i.buffer.fileStart=t.fileStart+e,i.buffer.usedBytes=0,i.buffer},o.prototype.insertBuffer=function(t){for(var e=!0,r=0;r<this.buffers.length;r++){var n=this.buffers[r];if(t.fileStart<=n.fileStart){if(t.fileStart===n.fileStart){if(t.byteLength>n.byteLength){this.buffers.splice(r,1),r--;continue}i.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring")}else t.fileStart+t.byteLength<=n.fileStart||(t=this.reduceBuffer(t,0,n.fileStart-t.fileStart)),i.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(r,0,t),0===r&&(this.buffer=t);e=!1;break}if(t.fileStart<n.fileStart+n.byteLength){var a=n.fileStart+n.byteLength-t.fileStart,s=t.byteLength-a;if(!(s>0)){e=!1;break}t=this.reduceBuffer(t,a,s)}}e&&(i.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),0===r&&(this.buffer=t))},o.prototype.logBufferLevel=function(t){var e,r,n,a,s,o=[],u="";for(n=0,a=0,e=0;e<this.buffers.length;e++)r=this.buffers[e],0===e?(s={},o.push(s),s.start=r.fileStart,s.end=r.fileStart+r.byteLength,u+="["+s.start+"-"):s.end===r.fileStart?s.end=r.fileStart+r.byteLength:(s={},s.start=r.fileStart,u+=o[o.length-1].end-1+"], ["+s.start+"-",s.end=r.fileStart+r.byteLength,o.push(s)),n+=r.usedBytes,a+=r.byteLength;o.length>0&&(u+=s.end-1+"]");var l=t?i.info:i.debug;0===this.buffers.length?l("MultiBufferStream","No more buffer in memory"):l("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+n+"/"+a+" bytes): "+u)},o.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)e=this.buffers[t],e.usedBytes===e.byteLength&&(i.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)},o.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length){if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,r=this.buffer.usedBytes,n=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=r,this.buffer.fileStart=n,i.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}return!1}return!1},o.prototype.findPosition=function(t,e,r){var n,a=null,s=-1;for(n=!0===t?0:this.bufferIndex;n<this.buffers.length&&(a=this.buffers[n],a.fileStart<=e);)s=n,r&&(a.fileStart+a.byteLength<=e?a.usedBytes=a.byteLength:a.usedBytes=e-a.fileStart,this.logBufferLevel()),n++;return-1!==s?(a=this.buffers[s],a.fileStart+a.byteLength>=e?(i.debug("MultiBufferStream","Found position in existing buffer #"+s),s):-1):-1},o.prototype.findEndContiguousBuf=function(t){var e,r,i,n=void 0!==t?t:this.bufferIndex;if(r=this.buffers[n],this.buffers.length>n+1)for(e=n+1;e<this.buffers.length&&(i=this.buffers[e],i.fileStart===r.fileStart+r.byteLength);e++)r=i;return r.fileStart+r.byteLength},o.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return-1!==e?this.findEndContiguousBuf(e):t},o.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()},o.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},o.prototype.seek=function(t,e,r){var n;return n=this.findPosition(e,t,r),-1!==n?(this.buffer=this.buffers[n],this.bufferIndex=n,this.position=t-this.buffer.fileStart,i.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(i.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},o.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},o.prototype.getLength=function(){return this.byteLength},o.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength};var u=function(){var t=[];t[3]="ES_Descriptor",t[4]="DecoderConfigDescriptor",t[5]="DecoderSpecificInfo",t[6]="SLConfigDescriptor";var e=this,r={};return this.parseOneDescriptor=function(e){var n,a,s,o=0,u=0;for(n=e.readUint8(),o++,s=e.readUint8(),o++;128&s;)u=(127&s)<<7,s=e.readUint8(),o++;return u+=127&s,i.debug("MPEG4DescriptorParser","Found "+(t[n]||"Descriptor "+n)+", size "+u+" at position "+e.getPosition()),a=t[n]?new r[t[n]](u):new r.Descriptor(u),a.parse(e),a},r.Descriptor=function(t,e){this.tag=t,this.size=e,this.descs=[]},r.Descriptor.prototype.parse=function(t){this.data=t.readUint8Array(this.size)},r.Descriptor.prototype.findDescriptor=function(t){for(var e=0;e<this.descs.length;e++)if(this.descs[e].tag==t)return this.descs[e];return null},r.Descriptor.prototype.parseRemainingDescriptors=function(t){for(var r=t.position;t.position<r+this.size;){var i=e.parseOneDescriptor(t);this.descs.push(i)}},r.ES_Descriptor=function(t){r.Descriptor.call(this,3,t)},r.ES_Descriptor.prototype=new r.Descriptor,r.ES_Descriptor.prototype.parse=function(t){if(this.ES_ID=t.readUint16(),this.flags=t.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=t.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags){var e=t.readUint8();this.URL=t.readString(e),this.size-=e+1}else this.URL=null;32&this.flags?(this.OCR_ES_ID=t.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(t)},r.ES_Descriptor.prototype.getOTI=function(t){var e=this.findDescriptor(4);return e?e.oti:0},r.ES_Descriptor.prototype.getAudioConfig=function(t){var e=this.findDescriptor(4);if(!e)return null;var r=e.findDescriptor(5);return r&&r.data?(248&r.data[0])>>3:null},r.DecoderConfigDescriptor=function(t){r.Descriptor.call(this,4,t)},r.DecoderConfigDescriptor.prototype=new r.Descriptor,r.DecoderConfigDescriptor.prototype.parse=function(t){this.oti=t.readUint8(),this.streamType=t.readUint8(),this.bufferSize=t.readUint24(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32(),this.size-=13,this.parseRemainingDescriptors(t)},r.DecoderSpecificInfo=function(t){r.Descriptor.call(this,5,t)},r.DecoderSpecificInfo.prototype=new r.Descriptor,r.SLConfigDescriptor=function(t){r.Descriptor.call(this,6,t)},r.SLConfigDescriptor.prototype=new r.Descriptor,this},l={ERR_NOT_ENOUGH_DATA:0,OK:1,boxCodes:["mdat","idat","free","skip","avcC","hvcC","ftyp","styp","payl","vttC","rtp ","sdp ","btrt","frma","trpy","tpyl","totl","tpay","dmed","dimm","drep","nump","npck","maxr","tmin","tmax","dmax","pmax","payt","vmhd","smhd","hmhd","idat","meco","udta","strk","free","skip"],fullBoxCodes:["mvhd","tkhd","mdhd","hdlr","vmhd","smhd","hmhd","nmhd","url ","urn ","ctts","cslg","stco","co64","stsc","stss","stsz","stz2","stts","stsh","mehd","trex","mfhd","tfhd","trun","tfdt","esds","subs","txtC","sidx","emsg","prft","pssh","elst","dref","url ","urn ","sbgp","sgpd","cprt","iods","ssix","tfra","mfro","pdin","tsel","trep","leva","stri","stsg","schm","stvi","padb","stdp","sdtp","saio","saiz","meta","xml ","bxml","iloc","pitm","ipro","iinf","infe","iref","mere","kind","elng"],containerBoxCodes:[["moov",["trak","sidx"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun"]],["vttc"],["tref"],["iref"],["udta"],["mfra"],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp"]],sampleEntryCodes:[{prefix:"Visual",types:["mp4v","avc1","avc2","avc3","avc4","avcp","drac","encv","mjp2","mvc1","mvc2","resv","s263","svc1","vc-1","hvc1","hev1"]},{prefix:"Audio",types:["mp4a","ac-3","alac","dra1","dtsc","dtse",,"dtsh","dtsl","ec-3","enca","g719","g726","m4ae","mlpa","raw ","samr","sawb","sawp","sevc","sqcp","ssmv","twos",".mp3"]},{prefix:"Hint",types:["fdp ","m2ts","pm2t","prtp","rm2t","rrtp","rsrp","rtp ","sm2t","srtp"]},{prefix:"Metadata",types:["metx","mett","urim"]},{prefix:"Subtitle",types:["stpp","wvtt","sbtt","tx3g","stxt"]},{prefix:"System",types:["mp4s"]}],sampleGroupEntryCodes:["roll","prol","alst","rap ","tele","avss","avll","sync","tscl","tsas","stsa","scif","mvif","scnm","dtrt","vipr","tele","rash"],trackGroupTypes:["msrc"],initialize:function(){var t,e,r;for(l.FullBox.prototype=new l.Box,l.ContainerBox.prototype=new l.Box,l.SampleEntry.prototype=new l.FullBox,l.TrackGroupTypeBox.prototype=new l.FullBox,r=l.boxCodes.length,t=0;t<r;t++)l[l.boxCodes[t]+"Box"]=function(t){return function(e){l.Box.call(this,l.boxCodes[t],e)}}(t),l[l.boxCodes[t]+"Box"].prototype=new l.Box;for(r=l.fullBoxCodes.length,t=0;t<r;t++)l[l.fullBoxCodes[t]+"Box"]=function(t){return function(e){l.FullBox.call(this,l.fullBoxCodes[t],e)}}(t),l[l.fullBoxCodes[t]+"Box"].prototype=new l.FullBox;for(r=l.containerBoxCodes.length,t=0;t<r;t++)l[l.containerBoxCodes[t][0]+"Box"]=function(t,e){return function(r){if(l.ContainerBox.call(this,l.containerBoxCodes[t][0],r),e){this.subBoxNames=e;for(var i=e.length,n=0;n<i;n++)this[e[n]+"s"]=[]}}}(t,l.containerBoxCodes[t][1]),l[l.containerBoxCodes[t][0]+"Box"].prototype=new l.ContainerBox;for(r=l.sampleEntryCodes.length,e=0;e<r;e++){var i=l.sampleEntryCodes[e].prefix,n=l.sampleEntryCodes[e].types,a=n.length;for(l[i+"SampleEntry"]=function(t,e){l.SampleEntry.call(this,t,e)},l[i+"SampleEntry"].prototype=new l.SampleEntry,t=0;t<a;t++)l[n[t]+"SampleEntry"]=function(t,e){return function(r){l[l.sampleEntryCodes[t].prefix+"SampleEntry"].call(this,l.sampleEntryCodes[t].types[e],r)}}(e,t),l[n[t]+"SampleEntry"].prototype=new l[i+"SampleEntry"]}for(r=l.sampleGroupEntryCodes.length,t=0;t<r;t++)l[l.sampleGroupEntryCodes[t]+"SampleGroupEntry"]=function(t){return function(e){l.SampleGroupEntry.call(this,l.sampleGroupEntryCodes[t],e)}}(t),l[l.sampleGroupEntryCodes[t]+"SampleGroupEntry"].prototype=new l.SampleGroupEntry;for(r=l.trackGroupTypes.length,t=0;t<r;t++)l[l.trackGroupTypes[t]+"Box"]=function(t){return function(e){l.TrackGroupTypeBox.call(this,l.trackGroupTypes[t],e)}}(t),l[l.trackGroupTypes[t]+"Box"].prototype=new l.TrackGroupTypeBox},Box:function(t,e){this.type=t,this.size=e},FullBox:function(t,e){l.Box.call(this,t,e),this.flags=0,this.version=0},ContainerBox:function(t,e){l.Box.call(this,t,e),this.boxes=[]},SampleEntry:function(t,e,r,i){l.Box.call(this,t,e),this.hdr_size=r,this.start=i,this.boxes=[]},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){l.FullBox.call(this,t,e)}};l.initialize(),l.TKHD_FLAG_ENABLED=1,l.TKHD_FLAG_IN_MOVIE=2,l.TKHD_FLAG_IN_PREVIEW=4,l.TFHD_FLAG_BASE_DATA_OFFSET=1,l.TFHD_FLAG_SAMPLE_DESC=2,l.TFHD_FLAG_SAMPLE_DUR=8,l.TFHD_FLAG_SAMPLE_SIZE=16,l.TFHD_FLAG_SAMPLE_FLAGS=32,l.TFHD_FLAG_DUR_EMPTY=65536,l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,l.TRUN_FLAGS_DATA_OFFSET=1,l.TRUN_FLAGS_FIRST_FLAG=4,l.TRUN_FLAGS_DURATION=256,l.TRUN_FLAGS_SIZE=512,l.TRUN_FLAGS_FLAGS=1024,l.TRUN_FLAGS_CTS_OFFSET=2048,e.BoxParser=l,l.SampleEntry.prototype.isVideo=function(){return!1},l.SampleEntry.prototype.isAudio=function(){return!1},l.SampleEntry.prototype.isSubtitle=function(){return!1},l.SampleEntry.prototype.isMetadata=function(){return!1},l.SampleEntry.prototype.isHint=function(){return!1},l.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},l.SampleEntry.prototype.getWidth=function(){return""},l.SampleEntry.prototype.getHeight=function(){return""},l.SampleEntry.prototype.getChannelCount=function(){return""},l.SampleEntry.prototype.getSampleRate=function(){return""},l.SampleEntry.prototype.getSampleSize=function(){return""},l.VisualSampleEntry.prototype.isVideo=function(){return!0},l.VisualSampleEntry.prototype.getWidth=function(){return this.width},l.VisualSampleEntry.prototype.getHeight=function(){return this.height},l.AudioSampleEntry.prototype.isAudio=function(){return!0},l.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},l.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},l.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},l.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},l.MetadataSampleEntry.prototype.isMetadata=function(){return!0},l.decimalToHex=function(t,e){var r=Number(t).toString(16);for(e=void 0===e||null===e?e=2:e;r.length<e;)r="0"+r;return r},l.avc1SampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+l.decimalToHex(this.avcC.AVCProfileIndication)+l.decimalToHex(this.avcC.profile_compatibility)+l.decimalToHex(this.avcC.AVCLevelIndication):t},l.hvc1SampleEntry.prototype.getCodec=function(){var t,e=l.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C"}e+=this.hvcC.general_profile_idc,e+=".";var r=this.hvcC.general_profile_compatibility,i=0;for(t=0;t<32&&(i|=1&r,31!=t);t++)i<<=1,r>>=1;e+=l.decimalToHex(i,0),e+=".",0===this.hvcC.general_tier_flag?e+="L":e+="H",e+=this.hvcC.general_level_idc;var n=!1,a="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||n)&&(a="."+l.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+a,n=!0);e+=a}return e},l.mp4aSampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),r=this.esds.esd.getAudioConfig();return t+"."+l.decimalToHex(e)+(r?"."+r:"")}return t},l.stxtSampleEntry.prototype.getCodec=function(){var t=l.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t},l.parseOneBox=function(t,e){var r,n,a=t.getPosition(),s=0;if(t.getEndPosition()-a<8)return i.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:l.ERR_NOT_ENOUGH_DATA};var o=t.readUint32(),u=t.readString(4);if(i.debug("BoxParser","Found box of type "+u+" and size "+o+" at position "+a),s=8,"uuid"==u&&(n=t.readUint8Array(16),s+=16),1==o){if(t.getEndPosition()-t.getPosition()<8)return t.seek(a),i.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+u+'" box'),{code:l.ERR_NOT_ENOUGH_DATA};o=t.readUint64(),s+=8}else if(0===o&&"mdat"!==u)throw"Unlimited box size not supported";return a+o>t.getEndPosition()?(t.seek(a),i.warn("BoxParser",'Not enough data in stream to parse the entire "'+u+'" box'),{code:l.ERR_NOT_ENOUGH_DATA,type:u,size:o,hdr_size:s,start:a}):e?{code:l.OK,type:u,size:o,hdr_size:s,start:a}:(l[u+"Box"]?r=new l[u+"Box"](o):("uuid"!==u&&i.warn("BoxParser","Unknown box type: "+u),r=new l.Box(u,o),n&&(r.uuid=n)),r.hdr_size=s,r.start=a,r.write===l.Box.prototype.write&&"mdat"!==r.type&&(i.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),{code:l.OK,box:r,size:o})},l.Box.prototype.parse=function(t){"mdat"!=this.type?this.data=t.readUint8Array(this.size-this.hdr_size):0===this.size?t.seek(t.getEndPosition()):t.seek(this.start+this.size)},l.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},l.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},l.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},l.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},l.ContainerBox.prototype.parse=function(t){for(var e,r;t.getPosition()<this.start+this.size;)e=l.parseOneBox(t,!1),r=e.box,this.boxes.push(r),this.subBoxNames&&-1!=this.subBoxNames.indexOf(r.type)?this[this.subBoxNames[this.subBoxNames.indexOf(r.type)]+"s"].push(r):this[r.type]=r},l.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=31&this.language,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)},l.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()},l.TrackReferenceTypeBox=function(t,e,r,i){l.Box.call(this,t,e),this.hdr_size=r,this.start=i},l.TrackReferenceTypeBox.prototype=new l.Box,l.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)},l.avcCBox.prototype.parse=function(t){var e,r,i,n;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=3&t.readUint8(),r=31&t.readUint8(),n=this.size-this.hdr_size-6,this.SPS=new Array(r),e=0;e<r;e++)i=t.readUint16(),this.SPS[e]=t.readUint8Array(i),n-=2+i;for(r=t.readUint8(),n--,this.PPS=new Array(r),e=0;e<r;e++)i=t.readUint16(),this.PPS[e]=t.readUint8Array(i),n-=2+i;n>0&&(this.ext=t.readUint8Array(n))},l.btrtBox.prototype.parse=function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()},l.co64Box.prototype.parse=function(t){var e,r;if(this.parseFullHeader(t),e=t.readUint32(),this.chunk_offsets=[],0===this.version)for(r=0;r<e;r++)this.chunk_offsets.push(t.readUint64());else this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.cprtBox.prototype.parse=function(t){this.parseFullHeader(t),this.parseLanguage(t),this.notice=t.readCString(),t.getPosition()>this.start+this.size&&(i.warn("BoxParser","Parsed more than the size of the box (null-terminated string problem?)"),t.seek(this.start+this.size))},l.cslgBox.prototype.parse=function(t){this.parseFullHeader(t),0===this.version?(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32()):this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.cttsBox.prototype.parse=function(t){var e,r;if(this.parseFullHeader(t),e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],0===this.version)for(r=0;r<e;r++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32());else if(1==this.version)for(r=0;r<e;r++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32());else this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.dimmBox.prototype.parse=function(t){this.bytessent=t.readUint64()},l.dmaxBox.prototype.parse=function(t){this.time=t.readUint32()},l.dmedBox.prototype.parse=function(t){this.bytessent=t.readUint64()},l.drefBox.prototype.parse=function(t){var e,r;this.parseFullHeader(t),this.entries=[];for(var i=t.readUint32(),n=0;n<i;n++)e=l.parseOneBox(t,!1),r=e.box,this.entries.push(r)},l.drepBox.prototype.parse=function(t){this.bytessent=t.readUint64()},l.elngBox.prototype.parse=function(t){this.parseFullHeader(t),this.extended_language=t.readString(this.size-this.hdr_size)},l.elstBox.prototype.parse=function(t){this.parseFullHeader(t),this.entries=[];for(var e=t.readUint32(),r=0;r<e;r++){var i={};this.entries.push(i),1===this.version?(i.segment_duration=t.readUint64(),i.media_time=t.readInt64()):(i.segment_duration=t.readUint32(),i.media_time=t.readInt32()),i.media_rate_integer=t.readInt16(),i.media_rate_fraction=t.readInt16()}},l.emsgBox.prototype.parse=function(t){this.parseFullHeader(t),this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32();var e=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));this.message_data=t.readUint8Array(e)},l.esdsBox.prototype.parse=function(t){this.parseFullHeader(t);var e=t.readUint8Array(this.size-this.hdr_size);if(void 0!==u){var r=new u;this.esd=r.parseOneDescriptor(new a(e.buffer,0,a.BIG_ENDIAN))}},l.frmaBox.prototype.parse=function(t){this.data_format=t.readString(4)},l.ftypBox.prototype.parse=function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var r=0;e>=4;)this.compatible_brands[r]=t.readString(4),e-=4,r++},l.hdlrBox.prototype.parse=function(t){this.parseFullHeader(t),0===this.version?(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),"\0"===this.name[this.name.length-1]&&(this.name=this.name.slice(0,-1))):this.data=t.readUint8Array(this.size-this.hdr_size)},l.hvcCBox.prototype.parse=function(t){var e,r,i,n;this.configurationVersion=t.readUint8(),n=t.readUint8(),this.general_profile_space=n>>6,this.general_tier_flag=(32&n)>>5,this.general_profile_idc=31&n,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=4095&t.readUint16(),this.parallelismType=3&t.readUint8(),this.chromaFormat=3&t.readUint8(),this.bitDepthLumaMinus8=7&t.readUint8(),this.bitDepthChromaMinus8=7&t.readUint8(),this.avgFrameRate=t.readUint16(),n=t.readUint8(),this.constantFrameRate=n>>6,this.numTemporalLayers=(13&n)>>3,this.temporalIdNested=(4&n)>>2,this.lengthSizeMinusOne=3&n,this.nalu_arrays=[];var a=t.readUint8();for(e=0;e<a;e++){var s=[];this.nalu_arrays.push(s),n=t.readUint8(),s.completeness=(128&n)>>7,s.nalu_type=63&n;var o=t.readUint16();for(r=0;r<o;r++){var u={};s.push(u),i=t.readUint16(),u.data=t.readUint8Array(i)}}},l.iinfBox.prototype.parse=function(t){var e;this.parseFullHeader(t),0===this.version?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var r=0;r<this.entry_count;r++)e=l.parseOneBox(t,!1),"infe"!==e.box.type&&i.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[r]=e.box},l.ilocBox.prototype.parse=function(t){var e;this.parseFullHeader(t),e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=15&e,e=t.readUint8(),this.base_offset_size=e>>4&15,1===this.version||2===this.version?this.index_size=15&e:this.index_size=0,this.items=[];var r=0;if(this.version<2)r=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";r=t.readUint32()}for(var i=0;i<r;i++){var n={};if(this.items.push(n),this.version<2)n.item_ID=t.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";n.item_ID=t.readUint16()}switch(1!==this.version&&2!==this.version||(n.construction_method=15&t.readUint16()),n.data_reference_index=t.readUint16(),this.base_offset_size){case 0:n.base_offset=0;break;case 4:n.base_offset=t.readUint32();break;case 8:n.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var a=t.readUint16();n.extents=[];for(var s=0;s<a;s++){var o={};if(n.extents.push(o),1===this.version||2===this.version)switch(this.index_size){case 0:o.extent_index=0;break;case 4:o.extent_index=t.readUint32();break;case 8:o.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:o.extent_offset=0;break;case 4:o.extent_offset=t.readUint32();break;case 8:o.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:o.extent_length=0;break;case 4:o.extent_length=t.readUint32();break;case 8:o.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}},l.infeBox.prototype.parse=function(t){if(this.parseFullHeader(t),0!==this.version&&1!==this.version||(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),1===this.version)return this.extension_type=t.readString(4),i.warn("BoxParser","Cannot parse extension type"),void t.seek(this.start+this.size);this.version>=2&&(2===this.version?this.item_ID=t.readUint16():3===this.version&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.name=t.readCString(),"mime"===this.item_type?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):"uri "===this.item_type&&(this.item_uri_type=t.readCString())),t.getPosition()>this.start+this.size&&(i.warn("BoxParser","Parsed more than the size of the box (null-terminated string problem?)"),t.seek(this.start+this.size))},l.irefBox=function(t){l.FullBox.call(this,"iref",t),this.references=[]},l.irefBox.prototype=new l.FullBox,l.irefBox.prototype.parse=function(t){var e,r;for(this.parseFullHeader(t);t.getPosition()<this.start+this.size;)e=l.parseOneBox(t,!0),r=0===this.version?new l.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):new l.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start),r.write===l.Box.prototype.write&&"mdat"!==r.type&&(i.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.references.push(r)},l.kindBox=function(t){l.FullBox.call(this,"kind",t),this.schemeURI="",this.value=""},l.kindBox.prototype=new l.FullBox,l.kindBox.prototype.parse=function(t){this.parseFullHeader(t),this.schemeURI=t.readCString(),this.value=t.readCString()},l.levaBox.prototype.parse=function(t){this.parseFullHeader(t);var e=t.readUint8();this.levels=[];for(var r=0;r<e;r++){var n={};this.levels[r]=n,n.track_ID=t.readUint32();var a=t.readUint8();switch(n.padding_flag=a>>7,n.assignment_type=127&a,n.assignment_type){case 0:n.grouping_type=t.readUint32();break;case 1:n.grouping_type=t.readUint32(),n.grouping_type_parameter=t.readUint32();break;case 2:case 3:break;case 4:n.sub_track_id=t.readUint32();break;default:i.warn("BoxParser","Unknown leva assignement type")}}},l.maxrBox.prototype.parse=function(t){this.period=t.readUint32(),this.bytes=t.readUint32()},l.mdhdBox.prototype.parse=function(t){this.parseFullHeader(t),1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()},l.mehdBox.prototype.parse=function(t){this.parseFullHeader(t),1==this.version?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()},l.metaBox.prototype.parse=function(t){this.parseFullHeader(t),this.boxes=[],l.ContainerBox.prototype.parse.call(this,t)},l.mfhdBox.prototype.parse=function(t){this.parseFullHeader(t),this.sequence_number=t.readUint32()},l.mfroBox.prototype.parse=function(t){this.parseFullHeader(t),this.size=t.readUint32()},l.mvhdBox.prototype.parse=function(t){this.flags=0,this.parseFullHeader(t),1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()},l.npckBox.prototype.parse=function(t){this.packetssent=t.readUint32()},l.numpBox.prototype.parse=function(t){this.packetssent=t.readUint64()},l.padbBox.prototype.parse=function(t){this.parseFullHeader(t);var e=t.readUint32();this.padbits=[];for(var r=0;r<Math.floor((e+1)/2);r++)this.padbits=t.readUint8()},l.paylBox.prototype.parse=function(t){this.text=t.readString(this.size-this.hdr_size)},l.paytBox.prototype.parse=function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)},l.pdinBox.prototype.parse=function(t){this.parseFullHeader(t);var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var r=0;r<e;r++)this.rate[r]=t.readUint32(),this.initial_delay[r]=t.readUint32()},l.pitmBox.prototype.parse=function(t){this.parseFullHeader(t),0===this.version?this.item_id=t.readUint16():this.item_id=t.readUint32()},l.pmaxBox.prototype.parse=function(t){this.bytes=t.readUint32()},l.prftBox.prototype.parse=function(t){this.parseFullHeader(t),this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),0===this.version?this.media_time=t.readUint32():this.media_time=t.readUint64()},l.psshBox.prototype.parse=function(t){if(this.parseFullHeader(t),this.system_id=t.readUint8Array(16),this.version>0){var e=t.readUint32();this.kid=[];for(var r=0;r<e;r++)this.kid[r]=t.readUint8Array(16)}var i=t.readUint32();i>0&&(this.data=t.readUint8Array(i))},l["rtp Box"].prototype.parse=function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)},l.saioBox.prototype.parse=function(t){this.parseFullHeader(t),1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var r=0;r<e;r++)0===this.version?this.offset[r]=t.readUint32():this.offset[r]=t.readUint64()},l.saizBox.prototype.parse=function(t){this.parseFullHeader(t),1&this.flags&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var e=t.readUint32();if(this.sample_info_size=[],0===this.default_sample_info_size)for(var r=0;r<e;r++)this.sample_info_size[r]=t.readUint32()},l.mettSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)},l.metxSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)},l.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8},l.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)},l.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size},l.SampleEntry.prototype.parseFooter=function(t){for(var e,r;t.getPosition()<this.start+this.size;)e=l.parseOneBox(t,!1),r=e.box,this.boxes.push(r),this[r.type]=r},l.VisualSampleEntry.prototype.parse=function(t){this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),this.compressorname=t.readString(32),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)},l.AudioSampleEntry.prototype.parse=function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/65536,this.parseFooter(t)},l.sbttSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)},l.stppSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)},l.stxtSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)},l.tx3gSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)},l.alstSampleGroupEntry.prototype.parse=function(t){var e,r=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<r;e++)this.sample_offset[e]=t.readUint32();var i=this.description_length-4-4*r;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<i/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()},l.avllSampleGroupEntry.prototype.parse=function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()},l.avssSampleGroupEntry.prototype.parse=function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var r=t.readUint8(),i=0;i<r;i++){var n={};this.dependency.push(n),n.subSeqDirectionFlag=t.readUint8(),n.layerNumber=t.readUint8(),n.subSequenceIdentifier=t.readUint16()}},l.dtrtSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.mvifSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.prolSampleGroupEntry.prototype.parse=function(t){this.roll_distance=t.readInt16()},l["rap SampleGroupEntry"].prototype.parse=function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=127&e},l.rashSampleGroupEntry.prototype.parse=function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(1===this.operation_point_count?2:6*this.operation_point_count)+9)i.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(1===this.operation_point_count)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}},l.rollSampleGroupEntry.prototype.parse=function(t){this.roll_distance=t.readInt16()},l.SampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)},l.scifSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.scnmSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.stsaSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.syncSampleGroupEntry.prototype.parse=function(t){var e=t.readUint8();this.NAL_unit_type=63&e},l.teleSampleGroupEntry.prototype.parse=function(t){var e=t.readUint8();this.level_independently_decodable=e>>7},l.tsasSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.tsclSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.viprSampleGroupEntry.prototype.parse=function(t){i.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},l.sbgpBox.prototype.parse=function(t){this.parseFullHeader(t),this.grouping_type=t.readString(4),1===this.version?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),r=0;r<e;r++){var i={};this.entries.push(i),i.sample_count=t.readInt32(),i.group_description_index=t.readInt32()}},l.schmBox.prototype.parse=function(t){this.parseFullHeader(t),this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),1&this.flags&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))},l["sdp Box"].prototype.parse=function(t){this.sdptext=t.readString(this.size-this.hdr_size)},l.sdtpBox.prototype.parse=function(t){var e;this.parseFullHeader(t);var r=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var i=0;i<r;i++)e=t.readUint8(),this.is_leading[i]=e>>6,this.sample_depends_on[i]=e>>4&3,this.sample_is_depended_on[i]=e>>2&3,this.sample_has_redundancy[i]=3&e},l.sgpdBox.prototype.parse=function(t){this.parseFullHeader(t),this.grouping_type=t.readString(4),i.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),1===this.version?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),r=0;r<e;r++){var n;n=l[this.grouping_type+"SampleGroupEntry"]?new l[this.grouping_type+"SampleGroupEntry"](this.grouping_type):new l.SampleGroupEntry(this.grouping_type),this.entries.push(n),1===this.version&&0===this.default_length?n.description_length=t.readUint32():n.description_length=this.default_length,n.write===l.SampleGroupEntry.prototype.write&&(i.warn("BoxParser"," SampleEntry for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),n.data=t.readUint8Array(n.description_length),t.position-=n.description_length),n.parse(t)}},l.sidxBox.prototype.parse=function(t){this.parseFullHeader(t),this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),0===this.version?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),r=0;r<e;r++){var i={};this.references.push(i);var n=t.readUint32();i.reference_type=n>>31&1,i.referenced_size=2147483647&n,i.subsegment_duration=t.readUint32(),n=t.readUint32(),i.starts_with_SAP=n>>31&1,i.SAP_type=n>>28&7,i.SAP_delta_time=268435455&n}},l.SingleItemTypeReferenceBox=function(t,e,r,i){l.Box.call(this,t,e),this.hdr_size=r,this.start=i},l.SingleItemTypeReferenceBox.prototype=new l.Box,l.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var r=0;r<e;r++)this.references[r]=t.readUint16()},l.SingleItemTypeReferenceBoxLarge=function(t,e,r,i){l.Box.call(this,t,e),this.hdr_size=r,this.start=i},l.SingleItemTypeReferenceBoxLarge.prototype=new l.Box,l.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var r=0;r<e;r++)this.references[r]=t.readUint32()},l.ssixBox.prototype.parse=function(t){this.parseFullHeader(t),this.subsegments=[];for(var e=t.readUint32(),r=0;r<e;r++){var i={};this.subsegments.push(i),i.ranges=[];for(var n=t.readUint32(),a=0;a<n;a++){var s={};i.ranges.push(s),s.level=t.readUint8(),s.range_size=t.readUint24()}}},l.stcoBox.prototype.parse=function(t){var e;this.parseFullHeader(t),e=t.readUint32(),0===this.version?this.chunk_offsets=t.readUint32Array(e):this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.stdpBox.prototype.parse=function(t){this.parseFullHeader(t);var e=(this.size-this.hdr_size)/2;this.priority=[];for(var r=0;r<e;r++)this.priority[r]=t.readUint16()},l.striBox.prototype.parse=function(t){this.parseFullHeader(t),this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var r=0;r<e;r++)this.attribute_list[r]=t.readUint32()},l.stscBox.prototype.parse=function(t){var e,r;if(this.parseFullHeader(t),e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],0===this.version)for(r=0;r<e;r++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32());else this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.stsdBox=function(t){l.FullBox.call(this,"stsd",t),this.entries=[]},l.stsdBox.prototype=new l.FullBox,l.stsdBox.prototype.parse=function(t){var e,r,n,a;for(this.parseFullHeader(t),n=t.readUint32(),e=1;e<=n;e++)r=l.parseOneBox(t,!0),l[r.type+"SampleEntry"]?(a=new l[r.type+"SampleEntry"](r.size),a.hdr_size=r.hdr_size,a.start=r.start):(i.warn("BoxParser","Unknown sample entry type: "+r.type),a=new l.SampleEntry(r.type,r.size,r.hdr_size,r.start)),a.write===l.SampleEntry.prototype.write&&(i.warn("BoxParser",a.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),a.parseDataAndRewind(t)),a.parse(t),this.entries.push(a)},l.stsgBox.prototype.parse=function(t){this.parseFullHeader(t),this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var r=0;r<e;r++)this.group_description_index[r]=t.readUint32()},l.stshBox.prototype.parse=function(t){var e,r;if(this.parseFullHeader(t),e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],0===this.version)for(r=0;r<e;r++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32());else this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.stssBox.prototype.parse=function(t){var e,r;if(this.parseFullHeader(t),r=t.readUint32(),0===this.version)for(this.sample_numbers=[],e=0;e<r;e++)this.sample_numbers.push(t.readUint32());else this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.stszBox.prototype.parse=function(t){var e;if(this.parseFullHeader(t),this.sample_sizes=[],0===this.version)if(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),0===this.sample_size)this.sample_sizes=t.readUint32Array(this.sample_count);else for(e=0;e<this.sample_count;e++)this.sample_sizes[e]=this.sample_size;else this.data=t.readUint8Array(this.size-this.hdr_size)},l.sttsBox.prototype.parse=function(t){var e,r,n;if(this.parseFullHeader(t),e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],0===this.version)for(r=0;r<e;r++)this.sample_counts.push(t.readUint32()),n=t.readInt32(),n<0&&(i.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),n=1),this.sample_deltas.push(n);else this.data=t.readUint8Array(this.size-this.hdr_size-4)},l.stviBox.prototype.parse=function(t){this.parseFullHeader(t);var e=t.readUint32();this.single_view_allowed=3&e,this.stereo_scheme=t.readUint32();var r=t.readUint32();this.stereo_indication_type=t.readString(r);var i,n;for(this.boxes=[];t.getPosition()<this.start+this.size;)i=l.parseOneBox(t,!1),n=i.box,this.boxes.push(n),this[n.type]=n},l.stxtSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)},l.stypBox.prototype.parse=function(t){l.ftypBox.prototype.parse.call(this,t)},l.stz2Box.prototype.parse=function(t){var e,r;if(this.parseFullHeader(t),this.sample_sizes=[],0===this.version)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),r=t.readUint32(),4===this.field_size)for(e=0;e<r;e+=2){var n=t.readUint8();this.sample_sizes[e]=n>>4&15,this.sample_sizes[e+1]=15&n}else if(8===this.field_size)for(e=0;e<r;e++)this.sample_sizes[e]=t.readUint8();else if(16===this.field_size)for(e=0;e<r;e++)this.sample_sizes[e]=t.readUint16();else i.error("BoxParser","Error in length field in stz2 box");else this.data=t.readUint8Array(this.size-this.hdr_size)},l.subsBox.prototype.parse=function(t){var e,r,i,n;for(this.parseFullHeader(t),i=t.readUint32(),this.samples=[],e=0;e<i;e++){var a={};if(this.samples[e]=a,a.sample_delta=t.readUint32(),a.subsamples=[],(n=t.readUint16())>0)for(r=0;r<n;r++){var s={};a.subsamples.push(s),1==this.version?s.size=t.readUint32():s.size=t.readUint16(),s.priority=t.readUint8(),s.discardable=t.readUint8(),s.reserved=t.readUint32()}}},l.tfdtBox.prototype.parse=function(t){this.parseFullHeader(t),1==this.version?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()},l.tfhdBox.prototype.parse=function(t){var e=0;this.parseFullHeader(t),this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&l.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0},l.tfraBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=3&e,this.entries=[];for(var r=t.readUint32(),i=0;i<r;i++)1===this.version?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()},l.tkhdBox.prototype.parse=function(t){this.parseFullHeader(t),1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()},l.tmaxBox.prototype.parse=function(t){this.time=t.readUint32()},l.tminBox.prototype.parse=function(t){this.time=t.readUint32()},l.totlBox.prototype.parse=function(t){this.bytessent=t.readUint32()},l.tpayBox.prototype.parse=function(t){this.bytessent=t.readUint32()},l.tpylBox.prototype.parse=function(t){this.bytessent=t.readUint64()},l.trefBox.prototype.parse=function(t){for(var e,r;t.getPosition()<this.start+this.size;)e=l.parseOneBox(t,!0),r=new l.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start),r.write===l.Box.prototype.write&&"mdat"!==r.type&&(i.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.boxes.push(r)},l.trepBox.prototype.parse=function(t){for(this.parseFullHeader(t),this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)ret=l.parseOneBox(t,!1),box=ret.box,this.boxes.push(box)},l.trexBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()},l.trpyBox.prototype.parse=function(t){this.bytessent=t.readUint64()},l.trunBox.prototype.parse=function(t){var e=0;if(this.parseFullHeader(t),this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&l.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&l.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var r=0;r<this.sample_count;r++)this.flags&l.TRUN_FLAGS_DURATION&&(this.sample_duration[r]=t.readUint32()),this.flags&l.TRUN_FLAGS_SIZE&&(this.sample_size[r]=t.readUint32()),this.flags&l.TRUN_FLAGS_FLAGS&&(this.sample_flags[r]=t.readUint32()),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[r]=t.readUint32():this.sample_composition_time_offset[r]=t.readInt32())},l.tselBox.prototype.parse=function(t){this.parseFullHeader(t),this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var r=0;r<e;r++)this.attribute_list[r]=t.readUint32()},l.tx3gSampleEntry.prototype.parse=function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)},l.txtCBox.prototype.parse=function(t){this.parseFullHeader(t),this.config=t.readCString()},l["url Box"].prototype.parse=function(t){this.parseFullHeader(t),1!==this.flags?this.location=t.readCString():this.size-this.hdr_size&&(i.warn("BoxParser","Invalid urlBox - contains data but flag not set"),this.location=t.readString(this.size-this.hdr_size))},l["urn Box"].prototype.parse=function(t){this.parseFullHeader(t),this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())},l.vmhdBox.prototype.parse=function(t){this.parseFullHeader(t),this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)},l.vttCBox.prototype.parse=function(t){this.text=t.readString(this.size-this.hdr_size)},l.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>s&&(this.size+=8),"uuid"===this.type&&(this.size+=16),i.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>s?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),"uuid"===this.type&&t.writeUint8Array(this.uuid),this.size>s&&t.writeUint64(this.size)},l.FullBox.prototype.writeHeader=function(t){this.size+=4,l.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)},l.Box.prototype.write=function(t){"mdat"===this.type?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data))},l.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);i.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.TrackReferenceTypeBox.prototype.write=function(t){this.size=4*this.track_ids.length,this.writeHeader(t),t.writeUint32Array(this.track_ids)},l.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+252),t.writeUint8(this.SPS.length+224),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e]);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e]);this.ext&&t.writeUint8Array(this.ext)},l.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])},l.cslgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)},l.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),1===this.version?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])},l.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;i.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)},l.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var r=this.entries[e];t.writeUint32(r.segment_duration),t.writeInt32(r.media_time),t.writeInt16(r.media_rate_integer),t.writeInt16(r.media_rate_fraction)}},l.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)},l.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)},l.hdlrBox.prototype.write=function(t){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)};l.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)},l.mdhdBox.prototype.write=function(t){this.size=20,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)},l.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)},l.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)},l.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=96,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)},l.SampleEntry.prototype.writeHeader=function(t){this.size=8,l.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)},l.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;i.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,i.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=70,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeString(this.compressorname,null,32),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)},l.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=20,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)},l.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)},l.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var r=this.entries[e];t.writeInt32(r.sample_count),t.writeInt32(r.group_description_index)}},l.sgpdBox.prototype.write=function(t){var e,r;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)r=this.entries[e],1===this.version&&(0===this.default_length&&(this.size+=4),this.size+=r.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),1===this.version&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)r=this.entries[e],1===this.version&&0===this.default_length&&t.writeUint32(r.description_length),r.write(t)},l.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var r=this.references[e];t.writeUint32(r.reference_type<<31|r.referenced_size),t.writeUint32(r.subsegment_duration),t.writeUint32(r.starts_with_SAP<<31|r.SAP_type<<28|r.SAP_delta_time)}},l.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)},l.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])},l.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;i.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)},l.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])},l.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)},l.stszBox.prototype.write=function(t){var e,r=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;){if(this.sample_sizes[e+1]!==this.sample_sizes[0]){r=!1;break}e++}else r=!1;this.size=8,r||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),r?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),r||t.writeUint32Array(this.sample_sizes)},l.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])},l.tfdtBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,1===this.version&&(this.size+=4),this.writeHeader(t),1===this.version?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)},l.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)},l.tkhdBox.prototype.write=function(t){this.version=0,this.size=80,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)},l.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=20,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)},l.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&l.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&l.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&l.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&l.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&l.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&l.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))},l["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)},l["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)},l.vmhdBox.prototype.write=function(t){this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)},l.cttsBox.prototype.unpack=function(t){var e,r,i;for(i=0,e=0;e<this.sample_counts.length;e++)for(r=0;r<this.sample_counts[e];r++)t[i].pts=t[i].dts+this.sample_offsets[e],i++},l.sttsBox.prototype.unpack=function(t){var e,r,i;for(i=0,e=0;e<this.sample_counts.length;e++)for(r=0;r<this.sample_counts[e];r++)t[i].dts=0===i?0:t[i-1].dts+this.sample_deltas[e],i++},l.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]},l.stscBox.prototype.unpack=function(t){var e,r,i,n,a;for(n=0,a=0,e=0;e<this.first_chunk.length;e++)for(r=0;r<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);r++)for(a++,i=0;i<this.samples_per_chunk[e];i++){if(!t[n])return;t[n].description_index=this.sample_description_index[e],t[n].chunk_index=a,n++}},l.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]};var h=function(){};h.prototype.parseSample=function(t){var e,r,i=new n(t.buffer);for(e=[];!i.isEos();)r=l.parseOneBox(i,!1),r.code===l.OK&&"vttc"===r.box.type&&e.push(r.box);return e},h.prototype.getText=function(t,e,r){function i(t,e,r){return r=r||"0",t+="",t.length>=e?t:new Array(e-t.length+1).join(r)+t}function n(t){var e=Math.floor(t/3600),r=Math.floor((t-3600*e)/60),n=Math.floor(t-3600*e-60*r),a=Math.floor(1e3*(t-3600*e-60*r-n));return i(e,2)+":"+i(r,2)+":"+i(n,2)+"."+i(a,3)}for(var a=this.parseSample(r),s="",o=0;o<a.length;o++){var u=a[o];s+=n(t)+" --\x3e "+n(e)+"\r\n",s+=u.payl.text}return s},function(){}.prototype.parseSample=function(t){var e,r={};r.resources=[];var i=new n(t.data.buffer);if(t.subsamples&&0!==t.subsamples.length){if(r.documentString=i.readString(t.subsamples[0].size),t.subsamples.length>1)for(e=1;e<t.subsamples.length;e++)r.resources[e]=i.readUint8Array(t.subsamples[e].size)}else r.documentString=i.readString(t.data.length);return r.document=(new DOMParser).parseFromString(r.documentString,"application/xml"),r};var c=function(){};c.prototype.parseSample=function(t){return new n(t.data.buffer).readString(t.data.length)},c.prototype.parseConfig=function(t){var e=new n(t.buffer);return e.readUint32(),e.readCString()};var f=function(t){this.stream=t,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1};f.prototype.parse=function(){var t,e;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),t=l.parseOneBox(this.stream,!1),t.code===l.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(t))continue;return}return}switch(e=t.box,this.boxes.push(e),e.type){case"mdat":this.mdats.push(e);break;case"moof":this.moofs.push(e);break;case"moov":this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0);default:void 0!==this[e.type]&&i.warn("ISOFile","Duplicate Box of type: "+e.type+", overriding previous occurrence"),this[e.type]=e}this.updateUsedBytes&&this.updateUsedBytes(e,t)}},f.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null},f.prototype.getBoxes=function(t,e){var r=[];return f._sweep.call(this,t,r,e),r},f._sweep=function(t,e,r){this.type&&this.type==t&&e.push(this);for(var i in this.boxes){if(e.length&&r)return;f._sweep.call(this.boxes[i],t,e,r)}},e.ISOFile=f,f.prototype.lastBoxStartPosition=0,f.prototype.parsingMdat=null,f.prototype.nextParsePosition=0,f.prototype.discardMdatData=!1,f.prototype.processIncompleteBox=function(t){var e,r,i;return"mdat"===t.type?(e=new l[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,i=this.stream.seek(e.start+e.size,!1,this.discardMdatData),i?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):("moov"===t.type&&(this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0)),r=this.stream.mergeNextBuffer(),r?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},f.prototype.hasIncompleteMdat=function(){return null!==this.parsingMdat},f.prototype.processIncompleteMdat=function(){var t,e;return t=this.parsingMdat,e=this.stream.seek(t.start+t.size,!1,this.discardMdatData),e?(i.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},f.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},f.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},f.prototype.updateUsedBytes=function(t,e){"mdat"===t.type?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size)},f.prototype.lastMoofIndex=0,f.prototype.samplesDataSize=0,f.prototype.resetTables=function(){var t,e,r,i,n,a,s,o;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){e=this.moov.traks[t],e.tkhd.duration=0,e.mdia.mdhd.duration=0,r=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,r.chunk_offsets=[],i=e.mdia.minf.stbl.stsc,i.first_chunk=[],i.samples_per_chunk=[],i.sample_description_index=[],n=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,n.sample_sizes=[],a=e.mdia.minf.stbl.stts,a.sample_counts=[],a.sample_deltas=[],s=e.mdia.minf.stbl.ctts,s&&(s.sample_counts=[],s.sample_offsets=[]),o=e.mdia.minf.stbl.stss;var u=e.mdia.minf.stbl.boxes.indexOf(o);-1!=u&&(e.mdia.minf.stbl.boxes[u]=null)}},f.prototype.buildSampleLists=function(){var t,e,r,i,n,a,s,o,u,l,h,c,f,p,d,m,y,g,v,b,_,w,S;for(t=0;t<this.moov.traks.length;t++){for(r=this.moov.traks[t],r.samples=[],i=r.mdia.minf.stbl.stco||r.mdia.minf.stbl.co64,n=r.mdia.minf.stbl.stsc,a=r.mdia.minf.stbl.stsz||r.mdia.minf.stbl.stz2,s=r.mdia.minf.stbl.stts,o=r.mdia.minf.stbl.ctts,u=r.mdia.minf.stbl.stss,l=r.mdia.minf.stbl.stsd,h=r.mdia.minf.stbl.subs,y=-1,g=-1,v=-1,b=-1,_=0,w=0,S=0,e=0;e<a.sample_sizes.length;e++){var x={};x.number=e,x.track_id=r.tkhd.track_id,x.timescale=r.mdia.mdhd.timescale,x.alreadyRead=0,r.samples[e]=x,x.size=a.sample_sizes[e],0===e?(f=1,c=0,x.chunk_index=f,x.chunk_run_index=c,m=n.samples_per_chunk[c],d=0,p=c+1<n.first_chunk.length?n.first_chunk[c+1]-1:1/0):e<m?(x.chunk_index=f,x.chunk_run_index=c):(f++,x.chunk_index=f,d=0,f<=p||(c++,p=c+1<n.first_chunk.length?n.first_chunk[c+1]-1:1/0),x.chunk_run_index=c,m+=n.samples_per_chunk[c]),x.description_index=n.sample_description_index[x.chunk_run_index]-1,x.description=l.entries[x.description_index],x.offset=i.chunk_offsets[x.chunk_index-1]+d,d+=x.size,e>y&&(g++,y<0&&(y=0),y+=s.sample_counts[g]),e>0?(r.samples[e-1].duration=s.sample_deltas[g],x.dts=r.samples[e-1].dts+r.samples[e-1].duration):x.dts=0,o?(e>=v&&(b++,v<0&&(v=0),v+=o.sample_counts[b]),x.cts=r.samples[e].dts+o.sample_offsets[b]):x.cts=x.dts,u?e==u.sample_numbers[_]-1?(x.is_rap=!0,_++):x.is_rap=!1:x.is_rap=!0,h&&h.samples[w].sample_delta+S==e&&(x.subsamples=h.samples[w].subsamples,S+=h.samples[w].sample_delta)}e>0&&(r.samples[e-1].duration=Math.max(r.mdia.mdhd.duration-r.samples[e-1].dts,0))}},f.prototype.updateSampleLists=function(){var t,e,r,i,n,a,s,o,u,h,c,f,p,d,m;if(void 0!==this.moov)for(;this.lastMoofIndex<this.moofs.length;)if(u=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,"moof"==u.type)for(h=u,t=0;t<h.trafs.length;t++){for(c=h.trafs[t],f=this.getTrackById(c.tfhd.track_id),p=this.getTrexById(c.tfhd.track_id),i=c.tfhd.flags&l.TFHD_FLAG_SAMPLE_DESC?c.tfhd.default_sample_description_index:p?p.default_sample_description_index:1,n=c.tfhd.flags&l.TFHD_FLAG_SAMPLE_DUR?c.tfhd.default_sample_duration:p?p.default_sample_duration:0,a=c.tfhd.flags&l.TFHD_FLAG_SAMPLE_SIZE?c.tfhd.default_sample_size:p?p.default_sample_size:0,s=c.tfhd.flags&l.TFHD_FLAG_SAMPLE_FLAGS?c.tfhd.default_sample_flags:p?p.default_sample_flags:0,e=0;e<c.truns.length;e++){var y=c.truns[e];for(r=0;r<y.sample_count;r++){d={},d.number=f.samples.length,c.first_sample_index=f.samples.length,f.samples.push(d),d.track_id=f.tkhd.track_id,d.timescale=f.mdia.mdhd.timescale,d.description_index=i-1,d.description=f.mdia.minf.stbl.stsd.entries[d.description_index],d.size=a,y.flags&l.TRUN_FLAGS_SIZE&&(d.size=y.sample_size[r]),d.duration=n,y.flags&l.TRUN_FLAGS_DURATION&&(d.duration=y.sample_duration[r]),f.first_traf_merged||r>0?d.dts=f.samples[f.samples.length-2].dts+f.samples[f.samples.length-2].duration:(c.tfdt?d.dts=c.tfdt.baseMediaDecodeTime:d.dts=0,f.first_traf_merged=!0),d.cts=d.dts,y.flags&l.TRUN_FLAGS_CTS_OFFSET&&(d.cts=d.dts+y.sample_composition_time_offset[r]),m=s,y.flags&l.TRUN_FLAGS_FLAGS?m=y.sample_flags[r]:0===r&&y.flags&l.TRUN_FLAGS_FIRST_FLAG&&(m=y.first_sample_flags),d.is_rap=!(m>>16&1);var g=!!(c.tfhd.flags&l.TFHD_FLAG_BASE_DATA_OFFSET),v=!!(c.tfhd.flags&l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),b=!!(y.flags&l.TRUN_FLAGS_DATA_OFFSET),_=0;_=g?c.tfhd.base_data_offset:v?h.start:0===e?h.start:o,d.offset=0===e&&0===r?b?_+y.data_offset:_:o,o=d.offset+d.size}}if(c.subs){var w=c.first_sample_index;for(e=0;e<c.subs.samples.length;e++)w+=c.subs.samples[e].sample_delta,d=f.samples[w-1],d.subsamples=c.subs.samples[e].subsamples}}},f.prototype.getSample=function(t,e){var r,n=t.samples[e];if(!this.moov)return null;if(n.data){if(n.alreadyRead==n.size)return n}else n.data=new Uint8Array(n.size),n.alreadyRead=0,this.samplesDataSize+=n.size,i.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+n.size+" (total: "+this.samplesDataSize+")");var s=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(s>-1){r=this.stream.buffers[s];var o=r.byteLength-(n.offset+n.alreadyRead-r.fileStart);return n.size-n.alreadyRead<=o?(i.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-r.fileStart)+" read size: "+(n.size-n.alreadyRead)+" full size: "+n.size+")"),a.memcpy(n.data.buffer,n.alreadyRead,r,n.offset+n.alreadyRead-r.fileStart,n.size-n.alreadyRead),r.usedBytes+=n.size-n.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead=n.size,n):(i.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-r.fileStart)+" read size: "+o+" full size: "+n.size+")"),a.memcpy(n.data.buffer,n.alreadyRead,r,n.offset+n.alreadyRead-r.fileStart,o),n.alreadyRead+=o,r.usedBytes+=o,this.stream.logBufferLevel(),null)}return null},f.prototype.releaseSample=function(t,e){var r=t.samples[e];return r.data?(this.samplesDataSize-=r.size,r.data=null,r.alreadyRead=0,r.size):0},f.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},f.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){var r=this.moov.traks[t];t>0&&(e+=","),e+=r.mdia.minf.stbl.stsd.entries[0].getCodec()}return e},f.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var r=this.moov.mvex.trexs[e];if(r.track_id==t)return r}return null},f.prototype.getTrackById=function(t){if(void 0===this.moov)return null;for(var e=0;e<this.moov.traks.length;e++){var r=this.moov.traks[e];if(r.tkhd.track_id==t)return r}return null},f.prototype.items=[],f.prototype.itemsDataSize=0,f.prototype.flattenItemInfo=function(){var t,e,r,n=this.items,a=this.meta;if(null!==a&&void 0!==a&&void 0!==a.hdlr&&void 0!==a.iinf){for(t=0;t<a.iinf.item_infos.length;t++)r={},r.id=a.iinf.item_infos[t].item_ID,n[r.id]=r,r.ref_to=[],r.name=a.iinf.item_infos[t].item_name,a.iinf.item_infos[t].protection_index>0&&(r.protection=a.ipro.protections[a.iinf.item_infos[t].protection_index-1]),a.iinf.item_infos[t].item_type?r.type=a.iinf.item_infos[t].item_type:r.type="mime",r.content_type=a.iinf.item_infos[t].content_type,r.content_encoding=a.iinf.item_infos[t].content_encoding;if(a.iloc)for(t=0;t<a.iloc.items.length;t++){var s=a.iloc.items[t];if(r=n[s.item_ID],0!==s.data_reference_index&&(i.warn("Item storage with reference to other files: not supported"),r.source=a.dinf.boxes[s.data_reference_index-1]),void 0!==s.construction_method)i.warn("Item storage with construction_method : not supported"),s.construction_method;else for(r.extents=[],r.size=0,e=0;e<s.extents.length;e++)r.extents[e]={},r.extents[e].offset=s.extents[e].extent_offset+s.base_offset,r.extents[e].length=s.extents[e].extent_length,r.extents[e].alreadyRead=0,r.size+=r.extents[e].length}if(a.pitm&&(n[a.pitm.item_id].primary=!0),a.iref)for(t=0;t<a.iref.references.length;t++){var o=a.iref.references[t];for(e=0;e<o.references.length;e++)n[o.from_item_ID].ref_to.push({type:o.type,id:o.references[e]})}}},f.prototype.getItem=function(t){var e,r;if(!this.meta)return null;if(r=this.items[t],!r.data&&r.size)r.data=new Uint8Array(r.size),r.alreadyRead=0,this.itemsDataSize+=r.size,i.debug("ISOFile","Allocating item #"+t+" of size "+r.size+" (total: "+this.itemsDataSize+")");else if(r.alreadyRead===r.size)return r;for(var n=0;n<r.extents.length;n++){var s=r.extents[n];if(s.alreadyRead!==s.length){var o=this.stream.findPosition(!0,s.offset+s.alreadyRead,!1);if(!(o>-1))return null;e=this.stream.buffers[o];var u=e.byteLength-(s.offset+s.alreadyRead-e.fileStart);if(!(s.length-s.alreadyRead<=u))return i.debug("ISOFile","Getting item #"+t+" extent #"+n+" partial data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-e.fileStart)+" read size: "+u+" full extent size: "+s.length+" full item size: "+r.size+")"),a.memcpy(r.data.buffer,r.alreadyRead,e,s.offset+s.alreadyRead-e.fileStart,u),s.alreadyRead+=u,r.alreadyRead+=u,e.usedBytes+=u,this.stream.logBufferLevel(),null;i.debug("ISOFile","Getting item #"+t+" extent #"+n+" data (alreadyRead: "+s.alreadyRead+" offset: "+(s.offset+s.alreadyRead-e.fileStart)+" read size: "+(s.length-s.alreadyRead)+" full extent size: "+s.length+" full item size: "+r.size+")"),a.memcpy(r.data.buffer,r.alreadyRead,e,s.offset+s.alreadyRead-e.fileStart,s.length-s.alreadyRead),e.usedBytes+=s.length-s.alreadyRead,this.stream.logBufferLevel(),s.alreadyRead=s.length,r.alreadyRead+=s.length}}return r.alreadyRead===r.size?r:null},f.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var r=0;r<e.extents.length;r++){e.extents[r].alreadyRead=0}return e.size}return 0},f.prototype.processItems=function(t){for(var e in this.items){var r=this.items[e];this.getItem(r.id),t&&!r.sent&&(t(r),r.sent=!0,r.data=null)}},f.prototype.hasItem=function(t){for(var e in this.items){var r=this.items[e];if(r.name===t)return r.id}return-1},f.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},f.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},f.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)},f.writeInitializationSegment=function(t,e,r){var n,s;i.debug("ISOFile","Generating initialization segment");var o=new a;for(o.endianness=a.BIG_ENDIAN,t.mvex=new l.mvexBox,t.boxes.push(t.mvex),e&&(t.mvex.mehd=new l.mehdBox,t.mvex.boxes.push(t.mvex.mehd),t.mvex.mehd.fragment_duration=e),n=0;n<t.traks.length;n++)s=new l.trexBox,t.mvex.boxes.push(s),t.mvex.trexs.push(s),s.track_id=t.traks[n].tkhd.track_id,s.default_sample_description_index=1,s.default_sample_duration=r,s.default_sample_size=0,s.default_sample_flags=65536;return t.write(o),o.buffer};var p=function(t){this.inputStream=new o,this.keepMdatData=void 0===t||t,this.inputIsoFile=new f(this.inputStream),this.inputIsoFile.discardMdatData=!this.keepMdatData,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1};p.prototype.setSegmentOptions=function(t,e,r){var i=this.inputIsoFile.getTrackById(t);if(i){var n={};this.fragmentedTracks.push(n),n.id=t,n.user=e,n.trak=i,i.nextSample=0,n.segmentStream=null,n.nb_samples=1e3,n.rapAlignement=!0,r&&(r.nbSamples&&(n.nb_samples=r.nbSamples),r.rapAlignement&&(n.rapAlignement=r.rapAlignement))}},p.prototype.unsetSegmentOptions=function(t){for(var e=-1,r=0;r<this.fragmentedTracks.length;r++){this.fragmentedTracks[r].id==t&&(e=r)}e>-1&&this.fragmentedTracks.splice(e,1)},p.prototype.setExtractionOptions=function(t,e,r){var i=this.inputIsoFile.getTrackById(t);if(i){var n={};this.extractedTracks.push(n),n.id=t,n.user=e,n.trak=i,i.nextSample=0,n.nb_samples=1e3,n.samples=[],r&&r.nbSamples&&(n.nb_samples=r.nbSamples)}},p.prototype.unsetExtractionOptions=function(t){for(var e=-1,r=0;r<this.extractedTracks.length;r++){this.extractedTracks[r].id==t&&(e=r)}e>-1&&this.extractedTracks.splice(e,1)},p.prototype.createSingleSampleMoof=function(t){var e=new l.moofBox,r=new l.mfhdBox;r.sequence_number=this.nextMoofNumber,this.nextMoofNumber++,e.boxes.push(r);var i=new l.trafBox;e.boxes.push(i);var n=new l.tfhdBox;i.boxes.push(n),n.track_id=t.track_id,n.flags=l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF;var a=new l.tfdtBox;i.boxes.push(a),a.baseMediaDecodeTime=t.dts;var s=new l.trunBox;return i.boxes.push(s),e.trun=s,s.flags=l.TRUN_FLAGS_DATA_OFFSET|l.TRUN_FLAGS_DURATION|l.TRUN_FLAGS_SIZE|l.TRUN_FLAGS_FLAGS|l.TRUN_FLAGS_CTS_OFFSET,s.data_offset=0,s.first_sample_flags=0,s.sample_count=1,s.sample_duration=[],s.sample_duration[0]=t.duration,s.sample_size=[],s.sample_size[0]=t.size,s.sample_flags=[],s.sample_flags[0]=0,s.sample_composition_time_offset=[],s.sample_composition_time_offset[0]=t.cts-t.dts,e},p.prototype.createFragment=function(t,e,r,n){var s=this.inputIsoFile.getTrackById(e),o=this.inputIsoFile.getSample(s,r);if(null==o)return o=s.samples[r],this.nextSeekPosition?this.nextSeekPosition=Math.min(o.offset+o.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=s.samples[r].offset+o.alreadyRead,null;var u=n||new a;u.endianness=a.BIG_ENDIAN;var h=this.createSingleSampleMoof(o);h.write(u),h.trun.data_offset=h.size+8,i.debug("MP4Box","Adjusting data_offset with new value "+h.trun.data_offset),u.adjustUint32(h.trun.data_offset_position,h.trun.data_offset);var c=new l.mdatBox;return c.data=o.data,c.write(u),u},p.prototype.processSamples=function(){var t,e;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&null!==this.onSegment)for(t=0;t<this.fragmentedTracks.length;t++){var r=this.fragmentedTracks[t];for(e=r.trak;e.nextSample<e.samples.length&&this.sampleProcessingStarted;){i.debug("MP4Box","Creating media fragment on track #"+r.id+" for sample "+e.nextSample);var n=this.createFragment(this.inputIsoFile,r.id,e.nextSample,r.segmentStream);if(!n)break;if(r.segmentStream=n,(++e.nextSample%r.nb_samples==0||e.nextSample>=e.samples.length)&&(i.info("MP4Box","Sending fragmented data on track #"+r.id+" for samples ["+Math.max(0,e.nextSample-r.nb_samples)+","+(e.nextSample-1)+"]"),i.info("MP4Box","Sample data size in memory: "+this.inputIsoFile.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(r.id,r.user,r.segmentStream.buffer,e.nextSample),r.segmentStream=null,r!==this.fragmentedTracks[t]))break}}if(null!==this.onSamples)for(t=0;t<this.extractedTracks.length;t++){var a=this.extractedTracks[t];for(e=a.trak;e.nextSample<e.samples.length&&this.sampleProcessingStarted;){i.debug("MP4Box","Exporting on track #"+a.id+" sample #"+e.nextSample);var s=this.inputIsoFile.getSample(e,e.nextSample);if(!s)break;if(e.nextSample++,a.samples.push(s),(e.nextSample%a.nb_samples==0||e.nextSample>=e.samples.length)&&(i.debug("MP4Box","Sending samples on track #"+a.id+" for sample "+e.nextSample),this.onSamples&&this.onSamples(a.id,a.user,a.samples),a.samples=[],a!==this.extractedTracks[t]))break}}}},p.prototype.checkBuffer=function(t){if(null===t||void 0===t)throw"Buffer must be defined and non empty";if(void 0===t.fileStart)throw"Buffer must have a fileStart property";return 0===t.byteLength?(i.warn("MP4Box","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.inputStream.logBufferLevel(),!1):(i.info("MP4Box","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.inputStream.insertBuffer(t),this.inputStream.logBufferLevel(),!!this.inputStream.initialized()||(i.warn("MP4Box","Not ready to start parsing"),!1))},p.prototype.appendBuffer=function(t){var e;if(!this.checkBuffer||this.checkBuffer(t))return this.inputIsoFile.parse(),this.inputIsoFile.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.inputIsoFile.moov?(this.processSamples&&(this.sampleListBuilt||(this.inputIsoFile.buildSampleLists(),this.sampleListBuilt=!0),this.inputIsoFile.updateSampleLists()),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples&&this.processSamples(),this.nextSeekPosition?(e=this.nextSeekPosition,this.nextSeekPosition=void 0):e=this.inputIsoFile.nextParsePosition,this.inputStream.getEndFilePositionAfter&&(e=this.inputStream.getEndFilePositionAfter(e))):e=null!==this.inputIsoFile?this.inputIsoFile.nextParsePosition:0,this.inputIsoFile.meta&&(this.inputIsoFile.flattenItemInfo&&!this.itemListBuilt&&(this.inputIsoFile.flattenItemInfo(),this.itemListBuilt=!0),this.inputIsoFile.processItems&&this.inputIsoFile.processItems(this.onItem)),this.inputStream.cleanBuffers&&(i.info("MP4Box","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+e),this.inputStream.logBufferLevel(),this.inputStream.cleanBuffers(),this.inputStream.logBufferLevel(!0),i.info("MP4Box","Sample data size in memory: "+this.inputIsoFile.getAllocatedSampleDataSize())),e},p.prototype.getInfo=function(){var t,e,r,i,n,a={},s=new Date(4,0,1,0,0,0,0).getTime();if(this.inputIsoFile.moov)for(a.hasMoov=!0,a.duration=this.inputIsoFile.moov.mvhd.duration,a.timescale=this.inputIsoFile.moov.mvhd.timescale,a.isFragmented=null!=this.inputIsoFile.moov.mvex,a.isFragmented&&this.inputIsoFile.moov.mvex.mehd?a.fragment_duration=this.inputIsoFile.moov.mvex.mehd.fragment_duration:a.fragment_duration=0,a.isProgressive=this.inputIsoFile.isProgressive,a.hasIOD=null!=this.inputIsoFile.moov.iods,a.brands=[],a.brands.push(this.inputIsoFile.ftyp.major_brand),a.brands=a.brands.concat(this.inputIsoFile.ftyp.compatible_brands),a.created=new Date(s+1e3*this.inputIsoFile.moov.mvhd.creation_time),a.modified=new Date(s+1e3*this.inputIsoFile.moov.mvhd.modification_time),a.tracks=[],a.audioTracks=[],a.videoTracks=[],a.subtitleTracks=[],a.metadataTracks=[],a.hintTracks=[],a.otherTracks=[],t=0;t<this.inputIsoFile.moov.traks.length;t++){if(r=this.inputIsoFile.moov.traks[t],n=r.mdia.minf.stbl.stsd.entries[0],i={},a.tracks.push(i),i.id=r.tkhd.track_id,i.references=[],r.tref)for(e=0;e<r.tref.boxes.length;e++)ref={},i.references.push(ref),ref.type=r.tref.boxes[e].type,ref.track_ids=r.tref.boxes[e].track_ids;for(i.created=new Date(s+1e3*r.tkhd.creation_time),i.modified=new Date(s+1e3*r.tkhd.modification_time),i.movie_duration=r.tkhd.duration,i.layer=r.tkhd.layer,i.alternate_group=r.tkhd.alternate_group,i.volume=r.tkhd.volume,i.matrix=r.tkhd.matrix,i.track_width=r.tkhd.width/65536,i.track_height=r.tkhd.height/65536,i.timescale=r.mdia.mdhd.timescale,i.duration=r.mdia.mdhd.duration,i.codec=n.getCodec(),i.kind=r.udta&&r.udta.kinds.length?r.udta.kinds[0]:{schemeURI:"",value:""},i.language=r.mdia.elng?r.mdia.elng.extended_language:r.mdia.mdhd.languageString,i.nb_samples=r.samples.length,i.size=0,e=0;e<i.nb_samples;e++)i.size+=r.samples[e].size;i.bitrate=8*i.size*i.timescale/i.duration,n.isAudio()?(a.audioTracks.push(i),i.audio={},i.audio.sample_rate=n.getSampleRate(),i.audio.channel_count=n.getChannelCount(),i.audio.sample_size=n.getSampleSize()):n.isVideo()?(a.videoTracks.push(i),i.video={},i.video.width=n.getWidth(),i.video.height=n.getHeight()):n.isSubtitle()?a.subtitleTracks.push(i):n.isHint()?a.hintTracks.push(i):n.isMetadata()?a.metadataTracks.push(i):a.otherTracks.push(i)}else a.hasMoov=!1;return a},p.prototype.writeFile=function(){var t=new a;return t.endianness=a.BIG_ENDIAN,this.inputIsoFile.write(t),t.buffer},p.prototype.initializeSegmentation=function(){var t,e,r,n;for(null===this.onSegment&&i.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.inputIsoFile.resetTables()),e=[],t=0;t<this.fragmentedTracks.length;t++){var a=new l.moovBox;a.mvhd=this.inputIsoFile.moov.mvhd,a.boxes.push(a.mvhd),r=this.inputIsoFile.getTrackById(this.fragmentedTracks[t].id),a.boxes.push(r),a.traks.push(r),n={},n.id=r.tkhd.track_id,n.user=this.fragmentedTracks[t].user,n.buffer=f.writeInitializationSegment(a,this.inputIsoFile.moov.mvex&&this.inputIsoFile.moov.mvex.mehd?this.inputIsoFile.moov.mvex.mehd.fragment_duration:void 0,this.inputIsoFile.moov.traks[t].samples.length>0?this.inputIsoFile.moov.traks[t].samples[0].duration:0),e.push(n)}return e},p.prototype.releaseUsedSamples=function(t,e){var r=0,n=this.inputIsoFile.getTrackById(t);n.lastValidSample||(n.lastValidSample=0);for(var a=n.lastValidSample;a<e;a++)r+=this.inputIsoFile.releaseSample(n,a);i.info("MP4Box","Track #"+t+" released samples up to "+e+" (released size: "+r+", remaining: "+this.inputIsoFile.samplesDataSize+")"),n.lastValidSample=e},p.prototype.flush=function(){i.info("MP4Box","Flushing remaining samples"),this.inputIsoFile.updateSampleLists(),this.processSamples(),this.inputStream.cleanBuffers(),this.inputStream.logBufferLevel(!0)},p.prototype.seekTrack=function(t,e,r){var n,a,s,o=1/0,u=0,l=0;if(0===r.samples.length)return i.info("MP4Box","No sample in track, cannot seek! Using time "+i.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(n=0;n<r.samples.length;n++){if(a=r.samples[n],0===n)l=0,s=a.timescale;else if(a.cts>t*a.timescale){l=n-1;break}e&&a.is_rap&&(u=n)}for(e&&(l=u),t=r.samples[l].cts,r.nextSample=l;r.samples[l].alreadyRead===r.samples[l].size;)l++;return o=r.samples[l].offset+r.samples[l].alreadyRead,i.info("MP4Box","Seeking to "+(e?"RAP":"")+" sample #"+r.nextSample+" on track "+r.tkhd.track_id+", time "+i.getDurationString(t,s)+" and offset: "+o),{offset:o,time:t/s}},p.prototype.seek=function(t,e){var r,n,a,s=this.inputIsoFile.moov,o={offset:1/0,time:1/0};if(this.inputIsoFile.moov){for(a=0;a<s.traks.length;a++)r=s.traks[a],n=this.seekTrack(t,e,r),n.offset<o.offset&&(o.offset=n.offset),n.time<o.time&&(o.time=n.time);return i.info("MP4Box","Seeking at time "+i.getDurationString(o.time,1)+" needs a buffer with a fileStart position of "+o.offset),o.offset===1/0?o={offset:this.inputIsoFile.nextParsePosition,time:0}:o.offset=this.inputStream.getEndFilePositionAfter(o.offset),i.info("MP4Box","Adjusted seek position (after checking data already in buffer): "+o.offset),o}throw"Cannot seek: moov not received!"},p.prototype.getTrackSamplesInfo=function(t){var e=this.inputIsoFile.getTrackById(t);return e?e.samples:void 0},p.prototype.getTrackSample=function(t,e){var r=this.inputIsoFile.getTrackById(t);return this.inputIsoFile.getSample(r,e)},p.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples()},p.prototype.stop=function(){this.sampleProcessingStarted=!1},e.MP4Box=p},function(t,e,r){(function(t,i){var n;!function(a){function s(t){throw new RangeError(E[t])}function o(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function u(t,e){var r=t.split("@"),i="";return r.length>1&&(i=r[0]+"@",t=r[1]),t=t.replace(T,"."),i+o(t.split("."),e).join(".")}function l(t){for(var e,r,i=[],n=0,a=t.length;n<a;)e=t.charCodeAt(n++),e>=55296&&e<=56319&&n<a?(r=t.charCodeAt(n++),56320==(64512&r)?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--)):i.push(e);return i}function h(t){return o(t,function(t){var e="";return t>65535&&(t-=65536,e+=L(t>>>10&1023|55296),t=56320|1023&t),e+=L(t)}).join("")}function c(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:w}function f(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function p(t,e,r){var i=0;for(t=r?F(t/U):t>>1,t+=F(t/e);t>B*x>>1;i+=w)t=F(t/B);return F(i+(B+1)*t/(t+k))}function d(t){var e,r,i,n,a,o,u,l,f,d,m=[],y=t.length,g=0,v=O,b=I;for(r=t.lastIndexOf(A),r<0&&(r=0),i=0;i<r;++i)t.charCodeAt(i)>=128&&s("not-basic"),m.push(t.charCodeAt(i));for(n=r>0?r+1:0;n<y;){for(a=g,o=1,u=w;n>=y&&s("invalid-input"),l=c(t.charCodeAt(n++)),(l>=w||l>F((_-g)/o))&&s("overflow"),g+=l*o,f=u<=b?S:u>=b+x?x:u-b,!(l<f);u+=w)d=w-f,o>F(_/d)&&s("overflow"),o*=d;e=m.length+1,b=p(g-a,e,0==a),F(g/e)>_-v&&s("overflow"),v+=F(g/e),g%=e,m.splice(g++,0,v)}return h(m)}function m(t){var e,r,i,n,a,o,u,h,c,d,m,y,g,v,b,k=[];for(t=l(t),y=t.length,e=O,r=0,a=I,o=0;o<y;++o)(m=t[o])<128&&k.push(L(m));for(i=n=k.length,n&&k.push(A);i<y;){for(u=_,o=0;o<y;++o)(m=t[o])>=e&&m<u&&(u=m);for(g=i+1,u-e>F((_-r)/g)&&s("overflow"),r+=(u-e)*g,e=u,o=0;o<y;++o)if(m=t[o],m<e&&++r>_&&s("overflow"),m==e){for(h=r,c=w;d=c<=a?S:c>=a+x?x:c-a,!(h<d);c+=w)b=h-d,v=w-d,k.push(L(f(d+b%v,0))),h=F(b/v);k.push(L(f(h,0))),a=p(r,g,i==n),r=0,++i}++r,++e}return k.join("")}function y(t){return u(t,function(t){return C.test(t)?d(t.slice(4).toLowerCase()):t})}function g(t){return u(t,function(t){return P.test(t)?"xn--"+m(t):t})}var v=("object"==typeof e&&e&&e.nodeType,"object"==typeof t&&t&&t.nodeType,"object"==typeof i&&i);var b,_=2147483647,w=36,S=1,x=26,k=38,U=700,I=72,O=128,A="-",C=/^xn--/,P=/[^\x20-\x7E]/,T=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},B=w-S,F=Math.floor,L=String.fromCharCode;b={version:"1.4.1",ucs2:{decode:l,encode:h},decode:d,encode:m,toASCII:g,toUnicode:y},void 0!==(n=function(){return b}.call(e,r,e,t))&&(t.exports=n)}()}).call(e,r(23)(t),r(12))},function(t,e,r){"use strict";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,r,n){e=e||"&",r=r||"=";var a={};if("string"!=typeof t||0===t.length)return a;var s=/\+/g;t=t.split(e);var o=1e3;n&&"number"==typeof n.maxKeys&&(o=n.maxKeys);var u=t.length;o>0&&u>o&&(u=o);for(var l=0;l<u;++l){var h,c,f,p,d=t[l].replace(s,"%20"),m=d.indexOf(r);m>=0?(h=d.substr(0,m),c=d.substr(m+1)):(h=d,c=""),f=decodeURIComponent(h),p=decodeURIComponent(c),i(a,f)?Array.isArray(a[f])?a[f].push(p):a[f]=[a[f],p]:a[f]=p}return a}},function(t,e,r){"use strict";var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,r,n){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(n){var a=encodeURIComponent(i(n))+r;return Array.isArray(t[n])?t[n].map(function(t){return a+encodeURIComponent(i(t))}).join(e):a+encodeURIComponent(i(t[n]))}).join(e):n?encodeURIComponent(i(n))+r+encodeURIComponent(i(t)):""}},function(t,e,r){"use strict";function i(t){return decodeURIComponent(t.replace(/\+/g," "))}function n(t){for(var e,r=/([^=?&]+)=?([^&]*)/g,n={};e=r.exec(t);n[i(e[1])]=i(e[2]));return n}function a(t,e){e=e||"";var r=[];"string"!=typeof e&&(e="?");for(var i in t)s.call(t,i)&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return r.length?e+r.join("&"):""}var s=Object.prototype.hasOwnProperty;e.stringify=a,e.parse=n},function(t,e,r){"use strict";t.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e){t.exports=axios}]);