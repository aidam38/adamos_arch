"use strict";
/*!
 * G-calize : background.js
 * Thank you using the Extension
 * Copyright (C) Yo Wauke. All Rights Reserved.
 * https://plus.google.com/104819699346433230202/
 * --------------------------------------------------
 * [じーからいず]って読むの。ゆたしくうにげーさびら。
 */var trace=window.trace||(window.console&&console.log&&console.log.bind?console.log.bind(console):function(){});!function(e,r,o){var a=null,t=null,i=null,n=-1,l=!1,d="",c="",s="";e.onload=function(){trace(">>G-calize -> init!"),d=O("secid"),c=Z(),chrome.runtime.onMessage.addListener(function(e,r,o){var a={msg:"OK"};if("GCALIZE_getHolidayList"==e.method)(a=j(t="https://calendar.google.com/calendar/directory?did=holiday&hl="+c)).msg="GCALIZE_getHolidayList -> DONE!",o(a);else if("GCALIZE_getCalID"==e.method){var t="https://calendar.google.com/calendar/caldetails?init=true&secid="+d+"&dtid="+e.dtid;(a=j(t)).msg="GCALIZE_getCalID -> DONE!",o(a)}else"GCALIZE_updateCSS"==e.method?(a.msg="GCALIZE_getHolidayList -> DONE!",o(a),y("updateCSS! -> gcalize.js")):o(a)}),chrome.runtime.sendMessage({method:"GCALIZE_getStorage"},function(e){a=e.config,t=e.holidays,i=t.flg_hld&&T(t.hld_data)&&JSON.parse(t.hld_data)||null,u(),N(function(){k(),x(),b(),w()})}),r.addEventListener("DOMNodeInserted",function(e){e.target.dataset&&e.target.dataset.activeView&&setTimeout(function(){u()},1),e.target.querySelector&&e.target.querySelector("#drawerMiniMonthNavigator")&&(n=-1,N(function(){k()})),h.push(e.target),p()},!1)};var u=function(){"day"!==(s=_())&&"week"!==s&&"custom_days"!==s||m(),"agenda"===s&&v()},h=[],g=null,p=function(){clearTimeout(g),g=setTimeout(function(){h.forEach(function(e){e.dataset&&e.dataset.datekey&&"rowgroup"===e.getAttribute("role")&&f(e)}),h=[]},5)},_=function(){return r.querySelectorAll("[data-active-view]")[0].dataset.activeView},m=function(){var e=r.querySelectorAll("[data-start-date-key][data-end-date-key][data-chip-offset-top]")[0];if(e){var o=L(e.dataset.startDateKey),a=H(o);S(a)}},v=function(){for(var e=r.querySelectorAll("[role='main']>[jsname]>[role='grid']>[role='rowgroup'][data-datekey]"),o=0;o<e.length;o++)f(e[o])},f=function(e){var r=L(e.dataset.datekey),o=H(r),a=o&&o.getDay();e.classList.add("gcalize_agenda_wid_"+a),e.classList.add("gcalize_agenda_ymd_"+r)},y=function(e){chrome.runtime.sendMessage({method:"GCALIZE_getStorage"},function(e){a=e.config,t=e.holidays,i=t.flg_hld&&T(t.hld_data)&&JSON.parse(t.hld_data)||null,k(),x(),w(),m()})},w=function(){if(a.flg_tdyU){var e="",r=new Date,o=r.getDate(),t=A(r),i=E(t),n=a.c_tx_tdy,l=a.c_bg_tdy;e+="#drawerMiniMonthNavigator span[data-date='"+t+"']>[aria-hidden]",e+="{color:"+n+" !important;background-color:"+l+" !important;border: 1px solid "+n+";}",e+="[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden='true']>div[data-datekey='"+i+"'] h2",e+="{color:"+n+" !important;background-color: transparent !important;border: 1px solid "+n+";}",e+="[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden='true']>div[data-datekey='"+i+"']",e+="{background-color:"+l+" !important;}",e+="[role='main']>div>div>div[data-month]>[role='grid']>[role='rowgroup']>[role='row']>[data-date='"+t+"']:not([aria-label$='"+o+"'])>[aria-hidden='true']",M(e+="{color:"+n+" !important;background-color:"+l+" !important;border: 1px solid "+n+";}","Gcalize_CSS_today")}else M("","Gcalize_CSS_today")},b=function(){var e="";e+="[role='main']>[jsname]>[role='grid']>[role='rowgroup'][data-datekey]>[role='row']>[role='gridcell'][role='gridcell']{position:relative;}",e+="[role='main']>[jsname]>[role='grid']>[role='rowgroup'][data-datekey]>[role='row']>[role='gridcell']:before{content:'';display:block;position:absolute;width:100%;left: 0;top:-8px;bottom:-8px;z-index:-1;background-color:transparent;}";for(var r=0;r<7;r++){var o=r;e+=".gcalize_agenda_wid_"+o+" > [role='row'] > [role='gridcell']{color:"+a["c_tx_"+o]+";}",e+=".gcalize_agenda_wid_"+o+" > [role='row'] > [role='gridcell']:before{background-color:"+a["c_bg_"+o]+" !important;}"}M(e,"Gcalize_CSS_agenda")},S=function(e){var r="day"===s,o=e.getDay(),n="";n+="[role='main']>[role='grid']>[role='presentation'][data-start-date-key]>[role='presentation']>[role='row']>[role='presentation']>[role='columnheader']>h2>div{color:inherit;}";for(var l=0;l<7;l++){var d=r?o:(l+o)%7,c=A(q(e,r?0:l)),u=a["c_tx_"+d],h=a["c_bg_"+d];n+="[role='main']>[role='grid']>[role='presentation'][data-start-date-key]>[role='presentation']>[role='row']>[role='presentation']>[role='columnheader']:nth-child("+(l+1)+"),",n+="[role='main']>[role='grid']>[role='presentation'][data-start-date-key]>[role='presentation']>[role='row']>div>ul>li:nth-child("+(l+1)+"),",n+="[role='main']>[role='grid']>[role='presentation'][data-start-date-key]>[role='presentation']>[role='presentation']>[role='row']>[role='gridcell']:nth-child("+(l+2)+"),",n+="[role='main']>[role='grid']>[role='presentation'][data-date-key]>[role='presentation']>[role='presentation']>[role='row']>[role='gridcell']:nth-child("+(l+2)+")",i&&null!=i[c]?n+="{color:"+t.c_tx_h+";background-color:"+t.c_bg_h+";}":n+="{color:"+u+";background-color:"+h+";}"}M(n,"Gcalize_CSS_date")},k=function(){for(var e="",r=0;r<7;r++){var o=(r+n)%7;e+="#drawerMiniMonthNavigator [role='grid']>div[role='rowgroup']>div>span:nth-child("+(t=r+1+(l?1:0))+")>[aria-hidden]{color:"+(i=a["c_tx_"+o])+";}"}M(e,"Gcalize_CSS_Month_mini");e="";e+="[role='main']>[role='grid']>[role='row']{border-bottom: #e0e0e0 1px solid;}",e+="[role='main']>[role='grid']>[role='row']>[role='columnheader']:before{height: 80%;}";for(r=0;r<7;r++){e+="[role='main']>[role='grid']>[role='row']>[role='columnheader']:nth-child(7n+"+(r+1)+"):nth-last-child("+(7-r)+")>span{color:"+(i=a["c_tx_"+(o=(r+n)%7)])+";}",e+="[role='main']>[role='grid']>[role='row']>[role='columnheader']:nth-child(7n+"+(r+1)+"):nth-last-child("+(7-r)+"){background-color:"+(d=a["c_bg_"+o])+";}",e+="[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden][jsname]>div:nth-child(7n+"+(r+1)+"):nth-last-child("+(7-r)+")>h2{color:"+i+";}",e+="[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden][jsname]>div:nth-child(7n+"+(r+1)+"):nth-last-child("+(7-r)+"){background-color:"+d+";}"}for(r=1;r<6;r++){e+="[role='main']>[role='grid']>[role='row']>[role='columnheader']:nth-child(5n+"+r+"):nth-last-child("+(6-r)+")>span{color:"+(i=a["c_tx_"+(o=r)])+";}",e+="[role='main']>[role='grid']>[role='row']>[role='columnheader']:nth-child(5n+"+r+"):nth-last-child("+(6-r)+"){background-color:"+(d=a["c_bg_"+o])+";}",e+="[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden][jsname]>div:nth-child(5n+"+r+"):nth-last-child("+(6-r)+")>h2{color:"+i+";}",e+="[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden][jsname]>div:nth-child(5n+"+r+"):nth-last-child("+(6-r)+"){background-color:"+d+";}"}M(e,"Gcalize_CSS_Month_big");for(e="",r=0;r<7;r++){o=(r+n)%7;var t=r+1+(l?1:0),i=a["c_tx_"+o],d=a["c_bg_"+o];e+="[role='main']>div>div>div[data-month]>[role='grid']>[role='row']>[role='columnheader']:nth-child("+t+")>span{color:"+i+";}",e+="[role='main']>div>div>div[data-month]>[role='grid']>[role='rowgroup']>[role='row']>[data-date]:nth-child("+t+")>[aria-hidden='true']{color:"+i+";z-index:1;}"}M(e,"Gcalize_CSS_Month_year")},x=function(){if(!i)return l+="#Gcalize_dummy{}",M("","Gcalize_CSS_Holidays_mini"),M("","Gcalize_CSS_Holidays_big"),M("","Gcalize_CSS_Holidays_day"),void M("","Gcalize_CSS_Holidays_agenda");var e=t.c_tx_h,r=t.c_bg_h,o=[],a=[];for(var n in o=[],a=[],i)o.push("#drawerMiniMonthNavigator span[data-date='"+n+"']>[aria-hidden]");for(var n in C("Gcalize_CSS_Holidays_mini",o,"{color:"+e+" !important;}"),o=[],a=[],i)o.push("[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden='true']>div[data-datekey='"+E(n)+"'] h2"),a.push("[role='main']>[role='grid']>[role='presentation']>[role='row']>[aria-hidden='true']>div[data-datekey='"+E(n)+"']");C("Gcalize_CSS_Holidays_big_text",o,"{color:"+e+" !important;}"),C("Gcalize_CSS_Holidays_big_bg",a,"{background-color:"+r+" !important;}"),o=[];var l="";for(var n in i)o.push("[role='main']>div>div>div[data-month]>[role='grid']>[role='rowgroup']>[role='row']>[data-date='"+n+"']>[aria-hidden='true']"),l+="[role='main']>div>div>div[data-month]>[role='grid']>[role='rowgroup']>[role='row']>[data-date='"+n+"']>[aria-hidden='true']:before{content:\""+i[n]+'";border: 1px solid '+e+"; display: inline-block; position: absolute; top: -5px; left: 50%; visibility: hidden;  white-space: nowrap; background-color: #fff; line-height: 1; padding: 2px; font-size: 12px; transform: translate(-50%, -50%); pointer-events: none; border-radius: 2px;}",l+="[role='main']>div>div>div[data-month]>[role='grid']>[role='rowgroup']>[role='row']>[data-date='"+n+"']>[aria-hidden='true']:hover{z-index:2 !important;}",l+="[role='main']>div>div>div[data-month]>[role='grid']>[role='rowgroup']>[role='row']>[data-date='"+n+"']>[aria-hidden='true']:hover:before{visibility:visible;z-index:1;}";C("Gcalize_CSS_Holidays_year_text",o,"{color:"+e+" !important;background-color:"+r+" !important;}"),M(l,"Gcalize_CSS_Holidays_year_hint")},C=function(e,r,o){var a=[],t=0,i="",n=!0,l=!1,d=void 0;try{for(var c,s=r[Symbol.iterator]();!(n=(c=s.next()).done);n=!0){var u=c.value;a.push(u),++t>10&&(i+=a.join(",")+o,a=[],t=0)}}catch(e){l=!0,d=e}finally{try{!n&&s.return&&s.return()}finally{if(l)throw d}}a.length&&(i+=a.join(",")+o),M(i,e)},z=null,G=0,N=function(e){n=-1,clearInterval(z),z=setInterval(function(){if((n=D())>-1)return clearInterval(z),void(e&&e(n));++G>20&&(clearInterval(z),trace(">>_LoopSearch...END! Not found Start Of Week (ToT)"))},500)},D=function(){var e=r.querySelector("#drawerMiniMonthNavigator > [data-month] > [role='grid'] > [role='rowgroup'] > [role='row']");if(!e)return-1;l=8===e.children.length;var o=e.children[l?1:0];if(o&&o.dataset.date){var a=H(o.dataset.date);if(a)return a.getDay()}return-1},M=function(e,o){var a=r.querySelectorAll("head")[0];if(a){var t=r.querySelector("#"+o);t&&t.parentNode.removeChild(t);var i=r.createElement("style");i.type="text/css",i.rel="stylesheet",i.id=o,i.appendChild(r.createTextNode(e)),a.appendChild(i)}},L=function(e,r){var o=""+(1970+(e>>9)),a=""+I(e>>5&15,2),t=""+I(31&e,2);return"date"==r?new Date(o,Number(a)-1,Number(t)):"day"==r?new Date(o,Number(a)-1,Number(t)).getDay():""+o+a+t},E=function(e){return((parseFloat(e.substr(0,4))-1970<<4)+parseFloat(e.substr(4,2))<<5)+parseFloat(e.substr(6,2))},A=function(e){return e.getFullYear()+""+I(e.getMonth()+1,2)+I(e.getDate(),2)},H=function(e){var r=parseFloat(e.substr(0,4)),o=parseFloat(e.substr(4,2)),a=parseFloat(e.substr(6,2));return r&&o&&a?new Date(r,Number(o)-1,Number(a)):null},I=function(e,r){return("0000000000"+e).slice(-r)},q=function(e,r){var o=new Date(e.getTime());return o.setDate(o.getDate()+r),o},j=function(e){var r={flg:!1},o=new XMLHttpRequest;return o.onreadystatechange=function(){r.stat=o.readyState,4==o.readyState&&(r.flg=!0,r.responseText=o.responseText)},o.open("GET",e,!1),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.send(),r},T=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},O=function(e){var o=r.cookie.match(new RegExp(e+"=[a-zA-Z0-9.()=|%/]+($|;)","g"));return o&&o[0]&&unescape(o[0].substring(e.length+1,o[0].length).replace(";",""))||null},Z=function(){var e=r.querySelectorAll("body")[0];if(e.className){var o=null;if(o=e.className.match(/^loc-([a-z_]{2,5})/i))return o[1]}return""}}(window,document);